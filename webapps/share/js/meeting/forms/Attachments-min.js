define(["dojo/_base/declare","meeting/forms/_DynamicForm","dijit/_TemplatedMixin","dojo/text!./templates/Attachments.html","meeting/utils/base","alfresco/core/topics","dojo/_base/lang"],function(b,a,d,c,e,g,f){return b([a,d],{templateString:c,state:"",isClerk:false,isAdmin:false,isSecretary:false,isChairman:false,postMixInProperties:function(){this.uid=Math.random().toString(36).substr(2,9)+"-tree-version-attach";this.uidPreview=this.uid+"_attachments-preview";this.uidGrid=this.uid+"_attachments-grid";this.inherited(arguments)},postCreate:function(){this.alfSubscribe("CHANGE_STATE_MEETING_DOCUMENT",f.hitch(this,this.setState),true);if(this.storeId){var h=e.getStoreById(this.storeId);if(h.document){this.documentNodeRef=h.nodeRef;this.state=h.state}}this.widgets=[{name:"meeting/forms/controlAttachmentsForm/menus/MainMenuBar",config:{storeId:this.storeId,gridId:this.uidGrid,isClerk:this.isClerk,isAdmin:this.isAdmin,isSecretary:this.isSecretary,isChairman:this.isChairman}},{name:"btlUI/MenuBar/ECPAllMenuBar",config:{parentNodeRef:this.documentNodeRef}},{name:"alfresco/forms/ControlRow",config:{widgets:[{name:"meeting/layout/ClassicWindow",widthPx:"770",config:{title:"Файлы документа:",type:"primary",widgets:[{name:"meeting/forms/controlAttachmentsForm/TreeGrid/AttachmentsTreeGrid",config:{parentNodeRef:this.documentNodeRef,formId:this.uidGrid,filePreviewContainerId:this.uidPreview,hideHeader:true}},]}},{name:"meeting/layout/ClassicWindow",config:{title:"Предпросмотр:",type:"success",widgets:[{name:"btlUI/Container/FilePreviewContainer",id:this.uidPreview,config:{idPosition:this.uidPreview}},]}}]}}];this.inherited(arguments);this.setState({state:this.state,access:this.access})},setState:function(h){this.state=h.state;if(h.nodeRef){this.documentNodeRef=h.nodeRef}switch(this.state){case"":break;default:if(this.documentNodeRef){this.renderAttach()}else{console.error("Не удалось получить NodeRef документа")}break}},renderAttach:function(){}})});