define(["dojo/_base/declare","alfresco/core/Core","dojo/_base/lang","alfresco/core/CoreXhr","meeting/utils/base","dojo/store/Memory","dojo/store/Cache","dojo/store/Observable","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/treeSelect.html"],function(e,f,b,c,d,h,j,g,a,k,l){return e([a,k,f,c],{templateString:l,style:"border: 1px solid #ccc; min-height: 54px; min-width: 500px;",postMixInProperties:function(){this.alfSubscribe("ADD_NEGOTIATORS_TO_LIST",b.hitch(this,this.addNegotiatorToList),true);this.alfSubscribe("UP_NEGOTIATOR",b.hitch(this,this.upNegotiator),true);this.alfSubscribe("DOWN_NEGOTIATOR",b.hitch(this,this.downNegotiator),true);this.alfSubscribe("DELETE_NEGOTIATOR",b.hitch(this,this.deleteNegotiator),true)},load:function(){_negotiatorsTree=new YAHOO.widget.TreeView(this.domNode);_negotiatorsTree.subscribe("focusChanged",this.onNegotiatorFocusChanged.bind(this));this.negotiatorsTree=_negotiatorsTree;this.negotiatorsTree.render()},getValue:function(){if(this.negotiatorsTree.getNodeCount()==0){return null}var n=[];var m=this.negotiatorsTree.getNodesBy(function(p){return true});for(i=0;i<m.length;i++){var o=m[i];if(o.data&&o.data.id){n.push(o.data.id)}}return n},setValue:function(o){var m=this.negotiatorsTree.getNodesBy(function(p){return true});if(m){for(i=m.length-1;i>=0;i--){var n=m[i];this.negotiatorsTree.removeNode(n)}}this.negotiatorsTree.render()},addNegotiatorToList:function(p){if(p.value.nodeRef&&p.value.name){var o=this.negotiatorsTree.getNodeByProperty("id",p.value.nodeRef);if(o==null){var m=this.negotiatorsTree.getRoot();var n=new YAHOO.widget.TextNode({label:p.value.name,id:p.value.nodeRef,expanded:false},m);this.negotiatorsTree.render()}this.alfPublish("UPDATE_NEGOTIATION_CONTROL",{name:"",nodeRef:""},true)}},onNegotiatorFocusChanged:function(m){if(m.newNode!=null){currentNegotiator=m.newNode;this.alfPublish("NEGOTIATOR_CONTROL_NAVIGATE_DISABLE",{disabled:false,all:true},true)}},deleteNegotiator:function(){if(currentNegotiator!=null){this.negotiatorsTree.removeNode(currentNegotiator);currentNegotiator=null;this.negotiatorsTree.render();this.alfPublish("NEGOTIATOR_CONTROL_NAVIGATE_DISABLE",{disabled:true,all:true},true)}},upNegotiator:function(){if(currentNegotiator){var m=currentNegotiator.index;var n=this.negotiatorsTree.getNodeByIndex(m-1);if(n!=null){this.replaceNodeData(currentNegotiator,n);currentNegotiator=n}this.negotiatorsTree.render()}},downNegotiator:function(){if(currentNegotiator){var m=currentNegotiator.index;var n=this.negotiatorsTree.getNodeByIndex(m+1);if(n!=null){this.replaceNodeData(currentNegotiator,n);currentNegotiator=n}this.negotiatorsTree.render()}},replaceNodeData:function(n,o){var m=n.label;var p=n.data.id;n.label=o.label;n.data.id=o.data.id;o.label=m;o.data.id=p},postCreate:function(){this.load()},validate:function(){if(this.getValue()==null){this.alfPublish("ALF_INVALID_CONTROL",{name:this.name,fieldId:this.fieldId});this.showValidationFailure()}else{this.alfPublish("ALF_VALID_CONTROL",{name:this.name,fieldId:this.fieldId});this.hideValidationFailure()}}})});