define(["dojo/_base/declare","meeting/menus/_MenuBar","dojo/_base/lang","meeting/utils/base","dojo/topic",],function(b,e,d,c,a){return b([e],{access:"",state:"",documentNodeRef:null,isReadOnly:false,isClerk:false,isAdmin:false,isSecretary:false,isChairman:false,pathToComponents:"meeting/forms/controlAttachmentsForm/MenuItems/",postMixInProperties:function(){this.inherited(arguments);var f=c.getStoreById("MEETING_STORE");handleAlfSubscribe=f.handleAlfSubscribe;handleAlfSubscribe.push(this.alfSubscribe("CHANGE_STATE_MEETING_DOCUMENT",d.hitch(this,this.setState),true));handleAlfSubscribe.push(this.alfSubscribe("SELECT_ROW_ATTACHMENTS_TREE_GRID",d.hitch(this,this.changeStageMenuBar),true));this.initFirstRowHandle=this.alfSubscribe("ALF_WIDGET_PROCESSING_COMPLETE",d.hitch(this,this.initFirstRow),true);handleAlfSubscribe.push(this.initFirstRowHandle)},initFirstRow:function(){if(this.widgetProcessingComplete){this.alfPublish("TRIGGER_CURRENT_ROW_DATA_ATTACHMENTS",{},true);this.alfUnsubscribe(this.initFirstRowHandle);if(this.documentNodeRef){this.setOnLoadMenuStage()}}},setOnLoadMenuStage:function(){Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"slingshot/doclib/node/"+this.documentNodeRef.replace("://","/"),successCallback:{fn:function(f){if(f.json.item.permissions.userAccess.create!=true){this.alfPublish(this.pubSubScope+"IS_READ_ONLY_ATTACHMENTS",{},true);this.isReadOnly=true}},scope:this}})},changeStageMenuBar:function(g){if(!this.isReadOnly&&g&&g.nodeRef){Alfresco.util.Ajax.jsonGet({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/node/"+g.nodeRef.replace("://","/"),successCallback:{fn:function f(h){this.alfPublish(this.pubSubScope+"META_SELECT_DOCUMENT",h.json,true)},scope:this}})}},postCreate:function(){if(!this.state&&this.storeId){var l=c.getStoreById(this.storeId);if(l.document){this.state=l.state;this.documentNodeRef=l.nodeRef}}var h={name:this.pathToComponents+"AddAttachments",config:{documentNodeRef:this.documentNodeRef}};var g={name:this.pathToComponents+"UploadNewVersionAttachment",config:{documentNodeRef:this.documentNodeRef}};var k={name:this.pathToComponents+"UploadFromScanerMenuItem",config:{parentNodeRef:this.documentNodeRef}};var f={name:this.pathToComponents+"RefreshAttachmentsMenuItem",config:{parentNodeRef:this.documentNodeRef}};var o={name:this.pathToComponents+"DeleteAttachmentsMenuItem",config:{parentNodeRef:this.documentNodeRef}};var j={name:this.pathToComponents+"EditOnlineAttachmentsMenuItem"};var i={name:this.pathToComponents+"EditOfflineAttachmentsMenuItem"};var n={name:this.pathToComponents+"DownloadAttachmentsMenuItem"};var m={name:this.pathToComponents+"CancelEditingAttachmentsMenuItem"};if(this.isClerk||this.isAdmin||this.isSecretary||this.isChairman){this.widgets=[h,g,k,j,i,m,o,f,n,]}else{this.widgets=[f,n]}this.inherited(arguments)},setState:function(f){this.state=f.state;switch(this.state){case"":break;default:break}},disableMenu:function(g){var f=g.isDisable;var h=this._processingWidgets;h.forEach(function(i){i.setDisabled((f)?true:false)})}})});