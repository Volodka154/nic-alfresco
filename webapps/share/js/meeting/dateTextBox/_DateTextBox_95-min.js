define(["dojo/_base/declare","alfresco/forms/controls/BaseFormControl","alfresco/forms/controls/utilities/TextBoxValueChangeMixin","dojo/_base/lang","dojo/date/stamp","dijit/form/DateTextBox","dojo/dom-class","alfresco/core/ObjectTypeUtils","dojo/dom-style"],function(f,l,n,b,a,e,k,o,g){return f([l,n],{unsetReturnValue:undefined,valueFormatSelector:"date",cssRequirements:[{cssFile:"./css/DateTextBox.css"}],postMixInProperties:function(){if(this.value==="TODAY"){this.value=(new Date()).toISOString()}else{if(!this.value||(typeof this.value==="string"&&b.trim(this.value).length===0)){this.value=null}else{if(typeof this.value==="string"){this.value=new Date(this.value)}}}this.inherited(arguments)},getWidgetConfig:function i(){this.configureValidation();var p=this.message(this.placeHolder||"");return{id:this.id+"_CONTROL",name:this.name,placeHolder:p,options:(this.options!==null)?this.options:[]}},configureValidation:function d(){if(!this.validationConfig||!o.isArray(this.validationConfig)){this.validationConfig=[]}this.validationConfig.push({validation:"customValidator",errorMessage:this.message("formValidation.date.error")})},customValidator:function j(q){var p=this.getValue(),r=typeof p==="string";if(!r&&!this._required){r=this.wrappedWidget.get("displayedValue")===""}this.reportValidationResult(q,r)},getValue:function c(){var r=this.inherited(arguments);var q=this.processDateValue(r);if(r!==null&&r&&r instanceof Date){var p=new Date();p.setHours(0,0,0,0);if((r.valueOf()<p.valueOf())){q=null}}return q},completeWidgetSetup:function(){this.inherited(arguments);if(this.style&&document.getElementById("widget_"+this.dateTextBox.id)){g.set("widget_"+this.dateTextBox.id,this.style)}},processDateValue:function m(q){var p=q&&a.toISOString(q,{selector:this.valueFormatSelector});if(!p&&typeof this.unsetReturnValue!=="undefined"){p=this.unsetReturnValue}return p},createFormControl:function(q){k.add(this.domNode,"alfresco-forms-controls-DateTextBox");var p=new e(q);this.dateTextBox=p;p.validate=b.hitch(this,function(){setTimeout(b.hitch(this,this.validate),0);return true});return p},formControlValueChange:function h(q,p,r){if(r&&r instanceof Date){r=a.toISOString(r,{selector:this.valueFormatSelector})}if(!r&&typeof this.unsetReturnValue!=="undefined"){this.inherited(arguments,[q,p,this.unsetReturnValue])}else{this.inherited(arguments,[q,p,r])}}})});