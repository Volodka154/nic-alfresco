define(["dojo/_base/declare","dijit/layout/BorderContainer","./_DateTextBox_95","dijit/form/TimeTextBox","dijit/form/DateTextBox","dojo/dom-class","dojo/_base/lang","dojo/date/stamp","meeting/utils/base"],function(f,d,g,h,e,i,b,a,c){return f([g],{value:null,placeHolderTime:"Время",placeHolder:"Дата",valueFormatSelector:"datetime",minTime:8,maxTime:20,position:"horizontal",constraintsTime:{clickableIncrement:"T01:00:00",visibleIncrement:"T01:00:00",visibleRange:"T03:00:00"},additionalCssClasses:"_DateTimeTextBox",cssRequirements:[{cssFile:"./css/_DateTimeTextBox.css"}],postCreate:function(){if(!this.value&&this.storeId){var j=c.getStoreById(this.storeId);if(j.document){this.value=j.document.properties[this.name]}}this.inherited(arguments)},createFormControl:function(m){var l=new Date();var n=new Date(l.getYear(),l.getMonth(),l.getDay(),this.minTime,0,0);var j=new Date(l.getYear(),l.getMonth(),l.getDay(),this.maxTime,0,0);this.constraintsTime.min=n;this.constraintsTime.max=j;i.add(this.domNode,"alfresco-forms-controls-DateTextBox");m.onChange=this.updateTextDateTime.bind(this);this.value=(this.value)?a.fromISOString(this.value):null;m.value=this.value;m.placeHolder=(m.placeHolder)?m.placeHolder:this.placeHolder;m.valueFormatSelector=(m.valueFormatSelector)?m.valueFormatSelector:this.valueFormatSelector;this.dateTextBox=new e(m);this.timeTextBox=new h({id:this.id+"_timeTextBox",onChange:this.updateTextDateTime.bind(this),placeHolder:this.placeHolderTime,value:this.value,constraints:this.constraintsTime,style:"margin-top: 3px;",_disabled:this._disabled,disabled:this.disabled});var k=new d({});if(this.position=="vertical"){this.dateTextBox.domNode.classList.remove("dijitInline");this.dateTextBox.domNode.style.marginBottom="5px"}if(this.value){this.updateTextDateTime()}k.addChild(this.dateTextBox);k.addChild(this.timeTextBox);this.dateTextBox.validate=b.hitch(this,function(){setTimeout(b.hitch(this,this.validate),0);return true});this.timeTextBox.validate=b.hitch(this,function(){setTimeout(b.hitch(this,this.validate),0);return true});return k},updateTextDateTime:function(){this.value=this.getCurrentValue()},getCurrentValue:function(){var j=(this.dateTextBox.get("value"))?this.dateTextBox.get("value"):null;var k=(this.timeTextBox.get("value"))?this.timeTextBox.get("value"):null;var l=null;if(j){if(k){l=j;l.setHours(k.getHours(),k.getMinutes())}else{l=j}}if(l===null){if((this.dateTextBox.textbox.value!=""&&(!this.dateTextBox.value||this.dateTextBox.value.toString()=="Invalid Date"))||(this.timeTextBox.textbox.value!=""&&(!this.timeTextBox.value||this.timeTextBox.value.toString()=="Invalid Date"))){return""}}return l},getValue:function(){var k=this.getCurrentValue();var j=this.processDateValue(k);return j},customValidator:function(k){var j=new Date(this.getValue()),l=j instanceof Date&&!isNaN(j.valueOf());if(!l&&!this._required){l=this.wrappedWidget.get("displayedValue")===""}this.reportValidationResult(k,l)},processDateValue:function(k){var j=k&&a.toISOString(k,{selector:this.valueFormatSelector});if(!j&&typeof this.unsetReturnValue!=="undefined"){j=this.unsetReturnValue}return j},formControlValueChange:function(k,j,l){if(l&&l instanceof Date){l=a.toISOString(l,{selector:this.valueFormatSelector})}if(!l&&typeof this.unsetReturnValue!=="undefined"){this.inherited(arguments,[k,j,this.unsetReturnValue])}else{this.inherited(arguments,[k,j,l])}},})});