define(["dojo/_base/declare","meeting/forms/_DynamicForm","dojo/_base/lang","meeting/utils/base","meeting/menus/_MenuBar","meeting/menuBarItems/SendRoute","meeting/menuBarItems/ToRegister","meeting/menuBarItems/CreateMeeting","meeting/menuBarItems/RegisterAndSendToExecute","meeting/menuBarItems/SendInvitation","meeting/menuBarItems/ToArchive"],function(b,a,d,c){return b([a],{access:"",state:"",model:[],subscriptionTopic:"CHANGE_STATE_MEETING_DOCUMENT",postCreate:function(){this.inherited(arguments);this.alfSubscribe(this.subscriptionTopic,d.hitch(this,this.setState),true);this.alfSubscribe("VALID_BASE_FORM_MEETING",d.hitch(this,this.disableMenu),true);this.model={name:"meeting/menus/_MenuBar",config:{widgets:[]}};if(!this.state&&this.storeId){var e=c.getStoreById(this.storeId);if(e.document){this.state=e.state}}this.setState({state:this.state,access:this.access});this.disableMenu({valid:false})},setStateSendRoute:function(){this.applyModel()},setState:function(h){var i=false;var j=false;var g=false;var f=false;if(this.storeId){var e=c.getStoreById(this.storeId);i=e.isSecretary;j=e.isClerk;g=e.isAdmin}this.state=h.state;this.alfPublish("CHANGE_MEETING_STATE_CONTROL",this.state,true);switch(this.state){case"":this.model.config.widgets=[];break;case"Черновик":case"Переговорная подтверждена":if(i||j||g){this.model.config.widgets=[{name:"meeting/menuBarItems/CompleteCreate"},{name:"meeting/menuBarItems/SelectRooms"}]}break;case"Подтверждение переговорной":if(i||j||g){this.model.config.widgets=[{name:"meeting/menuBarItems/CancelConfirmRoom"}]}break;case"Подготовлен":if(i||j||g){this.model.config.widgets=[{name:"meeting/menuBarItems/ToNegotiation"},{name:"meeting/menuBarItems/SendInvitation"},{name:"meeting/menuBarItems/ToRegister"},{name:"meeting/menuBarItems/RegisterAndSendToExecute"},{name:"meeting/menuBarItems/CreateProtocol"},{name:"meeting/menuBarItems/ToArchive"}]}break;case"На согласовании":if(i||j||g){this.model.config.widgets=[{name:"meeting/menuBarItems/CancelNegotiation"}]}break;case"На доработке":if(i||j||g){this.model.config.widgets=[]}break;case"Согласован":if(i||j||g){this.model.config.widgets=[{name:"meeting/menuBarItems/ToRegister"},{name:"meeting/menuBarItems/RegisterAndSendToExecute"}]}break;case"На подписании":if(i||j||g){this.model.config.widgets=[{name:"meeting/menuBarItems/CancelSigner"}]}break;case"На регистрации":if(i||j||g){this.model.config.widgets=[{name:"meeting/menuBarItems/ToRegister"},{name:"meeting/menuBarItems/RegisterAndSendToExecute"}]}break;case"Зарегистрирован":if(i||j||g){this.model.config.widgets=[{name:"meeting/menuBarItems/ToExecute"},{name:"meeting/menuBarItems/ToArchive"}]}break;case"На исполнении":if(i||j||g){this.model.config.widgets=[{name:"meeting/menuBarItems/ToArchive"}]}break;case"В архиве":this.model.config.widgets=[];break}this.applyModel()},applyModel:function(){this.onDynamicFormUpdate({value:JSON.stringify([this.model])})},disableMenu:function(f){var g=f.valid;var e=this._processingWidgets[0];e._processingWidgets.forEach(function(h){h.setDisabled((g)?false:true)})}})});