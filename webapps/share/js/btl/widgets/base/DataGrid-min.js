define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/DataGrid.html","service/constants/Default","alfresco/core/Core","alfresco/core/CoreWidgetProcessing","alfresco/documentlibrary/_AlfDocumentListTopicMixin","alfresco/services/_NavigationServiceTopicMixin","dojo/dom-construct","dojo/_base/lang","alfresco/core/CoreXhr","btl/service/FormContactPerson","jquery","pqgrid"],function(w,e,t,x,n,p,s,d,a,i,z,j,u,h){return w([e,t,p,s,d,a,j],{templateString:x,customCssClasses:"",postMixInProperties:function g(){this.inherited(arguments);this.alfSubscribe("DATAGRID_LOAD_DATA",z.hitch(this,this.loadDataDataGrid));this.alfSubscribe("DATAGRID_SET_DATA",z.hitch(this,this.setDataDataGrid));this.alfSubscribe("DATAGRID_ADD_ROW",z.hitch(this,this.addNewRow),true);this.alfSubscribe("DATAGRID_EDIT_ROW",z.hitch(this,this.editRow),true);this.alfSubscribe("DATAGRID_REFRESH_DATA",z.hitch(this,this.refreshDataDataGrid),true);this.alfSubscribe("DATAGRID_DELETE_ROW_FROM_STORE_SUCCESS",z.hitch(this,this.deleteRowFromStore),true)},Url:"search/search",title:"",type:null,parentTreeType:null,collapsible:false,colModel:null,pageModel:{type:"local",rPP:25,strRpp:"{0}",rPPOptions:[25,50,100]},selectionModel:{type:"row",mode:"range",all:null,cbAll:null,cbHeader:null},filterModel:{on:false,mode:"AND",header:true},toolbar:{},detailModel:{},resizable:true,showBottom:true,flexWidth:false,editable:false,width:1325,loadData:false,rootNodeRef:null,height:600,data:[],editor:null,editModel:{cellBorderWidth:1,clicksToEdit:1,filterKeys:true,keyUpDown:true,saveKey:""},q_params:null,quitEditMode:null,extra:"",isDataLoad:false,notActual:false,sizeAuto:true,cssRequirements:[{cssFile:"./css/pqgrid.css"},{cssFile:"./css/themes/Office/pqgrid.css"},{cssFile:"./css/themes/Office/jquery-ui.css"}],postCreate:function f(){if(this.sizeAuto){var A=this.gridAutoSize();this.height=A.height;this.width=A.width}this.gridModel={width:this.width,height:this.height,collapsible:this.collapsible,title:this.title,flexWidth:true,resizable:true,numberCell:{resizable:false,title:"#"},editable:this.editable,flexWidth:this.flexWidth,showBottom:this.showBottom,resizable:this.resizable,pageModel:this.pageModel,detailModel:this.detailModel,filterModel:this.filterModel,toolbar:this.toolbar,editor:this.editor,editModel:this.editModel,quitEditMode:this.quitEditMode};this.gridModel.colModel=this.colModel;this.gridModel.selectionModel=this.selectionModel;this.alfLog("log","alfresco_DataGrid__postCreate data",this.data);this.gridModel.dataModel={data:this.data};this.gridModel._disabled=this._disabled;this.grid=h(this.domNode).pqGrid(this.gridModel);if(this.loadData){this.grid.pqGrid("showLoading");this.loadDataDataGrid({nodeRef:this.rootNodeRef})}this.alfLog("log","alfresco_DataGrid__postCreate this",this);this.alfLog("log","alfresco_DataGrid__postCreate dataModel",this.gridModel.dataModel);this.setEventsDataGrid();this.eventAfterInit()},eventAfterInit:function(){var A=this;h(window).resize(function(){var B=A.gridAutoSize();A.grid.pqGrid("option","width",B.width);A.grid.pqGrid("option","height",B.height);A.grid.pqGrid("refreshView",{header:false})})},gridAutoSize:function c(){var A=document.documentElement.offsetHeight;A-=document.getElementById("SHARE_HEADER").offsetHeight;A-=50;var B=document.documentElement.offsetWidth-document.getElementById("MAIN_LIST_MENU").offsetWidth;B-=30;return{height:A,width:B}},setEventsDataGrid:function o(){},loadDataDataGrid:function k(C){if(this.parentTreeType!=C.treeType){return}var B="nodeRef="+C.nodeRef;this.dataEmployee=C;if(this.allChild){B+="&allChild="+this.allChild}if(this.type!==null){B+="&type="+this.type}if(this.q_params!==null){if(this.notActual===true||this.notActual===false){this.q_params.notActual=this.notActual}B+="&params="+encodeURI(encodeURIComponent(JSON.stringify(this.q_params)))}B+=this.extra;var A={url:n.PROXY_URI+this.Url,query:B,method:"GET",successCallback:this.loadDataToDataGrid,failureCallback:this.failureLoadDataToDataGrid,callbackScope:this};this.serviceXhr(A)},failureLoadDataToDataGrid:function r(C,A){this.grid.pqGrid("hideLoading");var B=JSON.parse(C.response.text);if(B.message){alert(B.message)}},setDataDataGrid:function l(A){this.grid.pqGrid("option","dataModel.data",A);this.grid.pqGrid("refreshDataAndView");this.grid.pqGrid("hideLoading");this.alfLog("log","alfresco_DataGrid__setDataToDataGrid",this.grid);this.isDataLoad=true},loadDataToDataGrid:function q(B,A){this.setDataDataGrid(B.items)},addNewRow:function y(A){this.alfLog("log","alfresco_DataGrid__addNewRow",A);this.grid.pqGrid("addRow",{rowData:A});this.grid.pqGrid("refreshDataAndView")},refreshDataDataGrid:function v(){this.grid.pqGrid("refreshDataAndView")},deleteRowFromStore:function m(){var A=this.grid.pqGrid("selection",{type:"row",method:"getSelection"});if(A&&A.length>0){this.grid.pqGrid("deleteRow",{rowIndx:A[0].rowIndx});this.grid.pqGrid("setSelection",{rowIndx:A[0].rowIndx})}},editRow:function b(A){this.alfLog("log","alfresco_DataGrid__editRow",A);this.grid.pqGrid("updateRow",{rowIndx:A.rowId,row:A});this.grid.pqGrid("refreshDataAndView")}})});