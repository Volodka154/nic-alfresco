define(["dojo/_base/declare","alfresco/forms/controls/BaseFormControl","alfresco/forms/controls/utilities/TextBoxValueChangeMixin","dojo/_base/lang","dojo/date/stamp","dijit/form/TimeTextBox","dojo/dom-class","alfresco/core/ObjectTypeUtils","dojo/dom-style"],function(f,n,o,c,a,i,m,p,h){return f([n,o],{unsetReturnValue:undefined,dateValue:null,value:"TODAY",valueFormatSelector:"datetime",cssRequirements:[{cssFile:"./css/TimeTextBox.css"}],postMixInProperties:function(){if(this.value==="TODAY"){this.value=(new Date()).toISOString();this.dateValue=new Date()}else{if(!this.value||(typeof this.value==="string"&&c.trim(this.value).length===0)){this.value=null}}this.inherited(arguments)},getWidgetConfig:function j(){this.configureValidation();var q=this.message(this.placeHolder||"");return{id:this.id+"_CONTROL",name:this.name,placeHolder:q,options:(this.options!==null)?this.options:[]}},configureValidation:function l(){if(!this.validationConfig||!p.isArray(this.validationConfig)){this.validationConfig=[]}this.validationConfig.push({validation:"customValidator",errorMessage:this.message("formValidation.date.error")})},customValidator:function g(r){var q=this.getValue(),s=typeof q==="string";if(!s&&!this._required){s=true}this.reportValidationResult(r,s)},getValue:function d(){var r=this.inherited(arguments);var q=null;if(r){if(this.dateValue){q=this.dateValue;q.setHours(r.getHours());q.setMinutes(r.getMinutes());q.setSeconds(0)}else{q=r}}else{q=r}var q=this.processDateValue(q);return q},processDateValue:function b(r){var q=r&&a.toISOString(r,{selector:this.valueFormatSelector});if(!q&&typeof this.unsetReturnValue!=="undefined"){q=this.unsetReturnValue}return q},createFormControl:function e(r){m.add(this.domNode,"alfresco-forms-controls-TimeTextBox");var q=new i(r);this.timeTextBox=q;q.validate=c.hitch(this,function(){setTimeout(c.hitch(this,this.validate),0);return true});return q},formControlValueChange:function k(r,q,s){if(s&&s instanceof Date){s=a.toISOString(s,{selector:this.valueFormatSelector})}if(!s&&typeof this.unsetReturnValue!=="undefined"){this.inherited(arguments,[r,q,this.unsetReturnValue])}else{this.inherited(arguments,[r,q,s])}},completeWidgetSetup:function(){this.inherited(arguments);if(this.style&&document.getElementById("widget_"+this.timeTextBox.id)){h.set("widget_"+this.timeTextBox.id,this.style)}},})});