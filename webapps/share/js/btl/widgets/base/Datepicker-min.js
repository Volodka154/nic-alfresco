define(["dojo/_base/declare","alfresco/forms/controls/BaseFormControl","dijit/_TemplatedMixin","./_validationMixin","dojo/text!./templates/Datepicker.html","dojo/_base/lang","dojo/date/stamp","dijit/form/DateTextBox","dojo/dom-class","dojo/_base/array","alfresco/core/ObjectTypeUtils"],function(g,o,q,b,i,c,a,f,n,h,p){return g([o,q,b],{cssRequirements:[{cssFile:"./css/DateTextBox.css"}],templateString:i,postMixInProperties:function(){if(this.value==="TODAY"){this.value=(new Date()).toISOString()}else{if(!this.value||(typeof this.value==="string"&&c.trim(this.value).length===0)){this.value=null}}this.inherited(arguments)},getWidgetConfig:function k(){this.configureValidation();var r=this.message(this.placeHolder||"");return{id:this.id+"_CONTROL",name:this.name,placeHolder:r,options:(this.options!==null)?this.options:[]}},configureValidation:function e(){if(!this.validationConfig||p.isObject(this.validationConfig)){this.validationConfig=[]}this.validationConfig.push({validation:"customValidator",errorMessage:this.message("formValidation.date.error")})},customValidator:function m(s){var r=this.getValue(),t=typeof r==="string";if(!t&&!this._required){t=this.wrappedWidget.get("displayedValue")===""}this.reportValidationResult(s,t)},getValue:function d(){var r=this.inherited(arguments);return r&&a.toISOString(r,{selector:"date"})},createFormControl:function l(s){n.add(this.domNode,"alfresco-forms-controls-DateTextBox");var r=new f(s);r.validate=c.hitch(this,function(){setTimeout(c.hitch(this,this.validate),0);return true});return r},hideValidationFailure:function j(){if(this.domNode){n.remove(this.domNode,"alfresco-forms-controls-BaseFormControl--invalid");this._pendingValidationFailureDisplay=false}},})});