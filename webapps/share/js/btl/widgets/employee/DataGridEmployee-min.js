define(["dojo/_base/declare","btl/widgets/base/DataGrid","dojo/_base/lang","alfresco/core/CoreXhr","dojo/topic","dijit/Dialog","dojox/widget/Standby","loading"],function(g,n,b,c,i,l,m,f){return g([n,c],{title:"Список сотрудников",Url:"search/employee",colModel:[],filterModel:{on:true,mode:"AND",header:true},pageModel:{type:"local",rPP:500,strRpp:"{0}",rPPOptions:[100,250,500]},notActual:null,type:"employee",toolbar:{},standby:null,setEventsDataGrid:function d(){var p=this;this.grid.pqGrid({rowDblClick:function(q,r){p.getEmployeeData()}})},postMixInProperties:function e(){this.inherited(arguments);this.alfSubscribe("DATAGRID_DELETE_EMLPOYEE",b.hitch(this,this.deleteEmployee),true);this.alfSubscribe("DATAGRID_GET_EMLPOYEE_DATA",b.hitch(this,this.getEmployeeData),true);this.alfSubscribe("SINC_EMLPOYEE_DATA",b.hitch(this,this.sincEmployeeData),true)},deleteEmployee:function a(){var p=this.grid.pqGrid("selection",{type:"row",method:"getSelection"});if(p&&p.length>0){var r=p[0].rowData;var q={};q.requiresConfirmation=true;q.confirmationTitle="Удаление сотрудника";q.confirmationPrompt="Вы действительно хотите удалить: "+r.surname+" "+r.firstname+" ?";q.nodeRef=r.nodeRef;q.responseTopic="BTL_SING_REMOVE_EMPLOYEE";this.alfPublish("BTL_MSG_DELETE_DIALOG",q,true);this.alfLog("log","alfresco_EmployeeDataGrid__deleteEmployee",r)}},getEmployeeData:function k(){var p=this.grid.pqGrid("selection",{type:"row",method:"getSelection"});if(p&&p.length>0){var r=p[0].rowData;var q={};q.config={};q.data=r;q.data.rowId=p[0].rowIndx;q.config.dialogTitle="formEmployee.title";q.config.dialogConfirmationButtonTitle="edit.title";q.config.dialogCancellationButtonTitle="cancel.title";q.config.formSubmissionTopic="BTL_EDIT_EMPLOYEE";this.alfPublish("BTL_CREATE_FORM_EMPLOYEE",q,true)}},sincEmployeeData:function j(){$.LoadingOverlay("show");this.serviceXhr({url:"/share/proxy/alfresco/events/synchronization-employees",method:"GET",successCallback:this.sincEmployeeDataSuccess,failureCallback:this.sincEmployeeDataFailure,callbackScope:this})},sincEmployeeDataSuccess:function h(q,p){$.LoadingOverlay("hide");if(q.employeeNoFam.length>0){employeeNoFam="";for(var r=0;r<q.employeeNoFam.length;r++){employeeNoFam+="<p>"+q.employeeNoFam[r]+"</p>"}require(["dojo/_base/xhr","btlUI/Dialog/UserNotFamDialog","dojo/domReady!"],function(u,s){var t=new s();t.addNotificationToForm({content:"<p><strong>Синхронизация успешно завершилась. Есть пользователи, у которых не указана фамилия:</strong></p>"+employeeNoFam},1);t.show()})}else{i.publish("ALF_DISPLAY_NOTIFICATION",{message:"Синхронизация успешно завершилась"})}this.loadDataDataGrid({nodeRef:this.rootNodeRef})},sincEmployeeDataFailure:function o(q,p){$.LoadingOverlay("hide");var q=q;failureDialog=new l({title:"Ошибка синхронизации",content:q.message,style:"width: 300px"});failureDialog.show()}})});