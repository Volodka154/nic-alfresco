define(["dojo/_base/declare","btl/widgets/base/DataGrid","dojo/_base/lang"],function(c,b,g){return c([b],{title:"Шаблоны согласований",Url:"/documents/getNegotiationTemplates?docType=all",colModel:[],type:"btl-negotiation%3alistDataType",postMixInProperties:function h(){this.inherited(arguments);this.alfSubscribe("DATAGRID_ADD_negotiationTemplate",g.hitch(this,this.onCreateFormlinkType),true);this.alfSubscribe("DATAGRID_DELETE_negotiationTemplate",g.hitch(this,this.deletenegotiationTemplate),true);this.alfSubscribe("DATAGRID_ADD_negotiationTemplateSubmit",g.hitch(this,this.addnegotiationTemplate),true)},addnegotiationTemplate:function(i){this.data=i;this.data["prop_btl-negotiation_isTemplate"]=true;this.serviceXhr({url:"/share/proxy/alfresco/api/type/"+this.type+"/formprocessor",method:"POST",data:this.data,successCallback:this.updateLinkTypeGrid,callbackScope:this})},updateLinkTypeGrid:function f(j,i){this.alfPublish("DATAGRID_ADD_ROW",{nodeRef:j.persistedObject,name:i.data["prop_btl-negotiation_name"]},true);this.showTemplate(j.persistedObject)},showTemplate:function(m){if(document.negotiationTemplateDialog==null){var j=new YAHOO.widget.SimpleDialog("negotiationTemplate_view",{width:"1450px",height:"95vh",fixedcenter:true,modal:true,visible:false,draggable:true,zIndex:10});document.negotiationTemplateDialog=j}var i=document.createElement("iframe");i.width="100%";i.height="100%";i.src="/share/page/btl-edit-metadata?nodeRef="+m;document.negotiationTemplateDialog.setBody(i);document.negotiationTemplateDialog.render(document.body);document.negotiationTemplateDialog.show();var k=document.getElementsByTagName("iframe")[0];var l=k.contentWindow.document;l.negotiationTemplateDialog=document.negotiationTemplateDialog},deletenegotiationTemplate:function e(){var i=this.grid.pqGrid("selection",{type:"row",method:"getSelection"});if(i&&i.length>0){var k=i[0].rowData;var j={};j.requiresConfirmation=true;j.confirmationTitle="Удаление шаблона";j.confirmationPrompt="Подтвердите удаление";j.url="slingshot/datalists/list/node/"+k.nodeRef.replace("://","/");j.responseTopic="DATAGRID_DELETE_ROW_FROM_STORE";this.alfPublish("ALF_CRUD_DELETE",j,true)}},setEventsDataGrid:function d(){this.grid.pqGrid({rowDblClick:function(l,m){if(document.negotiationTemplateDialog==null){var j=new YAHOO.widget.SimpleDialog("negotiationTemplate_view",{width:"1450px",height:"95vh",fixedcenter:true,modal:true,visible:false,draggable:true,zIndex:10});document.negotiationTemplateDialog=j}var i=document.createElement("iframe");i.width="100%";i.height="100%";i.src="/share/page/btl-edit-metadata?nodeRef="+m.rowData.nodeRef;document.negotiationTemplateDialog.setBody(i);document.negotiationTemplateDialog.render(document.body);document.negotiationTemplateDialog.show();var k=document.getElementsByTagName("iframe")[0];var n=k.contentWindow.document;n.negotiationTemplateDialog=document.negotiationTemplateDialog}})},onCreateFormlinkType:function(){var i={};i.dialogTitle="Добавить шаблон";i.dialogConfirmationButtonTitle="Сохранить";i.dialogCancellationButtonTitle="Отмена";i.formSubmissionTopic="DATAGRID_ADD_negotiationTemplateSubmit";i.widgets=this.getWidgets();this.alfPublish("ALF_CREATE_FORM_DIALOG_REQUEST",i,true)},getWidgets:function a(){var i=[{name:"alfresco/forms/controls/DojoValidationTextBox",config:{label:"Название",name:"prop_btl-negotiation_name",value:""}},{name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"alf_destination",value:this.rootNodeRef,visibilityConfig:{initialValue:false}}}];return i}})});