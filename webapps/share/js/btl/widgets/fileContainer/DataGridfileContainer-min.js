define(["dojo/_base/declare","btl/widgets/base/DataGrid","dojo/_base/lang"],function(d,c,h){return d([c],{title:"Шаблоны вложений",Url:"/documents/getfileContainers?docType=all",colModel:[],type:"btl-fileContainer%3afileContainerData",postMixInProperties:function g(){this.inherited(arguments);this.alfSubscribe("DATAGRID_ADD_fileContainer",h.hitch(this,this.onCreateFormlinkType),true);this.alfSubscribe("DATAGRID_DELETE_fileContainer",h.hitch(this,this.deletefileContainer),true);this.alfSubscribe("DATAGRID_ADD_fileContainerSubmit",h.hitch(this,this.addfileContainer),true)},addfileContainer:function(i){this.data=i;this.serviceXhr({url:"/share/proxy/alfresco/api/type/"+this.type+"/formprocessor",method:"POST",data:this.data,successCallback:this.updateLinkTypeGrid,callbackScope:this})},updateLinkTypeGrid:function f(j,i){this.alfPublish("DATAGRID_ADD_ROW",{nodeRef:j.persistedObject,name:i.data["prop_btl-fileContainer_name"]},true);this.showTemplate(j.persistedObject)},showTemplate:function(m){if(document.fileContainerDialog==null){var j=new YAHOO.widget.SimpleDialog("fileContainer_view",{width:"1150px",height:"95vh",fixedcenter:true,modal:true,visible:false,draggable:true,zIndex:10});document.fileContainerDialog=j}var i=document.createElement("iframe");i.width="100%";i.height="100%";i.src="/share/page/btl-edit-metadata?nodeRef="+m;document.fileContainerDialog.setBody(i);document.fileContainerDialog.render(document.body);document.fileContainerDialog.show();var k=document.getElementsByTagName("iframe")[0];var l=k.contentWindow.document;l.fileContainerDialog=document.fileContainerDialog},deletefileContainer:function b(){var i=this.grid.pqGrid("selection",{type:"row",method:"getSelection"});if(i&&i.length>0){var k=i[0].rowData;var j={};j.requiresConfirmation=true;j.confirmationTitle="Удаление шаблона";j.confirmationPrompt="Подтвердите удаление";j.url="slingshot/datalists/list/node/"+k.nodeRef.replace("://","/");j.responseTopic="DATAGRID_DELETE_ROW_FROM_STORE";this.alfPublish("ALF_CRUD_DELETE",j,true)}},setEventsDataGrid:function e(){this.grid.pqGrid({rowDblClick:function(l,m){if(document.fileContainerDialog==null){var j=new YAHOO.widget.SimpleDialog("fileContainer_view",{width:"1150px",height:"95vh",fixedcenter:true,modal:true,visible:false,draggable:true,zIndex:10});document.fileContainerDialog=j}var i=document.createElement("iframe");i.width="100%";i.height="100%";i.src="/share/page/btl-edit-metadata?nodeRef="+m.rowData.nodeRef;document.fileContainerDialog.setBody(i);document.fileContainerDialog.render(document.body);document.fileContainerDialog.show();var k=document.getElementsByTagName("iframe")[0];var n=k.contentWindow.document;n.fileContainerDialog=document.fileContainerDialog}})},onCreateFormlinkType:function(){var i={};i.dialogTitle="Добавить шаблон";i.dialogConfirmationButtonTitle="Сохранить";i.dialogCancellationButtonTitle="Отмена";i.formSubmissionTopic="DATAGRID_ADD_fileContainerSubmit";i.widgets=this.getWidgets();this.alfPublish("ALF_CREATE_FORM_DIALOG_REQUEST",i,true)},getWidgets:function a(){var i=[{name:"alfresco/forms/controls/DojoValidationTextBox",config:{label:"Название",name:"prop_btl-fileContainer_name",value:""}},{name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"alf_destination",value:this.rootNodeRef,visibilityConfig:{initialValue:false}}}];return i}})});