define(["dojo/_base/declare","alfresco/core/Core","dojo/_base/lang","alfresco/core/CoreXhr","service/constants/Default"],function(f,i,b,c,e){return f([i,c],{data:{},rootNodeRef:null,type:"btl-prStatus%3aProjectStatus-content",constructor:function l(m){b.mixin(this,m);this.alfSubscribe("BTL_CREATE_PROJECT_STATUS",b.hitch(this,this.createProjectStatus));this.alfSubscribe("BTL_CREATE_FORM_PROJECT_STATUS",b.hitch(this,this.onCreateFormprojectStatus));this.alfSubscribe("BTL_EDIT_PROJECT_STATUS",b.hitch(this,this.editProjectStatus))},createProjectStatus:function a(m){this.alfLog("log","btl_createProjectStatusService__createProjectStatus",m);this.data=m;this.serviceXhr({url:"/share/proxy/alfresco/api/type/"+this.type+"/formprocessor",method:"POST",data:this.data,successCallback:this.updateProjectStatusGrid,callbackScope:this})},updateProjectStatusGrid:function k(o,m){this.alfLog("log","btl_ProjectStatusService__updateProjectStatusGrid",m);var n="stat";if(m.data["prop_btl-prStatus_status"]=="0"){n="Заявка"}if(m.data["prop_btl-prStatus_status"]=="1"){n="НТС"}if(m.data["prop_btl-prStatus_status"]=="2"){n="Утверждение"}if(m.data["prop_btl-prStatus_status"]=="3"){n="Реализация"}if(m.data["prop_btl-prStatus_status"]=="4"){n="Завершение"}this.alfPublish("DATAGRID_ADD_ROW",{nodeRef:o.persistedObject,celColor:"<div style='background: "+m.data["prop_btl-prStatus_color"]+"; height: 14px;'></div>",color:m.data["prop_btl-prStatus_color"],name:m.data["prop_btl-prStatus_status"],statusName:n})},editProjectStatus:function g(n){this.alfLog("log","btl_ProjectStatusService__editProjectStatus",n);var m="stat";if(n["prop_btl-prStatus_status"]=="0"){m="Заявка"}if(n["prop_btl-prStatus_status"]=="1"){m="НТС"}if(n["prop_btl-prStatus_status"]=="2"){m="Утверждение"}if(n["prop_btl-prStatus_status"]=="3"){m="Реализация"}if(n["prop_btl-prStatus_status"]=="4"){m="Завершение"}this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+n.nodeRef.replace("://","/")+"/formprocessor",method:"POST",data:n,successCallback:this.alfPublish("DATAGRID_EDIT_ROW",{rowId:n.rowId,celColor:"<div style='background: "+n["prop_btl-prStatus_color"]+"; height: 14px;'></div>",color:n["prop_btl-prStatus_color"],name:n["prop_btl-prStatus_status"],statusName:m}),callbackScope:this})},onCreateFormprojectStatus:function h(m){this.alfLog("log","alfresco_formProjectStatus__onCreateFormprojectStatus",m);this.data=m.data;this.rootNodeRef=m.rootNodeRef;var n={};n.dialogTitle=m.config.dialogTitle;n.dialogConfirmationButtonTitle=m.config.dialogConfirmationButtonTitle;n.dialogCancellationButtonTitle=m.config.dialogCancellationButtonTitle;n.formSubmissionTopic=m.config.formSubmissionTopic;n.widgets=this.getWidgets();this.alfLog("log","alfresco_formProjectStatus__onCreateFormprojectStatus",n);this.alfPublish("ALF_CREATE_FORM_DIALOG_REQUEST",n)},projectStatusOptions:[{value:0,label:"Заявка"},{value:1,label:"НТС"},{value:2,label:"Утверждение"},{value:3,label:"Реализация"},{value:4,label:"Завершение"}],getProjectStatusByValue:function d(n){if(n!=null){for(var m=0;m<this.projectStatusOptions.lenght;m++){if(n==this.projectStatusOptions[m].value){return this.projectStatusOptions[m].label}}}return""},getWidgets:function j(){var m=[{name:"alfresco/forms/controls/Select",config:{label:"prop_btl-prStatus_status.title",name:"prop_btl-prStatus_status",value:(this.data!==null)?this.data.name:"",optionsConfig:{fixed:this.projectStatusOptions}}},{name:"btl/widgets/base/ColorPalette",config:{label:"prop_btl-prStatus_color.title",name:"prop_btl-prStatus_color",value:(this.data!==null)?this.data.color:"",}}];if(this.data!==null){m.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"nodeRef",value:this.data.nodeRef,visibilityConfig:{initialValue:false}}},{name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"rowId",value:this.data.rowId,visibilityConfig:{initialValue:false}}})}else{m.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"alf_destination",value:this.rootNodeRef,visibilityConfig:{initialValue:false}}})}return m}})});