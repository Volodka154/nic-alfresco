define(["dojo/_base/declare","alfresco/core/Core","dojo/_base/lang","alfresco/core/CoreXhr","service/constants/Default"],function(g,k,a,b,c){return g([k,b],{data:{},rootNodeRef:null,type:"btl-link%3alinkDataType",newLink:{},constructor:function l(m){a.mixin(this,m);this.alfSubscribe("BTL_CREATE_LINK_DATA",a.hitch(this,this.createLinkData));this.alfSubscribe("BTL_CREATE_FORM_LINK_DATA",a.hitch(this,this.onCreateFormlinkType));this.alfSubscribe("BTL_EDIT_LINK_DATA",a.hitch(this,this.editLinkData))},createLinkData:function i(m){this.alfLog("log","btl_createLinkDataService__createLinkData",m);this.newLink.link_val=m["assoc_btl-link_link_val"];this.newLink.link_ref=m["assoc_btl-link_link"];this.newLink.relink_val=m["assoc_btl-link_relink_val"];this.newLink.relink_ref=m["assoc_btl-link_relink"];this.newLink.docType=m["prop_btl-link_docType"];this.newLink.docTypeRelink=m["prop_btl-link_docTypeRelink"];this.serviceXhr({url:"/share/proxy/alfresco/api/type/"+this.type+"/formprocessor",method:"POST",data:{alf_destination:m.alf_destination,"assoc_btl-link_link_added":m["assoc_btl-link_link_added"],"assoc_btl-link_link_removed":m["assoc_btl-link_link_removed"],"assoc_btl-link_relink_added":m["assoc_btl-link_relink_added"],"assoc_btl-link_relink_removed":m["assoc_btl-link_relink_removed"],"prop_btl-link_docType":m["prop_btl-link_docType"],"prop_btl-link_docTypeRelink":m["prop_btl-link_docTypeRelink"]},successCallback:this.updateLinkDataGrid,callbackScope:this})},updateLinkDataGrid:function j(n,m){this.alfLog("log","btl_LinkDataService__updateLinkDataGrid",m);this.newLink.nodeRef=n.persistedObject;this.alfPublish("DATAGRID_ADD_ROW",{nodeRef:this.newLink.nodeRef,link_val:this.newLink.link_val,link_ref:this.newLink.link_ref,relink_val:this.newLink.relink_val,relink_ref:this.newLink.relink_ref,docType_text:this.valueToText(this.newLink.docType),docType:this.newLink.docType,docTypeRelink_text:this.valueToText(this.newLink.docTypeRelink),docTypeRelink:this.newLink.docTypeRelink})},editLinkData:function f(m){this.alfLog("log","btl_LinkDataService__editLinkData",m);this.newLink.rowId=m.rowId;this.newLink.link_val=m["assoc_btl-link_link_val"];this.newLink.link_ref=m["assoc_btl-link_link"];this.newLink.relink_val=m["assoc_btl-link_relink_val"];this.newLink.relink_ref=m["assoc_btl-link_relink"];this.newLink.docType=m["prop_btl-link_docType"];this.newLink.docType_text=this.valueToText(m["prop_btl-link_docType"]);this.newLink.docTypeRelink=m["prop_btl-link_docTypeRelink"];this.newLink.docTypeRelink_text=this.valueToText(m["prop_btl-link_docTypeRelink"]);this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+m.nodeRef.replace("://","/")+"/formprocessor",method:"POST",data:{"assoc_btl-link_link_added":m["assoc_btl-link_link_added"],"assoc_btl-link_link_removed":m["assoc_btl-link_link_removed"],"assoc_btl-link_relink_added":m["assoc_btl-link_relink_added"],"assoc_btl-link_relink_removed":m["assoc_btl-link_relink_removed"],"prop_btl-link_docType":m["prop_btl-link_docType"],"prop_btl-link_docTypeRelink":m["prop_btl-link_docTypeRelink"]},successCallback:this.alfPublish("DATAGRID_EDIT_ROW",this.newLink),callbackScope:this})},onCreateFormlinkType:function e(m){this.alfLog("log","alfresco_formLinkData__onCreateFormLinkData",m);this.data=m.data;this.rootNodeRef=m.rootNodeRef;var n={};n.dialogTitle=m.config.dialogTitle;n.dialogId="FORM_LINK_TYPE";n.contentWidth="650px";n.dialogConfirmationButtonTitle=m.config.dialogConfirmationButtonTitle;n.dialogCancellationButtonTitle=m.config.dialogCancellationButtonTitle;n.formSubmissionTopic=m.config.formSubmissionTopic;n.widgets=this.getWidgets();this.alfLog("log","alfresco_formLinkData__onCreateFormLinkData",n);this.alfPublish("ALF_CREATE_FORM_DIALOG_REQUEST",n)},valueToText:function h(m){var n="";switch(m){case"btl-project:projectDataType":n="Проект";break;case"btl-incomming:documentDataType":n="Входящий";break;case"btl-outgoing:documentDataType":n="Исходящий";break;case"btl-internal:documentDataType":n="Внутренний";break;case"btl-meeting:meetingDataType":n="Мероприятие";break;case"btl-contract:contractTypeData":n="Договор";break;case"0":n="Резолюция по Входящему";break;case"1":n="Задание по исходящему";break;case"2":n="Резолюция по внутреннему";break;case"3":n="Задание по проекту";break;case"4":n="Инициативное задание";break;case"5":n="НТД";break;case"6":n="Дела проектов";break;case"7":n="ОРД";break;case"8":n="Задание по ОРД";break}return n},getWidgets:function d(){var v=[];var u={name:"alfresco/forms/controls/DojoValidationTextBox",config:{label:"Ссылка",name:"prop_btl-link_link",value:(this.data!==null)?this.data.link:"",requirementConfig:{initialValue:true}}};var o={name:"alfresco/buttons/AlfButton",config:{widgets:[{name:"alfresco/forms/controls/SimplePicker"}]}};var r={name:"btl/widgets/base/ItemPicker",config:{name:"assoc_btl-link_link",value:(this.data!==null)?this.data.link_ref:"",labelText:"Ссылка",labelButton:"...",labelPicker:"Выбрать",pickedItemsLabel:"Текущая",availableItemsLabel:"Доступные",propertyToRender:"name",url:"search/linktype",itemUrl:"/share/proxy/alfresco/picker/linkItem?nodeRef="}};var w={name:"alfresco/forms/controls/DojoValidationTextBox",config:{label:"Обратная ссылка",name:"prop_btl-link_relink",value:(this.data!==null)?this.data.relink:"",requirementConfig:{initialValue:true}}};var x={name:"btl/widgets/base/ItemPicker",config:{name:"assoc_btl-link_relink",value:(this.data!==null)?this.data.relink_ref:"",labelText:"Обратная ссылка",labelButton:"...",labelPicker:"Выбрать",pickedItemsLabel:"Текущая",availableItemsLabel:"Доступные",propertyToRender:"name",url:"search/linktype",itemUrl:"/share/proxy/alfresco/picker/linkItem?nodeRef="}};var t={name:"alfresco/forms/controls/Select",config:{fieldId:"docType",label:"Тип ссылки",name:"prop_btl-link_docType",width:"400px",value:(this.data!==null)?this.data.docType:"btl-project:projectDataType",optionsConfig:{fixed:[{label:"Проект",value:"btl-project:projectDataType"},{label:"Входящий",value:"btl-incomming:documentDataType"},{label:"Исходящий",value:"btl-outgoing:documentDataType"},{label:"Внутренний",value:"btl-internal:documentDataType"},{label:"Резолюция по Входящему",value:"0"},{label:"Задание по исходящему",value:"1"},{label:"Резолюция по внутреннему",value:"2"},{label:"Задание по проекту",value:"3"},{label:"Инициативное задание",value:"4"},{label:"НТД",value:"5"},{label:"Дела проектов",value:"6"},{label:"Орд",value:"7"},{label:"Задание по ОРД",value:"8"},{label:"Мероприятие",value:"btl-meeting:meetingDataType"},{label:"Договор",value:"btl-contract:contractTypeData"}]}}};var q={name:"alfresco/forms/controls/Select",config:{fieldId:"docType",label:"Тип обратной ссылки",name:"prop_btl-link_docTypeRelink",width:"400px",value:(this.data!==null)?this.data.docTypeRelink:"btl-project:projectDataType",optionsConfig:{fixed:[{label:"Проект",value:"btl-project:projectDataType"},{label:"Входящий",value:"btl-incomming:documentDataType"},{label:"Исходящий",value:"btl-outgoing:documentDataType"},{label:"Внутренний",value:"btl-internal:documentDataType"},{label:"Резолюция по Входящему",value:"0"},{label:"Задание по исходящему",value:"1"},{label:"Резолюция по внутреннему",value:"2"},{label:"Задание по проекту",value:"3"},{label:"Инициативное задание",value:"4"},{label:"НТД",value:"5"},{label:"Дела проектов",value:"6"},{label:"Орд",value:"7"},{label:"Задание по ОРД",value:"8"},{label:"Мероприятие",value:"btl-meeting:meetingDataType"},{label:"Договор",value:"btl-contract:contractTypeData"}]}}};if(this.data!==null){v.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"nodeRef",value:this.data.nodeRef,visibilityConfig:{initialValue:false}}},{name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"rowId",value:this.data.rowId,visibilityConfig:{initialValue:false}}})}else{v.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"alf_destination",value:this.rootNodeRef,visibilityConfig:{initialValue:false}}})}var n={name:"alfresco/forms/ControlRow",widthPx:200,config:{widgets:[]}};var p={name:"alfresco/forms/ControlRow",widthPx:200,config:{widgets:[]}};var s={name:"alfresco/forms/ControlRow",widthPx:400,config:{widgets:[]}};var m={name:"alfresco/forms/ControlRow",widthPx:400,config:{widgets:[]}};n.config.widgets.push(t);p.config.widgets.push(q);s.config.widgets.push(n,r);m.config.widgets.push(p,x);v.push(s,m);return v}})});