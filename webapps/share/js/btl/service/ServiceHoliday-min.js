define(["dojo/_base/declare","alfresco/core/Core","dojo/_base/lang","alfresco/core/CoreXhr","service/constants/Default"],function(e,g,a,b,c){return e([g,b],{newHoliday:{},constructor:function j(l){a.mixin(this,l);this.alfSubscribe("BTL_CREATE_HOLIDAY",a.hitch(this,this.createHoliday));this.alfSubscribe("BTL_EDIT_HOLIDAY",a.hitch(this,this.editHoliday));this.alfSubscribe("BTL_CREATE_FORM_HOLIDAY",a.hitch(this,this.onCreateFormHoliday))},createHoliday:function h(l){this.alfLog("log","btl_HolidayService__createHoliday",l);this.newHoliday.dayDate=l["prop_btl-utils_dayDate"];this.newHoliday.dayType=l["prop_btl-utils_dayType"];this.serviceXhr({url:"/share/proxy/alfresco/api/type/btl-utils%3aworkScheduleDictionary/formprocessor",method:"POST",data:{alf_destination:l.alf_destination,"prop_btl-utils_dayDate":(l["prop_btl-utils_dayDate"]!==null)?l["prop_btl-utils_dayDate"]:"","prop_btl-utils_dayType":l["prop_btl-utils_dayType"]},successCallback:this.updateHolidayGrid,callbackScope:this})},updateHolidayGrid:function d(n,l){this.newHoliday.nodeRef=n.persistedObject;var m;if(this.newHoliday.dayType=="1"){m="Выходной"}else{m="Рабочий"}var o=this.newHoliday.dayDate;this.newHoliday.dayDate=o.substring(8)+"."+o.substring(5,7)+"."+o.substring(0,4);this.alfPublish("DATAGRID_ADD_ROW",{nodeRef:this.newHoliday.nodeRef,dayDate:this.newHoliday.dayDate,dayType:m})},editHoliday:function k(m){this.alfLog("log","btl_HolidayService__editHoliday",m);this.newHoliday.rowId=m.rowId;this.newHoliday.dayDate=m["prop_btl-utils_dayDate"];this.newHoliday.dayType=m["prop_btl-utils_dayType"];if(this.newHoliday.dayType=="1"){this.newHoliday.dayType="Выходной"}else{this.newHoliday.dayType="Рабочий"}var l=this.newHoliday.dayDate;this.newHoliday.dayDate=l.substring(8)+"."+l.substring(5,7)+"."+l.substring(0,4);this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+m.nodeRef.replace("://","/")+"/formprocessor",method:"POST",data:{"prop_btl-utils_dayDate":(m["prop_btl-utils_dayDate"]!==null)?m["prop_btl-utils_dayDate"]:"","prop_btl-utils_dayType":m["prop_btl-utils_dayType"]},successCallback:this.alfPublish("DATAGRID_EDIT_ROW",this.newHoliday),callbackScope:this})},onCreateFormHoliday:function i(l){this.alfLog("log","alfresco_formHoliday__onCreateFormHoliday",l);this.data=l.data;this.rootNodeRef=l.rootNodeRef;var m={};m.dialogTitle=l.config.dialogTitle;m.dialogConfirmationButtonTitle=l.config.dialogConfirmationButtonTitle;m.dialogCancellationButtonTitle=l.config.dialogCancellationButtonTitle;m.formSubmissionTopic=l.config.formSubmissionTopic;m.widgets=this.getWidgets();this.alfLog("log","alfresco_formHoliday__onCreateFormHoliday",m);this.alfPublish("ALF_CREATE_FORM_DIALOG_REQUEST",m)},getWidgets:function f(){var o=[{value:"1",label:"Выходной"},{value:"0",label:"Рабочий"}];var p="";var l="";if(this.data!=null){var m=this.data.dayDate;p=m.substring(6)+"-"+m.substring(3,5)+"-"+m.substring(0,2);if(this.data.dayType=="Выходной"){l="1"}else{l="0"}}var n=[{name:"meeting/dateTextBox/_DateTextBox",id:"btl-utils_dayDate",config:{additionalCssClasses:"datefield",label:"Дата",name:"prop_btl-utils_dayDate",value:p}},{name:"alfresco/forms/controls/Select",config:{label:"Тип",name:"prop_btl-utils_dayType",value:l,optionsConfig:{fixed:o}}}];if(this.data!==null){n.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"nodeRef",value:this.data.nodeRef,visibilityConfig:{initialValue:false}}},{name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"rowId",value:this.data.rowId,visibilityConfig:{initialValue:false}}})}else{n.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"alf_destination",value:this.rootNodeRef,visibilityConfig:{initialValue:false}}})}return n}})});