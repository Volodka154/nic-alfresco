define(["dojo/_base/declare","alfresco/core/Core","dojo/_base/lang","alfresco/core/CoreXhr","service/constants/Default"],function(d,e,a,b,c){return d([e,b],{data:{},constructor:function h(m){a.mixin(this,m);this.alfSubscribe("BTL_CREATE_DEPARTAMENT",a.hitch(this,this.createDepartment));this.alfSubscribe("BTL_EDIT_DEPARTAMENT",a.hitch(this,this.editDepartment));this.alfSubscribe("BTL_CREATE_FORM_DEPARTAMENT",a.hitch(this,this.onCreateFormDepartment));this.alfSubscribe("BTL_SING_REMOVE_DEPARTAMENT",a.hitch(this,this.signRemoveDepartment))},createDepartment:function j(m){this.alfLog("log","btl_DepartmentService__createDepartment",m);this.data=m;this.data.prop_cm_name=m["prop_btl-depart_name"];this.serviceXhr({url:"/share/proxy/alfresco/api/type/btl-depart%3adepartment-folder/formprocessor",method:"POST",data:this.data,successCallback:this.updataDepartment,callbackScope:this})},editDepartment:function l(m){this.alfLog("log","btl_DepartmentService__editDepartment",m);this.data=m;this.data.prop_cm_name=m["prop_btl-depart_name"];this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+m.nodeRef.replace("://","/")+"/formprocessor",method:"POST",data:this.data,successCallback:this.alfPublish("TREE_EDIT_NODE_ATTRIBUTE",{attribute:{name:"name",value:m["prop_btl-depart_name"]}}),callbackScope:this})},updataDepartment:function g(n,m){this.alfLog("log","btl_DepartmentService__updataDepartment response",n);this.alfLog("log","btl_DepartmentService__updataDepartment originalRequestConfig",m);var o={};o.id=n.persistedObject;o.parent=m.data.alf_destination;o.name=m.data.prop_cm_name;m.data.nodeRef=m.data.alf_destination;this.alfPublish("TREE_ADD_NEW_NODE",o);this.alfPublish("DATAGRID_ADD_ROW",m.data)},onCreateFormDepartment:function f(m){this.alfLog("log","alfresco_formDepartment__onCreateFormDepartment",m);this.data=m.data;this.rootNodeRef=m.rootNodeRef;var n={};n.dialogTitle=m.config.dialogTitle;n.dialogConfirmationButtonTitle=m.config.dialogConfirmationButtonTitle;n.dialogCancellationButtonTitle=m.config.dialogCancellationButtonTitle;n.formSubmissionTopic=m.config.formSubmissionTopic;n.widgets=this.getWidgets();n.dialogId="FORM_DEPARTAMENT";n.contentWidth="450px";this.alfLog("log","alfresco_formDepartment__onCreateFormDepartment",n);this.alfPublish("ALF_CREATE_FORM_DIALOG_REQUEST",n)},getWidgets:function i(){var o=[{value:"Организация",label:"Организация"},{value:"Подразделение",label:"Подразделение"}];var z=[];var y={name:"alfresco/forms/controls/DojoValidationTextBox",id:"btl-depart_name",config:{label:"btl-depart_name.title",name:"prop_btl-depart_name",value:(this.data!==null)?this.data["prop_btl-depart_name"]:"",requirementConfig:{initialValue:true}}};var x={name:"alfresco/forms/controls/DojoValidationTextBox",id:"btl-depart_fullname",config:{label:"btl-depart_fullname.title",name:"prop_btl-depart_fullname",value:(this.data!==null)?this.data["prop_btl-depart_fullname"]:""}};var p={name:"alfresco/forms/controls/DojoValidationTextBox",id:"btl-depart_index",config:{label:"btl-depart_index.title",name:"prop_btl-depart_index",value:(this.data!==null)?this.data["prop_btl-depart_index"]:""}};var n={name:"alfresco/forms/controls/TextArea",id:"btl-depart_address",config:{label:"Адрес",name:"prop_btl-depart_address",value:(this.data!==null)?this.data["prop_btl-depart_address"]:""}};var B={name:"btl/widgets/base/TextBox",config:{label:"Город",name:"prop_btl-depart_city",value:(this.data!==null)?this.data["prop_btl-depart_city"]:""}};var v={name:"btl/widgets/base/TextBox",config:{label:"Район",name:"prop_btl-depart_region",value:(this.data!==null)?this.data["prop_btl-depart_region"]:""}};var m={name:"btl/widgets/base/TextBox",config:{label:"Область (край, республика) ",name:"prop_btl-depart_oblast",value:(this.data!==null)?this.data["prop_btl-depart_oblast"]:""}};var r={name:"alfresco/forms/controls/DojoValidationTextBox",id:"btl-depart_phone",config:{label:"Телефон",name:"prop_btl-depart_phone",value:(this.data!==null)?this.data["prop_btl-depart_phone"]:""}};var q={name:"alfresco/forms/controls/Select",config:{label:"btl-depart_type.title",name:"prop_btl-depart_type",value:(this.data!==null)?this.data["prop_btl-depart_type"]:"",optionsConfig:{fixed:o}}};var s={name:"alfresco/forms/controls/DojoCheckBox",config:{label:"Направление",name:"prop_btl-depart_isDirection",value:(this.data!==null)?this.data["prop_btl-depart_isDirection"]:""}};var u={name:"alfresco/forms/controls/DojoCheckBox",config:{label:"btl-depart_actual.title",name:"prop_btl-depart_actual",value:(this.data!==null)?this.data["prop_btl-depart_actual"]:""}};var t={name:"btl/widgets/base/ItemPicker",config:{name:"assoc_btl-depart_director",value:(this.data)?this.data["assoc_btl-depart_director"]:"",labelText:"btl-depart_director.title",labelButton:"...",labelPicker:"Выбрать",pickedItemsLabel:"Текущая",availableItemsLabel:"Доступные",propertyToRender:"name",itemsProperty:"result",url:"filters/association?type=btl-emp:employee-content&s_field=btl-people:surname&field=btl-people:fio&per_page=500",itemUrl:"/share/proxy/alfresco/picker/associationItem?type=btl-emp:employee-content&field=btl-people:fio&nodeRef="}};var w={name:"btl/widgets/base/btlChoice",config:{name:"assoc_btl-depart_director",header:"Выбрать руководителя",value:(this.data)?this.data["assoc_btl-depart_director"]:"",labelText:"btl-depart_director.title",labelButton:"...",urlList:"/share/proxy/alfresco/filters/association",dataUrl:{type:"btl-emp:employee-content",s_field:"btl-people:fio",field:"btl-people:fio"},itemUrl:"/share/proxy/alfresco/picker/associationItem",dataItemUrl:{type:"btl-emp:employee-content",field:"btl-people:fio"}}};if(this.data!==null){z.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"nodeRef",value:this.data.nodeRef,visibilityConfig:{initialValue:false}}})}else{z.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"alf_destination",value:this.rootNodeRef,visibilityConfig:{initialValue:false}}})}var C={name:"alfresco/forms/ControlRow",config:{widgetMarginLeft:100,widgets:[]}};var A={name:"alfresco/forms/ControlRow",config:{widgetMarginRight:150,widgets:[q,s]}};C.config.widgets.push(y,x,p,r,n,B,v,m,A,w,u);z.push(C);return z},signRemoveDepartment:function k(m){this.alfLog("log","btl_DepartmentService__signRemoveDepartment",m);this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+m.nodeRef.replace("://","/")+"/formprocessor",method:"POST",sync:true,data:{"prop_btl-depart_notActual":"true"},successCallback:this.alfPublish("TREE_DELETE_NODE_FROM_STORE_SUCCESS"),callbackScope:this})},})});