(function(){if(typeof BTLAB=="undefined"){BTLAB={}}var b=false;var c=function(f,e,d){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"updateNode",dataObj:{nodeRef:f,data:{"prop_btl-document_state":e}},successCallback:{fn:d}})};var a=function(d,e){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"api/workflow/activiti%24docCreateTask/formprocessor",dataObj:d,successCallback:{fn:function(f){require(["loading"],function(){b=false;$.LoadingOverlay("hide");if(typeof e=="function"){e(f)}})},scope:this},successMessage:"Поручения созданы и разосланы исполнителям",failureCallback:{fn:function(f){require(["loading"],function(){b=false;$.LoadingOverlay("hide");var g=f&&f.json&&f.json.message||false;if(g){if(g.indexOf("Current user is not user SED")!=-1){g='Только участники группы "Пользователи СЭД" могут создавать задачи'}require(["dojo/topic"],function(h){h.publish("ALF_DISPLAY_PROMPT",{title:"Сбой",message:g})})}})},scope:this}})};BTLAB.createTask=function(e,g,f,d){if(b){require(["dojo/topic"],function(h){h.publish("ALF_DISPLAY_NOTIFICATION",{message:"Создание задач уже запущено"})});return}b=true;require(["loading"],function(){$.LoadingOverlay("show");if(d){c(f,d,function(){$.LoadingOverlay("hide");b=false;BTLAB.createTask(e,g)});return}a(e,g)})}})();