define(["dojo/_base/declare","alfresco/core/Core","dojo/_base/lang","alfresco/core/CoreXhr","service/constants/Default"],function(h,i,b,c,d){return h([i,c],{data:{},rootNodeRef:null,type:"btl-link%3aprojectTemplate",constructor:function k(l){b.mixin(this,l);this.alfSubscribe("BTL_CREATE_projectTemplate",b.hitch(this,this.createprojectTemplate));this.alfSubscribe("BTL_CREATE_FORM_projectTemplate",b.hitch(this,this.onCreateFormprojectTemplate));this.alfSubscribe("BTL_EDIT_projectTemplate",b.hitch(this,this.editprojectTemplate))},createprojectTemplate:function g(l){this.alfLog("log","btl_createprojectTemplateService__createprojectTemplate",l);this.data=l;this.data.name=l["prop_btl-link_name"];this.serviceXhr({url:"/share/proxy/alfresco/api/type/"+this.type+"/formprocessor",method:"POST",data:this.data,successCallback:this.updateprojectTemplateGrid,callbackScope:this})},updateprojectTemplateGrid:function j(m,l){this.alfLog("log","btl_projectTemplateService__updateprojectTemplateGrid",l);this.alfPublish("DATAGRID_ADD_ROW",{nodeRef:m.persistedObject,name:l.data["prop_btl-link_name"]})},editprojectTemplate:function f(l){this.alfLog("log","btl_projectTemplateService__editprojectTemplate",l);this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+l.nodeRef.replace("://","/")+"/formprocessor",method:"POST",data:l,successCallback:this.alfPublish("DATAGRID_EDIT_ROW",{rowId:l.rowId,name:l["prop_btl-link_name"]}),callbackScope:this})},onCreateFormprojectTemplate:function e(l){this.alfLog("log","alfresco_formprojectTemplate__onCreateFormprojectTemplate",l);this.data=l.data;this.rootNodeRef=l.rootNodeRef;var m={};m.dialogTitle=l.config.dialogTitle;m.dialogConfirmationButtonTitle=l.config.dialogConfirmationButtonTitle;m.dialogCancellationButtonTitle=l.config.dialogCancellationButtonTitle;m.formSubmissionTopic=l.config.formSubmissionTopic;m.widgets=this.getWidgets();this.alfLog("log","alfresco_formprojectTemplate__onCreateFormprojectTemplate",m);this.alfPublish("ALF_CREATE_FORM_DIALOG_REQUEST",m)},getWidgets:function a(){var l=[{name:"alfresco/forms/controls/DojoValidationTextBox",config:{label:"Название",name:"prop_btl-link_name",value:(this.data!==null)?this.data.name:""}}];if(this.data!==null){l.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"nodeRef",value:this.data.nodeRef,visibilityConfig:{initialValue:false}}},{name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"rowId",value:this.data.rowId,visibilityConfig:{initialValue:false}}})}else{l.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"alf_destination",value:this.rootNodeRef,visibilityConfig:{initialValue:false}}})}return l}})});