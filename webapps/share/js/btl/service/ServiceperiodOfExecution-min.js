define(["dojo/_base/declare","alfresco/core/Core","dojo/_base/lang","alfresco/core/CoreXhr","service/constants/Default"],function(e,g,b,c,d){return e([g,c],{data:{},rootNodeRef:null,type:"btl-periodOfExecution%3aperiodOfExecutionDataType",constructor:function k(l){b.mixin(this,l);this.alfSubscribe("BTL_CREATE_periodOfExecution",b.hitch(this,this.createperiodOfExecution));this.alfSubscribe("BTL_CREATE_FORM_periodOfExecution",b.hitch(this,this.onCreateFormlinkType));this.alfSubscribe("BTL_EDIT_periodOfExecution",b.hitch(this,this.editperiodOfExecution))},createperiodOfExecution:function a(l){this.alfLog("log","btl_createperiodOfExecutionService__createperiodOfExecution",l);this.data=l;this.data.name=l["prop_btl-periodOfExecution_name"];this.data.time=l["prop_btl-periodOfExecution_time"];this.data.dayType=l["prop_btl-periodOfExecution_dayType"];this.data.taskType=l["prop_btl-periodOfExecution_taskType"];this.data.arm=l["prop_btl-periodOfExecution_star"];this.serviceXhr({url:"/share/proxy/alfresco/api/type/"+this.type+"/formprocessor",method:"POST",data:this.data,successCallback:this.updateperiodOfExecutionGrid,callbackScope:this})},updateperiodOfExecutionGrid:function j(o,l){this.alfLog("log","btl_periodOfExecutionService__updateperiodOfExecutionGrid",l);var n="";if(l.data["prop_btl-periodOfExecution_dayType"]=="0"){n="Рабочий"}if(l.data["prop_btl-periodOfExecution_dayType"]=="1"){n="Календарный"}var m="";if(l.data["prop_btl-periodOfExecution_taskType"]=="0"){m="Резолюция по Входящему"}if(l.data["prop_btl-periodOfExecution_taskType"]=="1"){m="Резолюция по Исходящему"}if(l.data["prop_btl-periodOfExecution_taskType"]=="2"){m="Резолюция по Внутреннему"}if(l.data["prop_btl-periodOfExecution_taskType"]=="3"){m="Резолюция по Проекту"}if(l.data["prop_btl-periodOfExecution_taskType"]=="4"){m="Инициативное задание"}if(l.data["prop_btl-periodOfExecution_taskType"]=="5"){m="Задание по НТД"}if(l.data["prop_btl-periodOfExecution_taskType"]=="8"){m="Задание по ОРД"}var p="&#9734;";if(l.data["prop_btl-periodOfExecution_star"]==true){p="&#9733"}this.alfPublish("DATAGRID_ADD_ROW",{nodeRef:o.persistedObject,name:l.data["prop_btl-periodOfExecution_name"],time:l.data["prop_btl-periodOfExecution_time"],dayType:l.data["prop_btl-periodOfExecution_dayType"],dayTypeName:n,taskType:l.data["prop_btl-periodOfExecution_taskType"],taskTypeName:m,arm:l.data["prop_btl-periodOfExecution_star"],star:p})},editperiodOfExecution:function i(o){this.alfLog("log","btl_periodOfExecutionService__editperiodOfExecution",o);var m="";if(o["prop_btl-periodOfExecution_dayType"]=="0"){m="Рабочий"}if(o["prop_btl-periodOfExecution_dayType"]=="1"){m="Календарный"}var l="";if(o["prop_btl-periodOfExecution_taskType"]=="0"){l="Резолюция по Входящему"}if(o["prop_btl-periodOfExecution_taskType"]=="1"){l="Задание по Исходящему"}if(o["prop_btl-periodOfExecution_taskType"]=="2"){l="Резолюция по Внутреннему"}if(o["prop_btl-periodOfExecution_taskType"]=="3"){l="Задание по Проекту"}if(o["prop_btl-periodOfExecution_taskType"]=="4"){l="Инициативное задание"}if(o["prop_btl-periodOfExecution_taskType"]=="4"){l="Задание по НТД"}if(o["prop_btl-periodOfExecution_taskType"]=="8"){l="Задание по ОРД"}var n="&#9734;";if(o["prop_btl-periodOfExecution_star"]==true){n="&#9733"}this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+o.nodeRef.replace("://","/")+"/formprocessor",method:"POST",data:o,successCallback:this.alfPublish("DATAGRID_EDIT_ROW",{rowId:o.rowId,name:o["prop_btl-periodOfExecution_name"],time:o["prop_btl-periodOfExecution_time"],dayType:o["prop_btl-periodOfExecution_dayType"],dayTypeName:m,taskType:o["prop_btl-periodOfExecution_taskType"],taskTypeName:l,arm:o["prop_btl-periodOfExecution_star"],star:n}),callbackScope:this})},onCreateFormlinkType:function f(l){this.alfLog("log","alfresco_formperiodOfExecution__onCreateFormperiodOfExecution",l);this.data=l.data;this.rootNodeRef=l.rootNodeRef;var m={};m.dialogTitle=l.config.dialogTitle;m.dialogConfirmationButtonTitle=l.config.dialogConfirmationButtonTitle;m.dialogCancellationButtonTitle=l.config.dialogCancellationButtonTitle;m.formSubmissionTopic=l.config.formSubmissionTopic;m.widgets=this.getWidgets();this.alfLog("log","alfresco_formperiodOfExecution__onCreateFormperiodOfExecution",m);this.alfPublish("ALF_CREATE_FORM_DIALOG_REQUEST",m)},dayTypeOptions:[{value:0,label:"Рабочий"},{value:1,label:"Календарный"}],taskTypeOptions:[{value:0,label:"Резолюция по Входящему"},{value:1,label:"Задание по Исходящему"},{value:2,label:"Резолюция по Внутреннему"},{value:3,label:"Задание по Проекту"},{value:4,label:"Инициативное задание"},{value:5,label:"Задание по НТД"},{value:8,label:"Задание по ОРД"}],getWidgets:function h(){var l=[{name:"alfresco/forms/controls/DojoValidationTextBox",config:{label:"Название",name:"prop_btl-periodOfExecution_name",value:(this.data!==null)?this.data.name:""}},{name:"alfresco/forms/controls/DojoValidationTextBox",config:{label:"Количество дней",name:"prop_btl-periodOfExecution_time",value:(this.data!==null)?this.data.time:""}},{name:"alfresco/forms/controls/Select",config:{label:"Тип дня",name:"prop_btl-periodOfExecution_dayType",value:(this.data!==null)?this.data.dayType:"",optionsConfig:{fixed:this.dayTypeOptions}}},{name:"alfresco/forms/controls/Select",config:{label:"Тип задачи",name:"prop_btl-periodOfExecution_taskType",value:(this.data!==null)?this.data.taskType:"",optionsConfig:{fixed:this.taskTypeOptions}}},{name:"alfresco/forms/controls/DojoCheckBox",config:{label:"Отображать в арме",name:"prop_btl-periodOfExecution_star",value:(this.data!==null)?this.data.arm:"",}}];if(this.data!==null){l.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"nodeRef",value:this.data.nodeRef,visibilityConfig:{initialValue:false}}},{name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"rowId",value:this.data.rowId,visibilityConfig:{initialValue:false}}})}else{l.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"alf_destination",value:this.rootNodeRef,visibilityConfig:{initialValue:false}}})}return l}})});