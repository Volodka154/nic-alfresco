define(["dojo/_base/declare","alfresco/core/Core","dojo/_base/lang","alfresco/core/CoreXhr","service/constants/Default"],function(i,k,b,d,f){return i([k,d],{newPosition:{},constructor:function a(l){b.mixin(this,l);this.alfSubscribe("BTL_CREATE_POSITION",b.hitch(this,this.createPosition));this.alfSubscribe("BTL_EDIT_POSITION",b.hitch(this,this.editPosition));this.alfSubscribe("BTL_CREATE_FORM_POSITION",b.hitch(this,this.onCreateFormPosition))},createPosition:function g(l){this.alfLog("log","btl_PositionService__createPosition",l);this.newPosition.name=l["prop_btl-pos_name"];this.newPosition.rang=l["prop_btl-pos_rang"];this.serviceXhr({url:"/share/proxy/alfresco/api/type/btl-pos%3aemployee-position/formprocessor",method:"POST",data:{alf_destination:l.alf_destination,"prop_btl-pos_name":l["prop_btl-pos_name"],"prop_btl-pos_rang":l["prop_btl-pos_rang"]},successCallback:this.updatePositionGrid,callbackScope:this})},updatePositionGrid:function j(m,l){this.newPosition.nodeRef=m.persistedObject;this.alfPublish("DATAGRID_ADD_ROW",{nodeRef:this.newPosition.nodeRef,name:this.newPosition.name,rang:this.newPosition.rang})},editPosition:function c(l){this.alfLog("log","btl_PositionService__editPosition",l);this.newPosition.rowId=l.rowId;this.newPosition.name=l["prop_btl-pos_name"];this.newPosition.rang=l["prop_btl-pos_rang"];this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+l.nodeRef.replace("://","/")+"/formprocessor",method:"POST",data:{"prop_btl-pos_name":l["prop_btl-pos_name"],"prop_btl-pos_rang":l["prop_btl-pos_rang"]},successCallback:this.alfPublish("DATAGRID_EDIT_ROW",this.newPosition),callbackScope:this})},onCreateFormPosition:function e(l){this.alfLog("log","alfresco_formPosition__onCreateFormPosition",l);this.data=l.data;this.rootNodeRef=l.rootNodeRef;var m={};m.dialogTitle=l.config.dialogTitle;m.dialogConfirmationButtonTitle=l.config.dialogConfirmationButtonTitle;m.dialogCancellationButtonTitle=l.config.dialogCancellationButtonTitle;m.formSubmissionTopic=l.config.formSubmissionTopic;m.widgets=this.getWidgets();this.alfLog("log","alfresco_formPosition__onCreateFormPosition",m);this.alfPublish("ALF_CREATE_FORM_DIALOG_REQUEST",m)},getWidgets:function h(){var l=[{name:"alfresco/forms/controls/DojoValidationTextBox",id:"btl-pos_name",config:{label:"btl-pos_name.title",name:"prop_btl-pos_name",value:(this.data!==null)?this.data.name:"",requirementConfig:{initialValue:true}}},{name:"alfresco/forms/controls/DojoValidationTextBox",id:"btl-pos_rang",config:{label:"btl-pos_rang.title",name:"prop_btl-pos_rang",value:(this.data!==null)?this.data.rang:""}}];if(this.data!==null){l.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"nodeRef",value:this.data.nodeRef,visibilityConfig:{initialValue:false}}},{name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"rowId",value:this.data.rowId,visibilityConfig:{initialValue:false}}})}else{l.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"alf_destination",value:this.rootNodeRef,visibilityConfig:{initialValue:false}}})}return l}})});