define(["dojo/_base/declare","alfresco/core/Core","dojo/_base/lang","alfresco/core/CoreXhr","service/constants/Default"],function(g,j,b,d,f){return g([j,d],{newmeetingRooms:{},constructor:function h(l){b.mixin(this,l);this.alfSubscribe("BTL_CREATE_meetingRooms",b.hitch(this,this.createmeetingRooms));this.alfSubscribe("BTL_EDIT_meetingRooms",b.hitch(this,this.editmeetingRooms));this.alfSubscribe("BTL_CREATE_FORM_meetingRooms",b.hitch(this,this.onCreateFormmeetingRooms))},createmeetingRooms:function c(m){this.alfLog("log","btl_meetingRoomsService__createmeetingRooms",m);this.newmeetingRooms.number=m["prop_btl-meetingRooms_number"];this.newmeetingRooms.responsible=m["assoc_btl-meetingRooms_responsible_val"];this.newmeetingRooms.responsible_ref=m["assoc_btl-meetingRooms_responsible_added"];var l="";if(m["prop_btl-meetingRooms_confirmationRequired"]==true){l="&#9745;"}else{l="&#9937;"}this.newmeetingRooms.confirmationRequired=l;this.serviceXhr({url:"/share/proxy/alfresco/api/type/btl-meetingRooms%3ameetingRoomsData/formprocessor",method:"POST",data:{alf_destination:m.alf_destination,"prop_btl-meetingRooms_number":m["prop_btl-meetingRooms_number"],"prop_btl-meetingRooms_confirmationRequired":m["prop_btl-meetingRooms_confirmationRequired"],"assoc_btl-meetingRooms_responsible_added":m["assoc_btl-meetingRooms_responsible_added"],"assoc_btl-meetingRooms_responsible_removed":m["assoc_btl-meetingRooms_responsible_removed"]},successCallback:this.updatemeetingRoomsGrid,callbackScope:this})},updatemeetingRoomsGrid:function k(m,l){this.newmeetingRooms.nodeRef=m.persistedObject;this.alfPublish("DATAGRID_ADD_ROW",{nodeRef:this.newmeetingRooms.nodeRef,number:this.newmeetingRooms.number,confirmationRequired_img:this.newmeetingRooms.confirmationRequired,responsible:this.newmeetingRooms.responsible,responsible_ref:this.newmeetingRooms.responsible_ref})},editmeetingRooms:function a(m){this.alfLog("log","btl_meetingRoomsService__editmeetingRooms",m);this.newmeetingRooms.rowId=m.rowId;this.newmeetingRooms.number=m["prop_btl-meetingRooms_number"];this.newmeetingRooms.confirmationRequired=m["prop_btl-meetingRooms_confirmationRequired"];this.newmeetingRooms.responsible=m["assoc_btl-meetingRooms_responsible_val"];this.newmeetingRooms.responsible_ref=m["assoc_btl-meetingRooms_responsible"];var l="";if(m["prop_btl-meetingRooms_confirmationRequired"]==true){l="&#9745;"}else{l="&#9937;"}this.newmeetingRooms.confirmationRequired_img=l;this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+m.nodeRef.replace("://","/")+"/formprocessor",method:"POST",data:{"prop_btl-meetingRooms_number":m["prop_btl-meetingRooms_number"],"prop_btl-meetingRooms_confirmationRequired":m["prop_btl-meetingRooms_confirmationRequired"],"assoc_btl-meetingRooms_responsible_added":m["assoc_btl-meetingRooms_responsible_added"],"assoc_btl-meetingRooms_responsible_removed":m["assoc_btl-meetingRooms_responsible_removed"]},successCallback:this.alfPublish("DATAGRID_EDIT_ROW",this.newmeetingRooms),callbackScope:this})},onCreateFormmeetingRooms:function e(l){this.alfLog("log","alfresco_formmeetingRooms__onCreateFormmeetingRooms",l);this.data=l.data;this.rootNodeRef=l.rootNodeRef;var m={};m.dialogTitle=l.config.dialogTitle;m.dialogConfirmationButtonTitle=l.config.dialogConfirmationButtonTitle;m.dialogCancellationButtonTitle=l.config.dialogCancellationButtonTitle;m.formSubmissionTopic=l.config.formSubmissionTopic;m.widgets=this.getWidgets();m.contentHeight="200px";this.alfLog("log","alfresco_formmeetingRooms__onCreateFormmeetingRooms",m);this.alfPublish("ALF_CREATE_FORM_DIALOG_REQUEST",m)},getWidgets:function i(){var l=[{name:"btl/widgets/base/TextBox",id:"btl-meetingRooms_number",config:{label:"№ комнаты",name:"prop_btl-meetingRooms_number",value:(this.data!==null)?this.data.number:"",requirementConfig:{initialValue:true}}},{name:"btl/widgets/base/btlChoice",id:"meetingRooms_responsible_id",config:{name:"assoc_btl-meetingRooms_responsible",header:"Выбрать ответственного",value:"",value:(this.data!==null)?this.data.responsible_ref:"",labelText:"Ответственный",labelButton:"...",urlList:"/share/proxy/alfresco/filters/association",dataUrl:{type:"btl-emp:employee-content",s_field:"btl-people:fio",field:"btl-people:fio"},itemUrl:"/share/proxy/alfresco/picker/associationItem",dataItemUrl:{type:"btl-emp:employee-content",field:"btl-people:fio"},requirementConfig:{initialValue:true}}},{name:"alfresco/forms/controls/CheckBox",config:{label:"Требуется подтверждение",name:"prop_btl-meetingRooms_confirmationRequired",value:(this.data!==null)?this.data.confirmationRequired:false}}];if(this.data!==null){l.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"nodeRef",value:this.data.nodeRef,visibilityConfig:{initialValue:false}}},{name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"rowId",value:this.data.rowId,visibilityConfig:{initialValue:false}}})}else{l.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"alf_destination",value:this.rootNodeRef,visibilityConfig:{initialValue:false}}})}return l}})});