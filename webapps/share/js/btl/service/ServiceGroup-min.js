define(["dojo/_base/declare","alfresco/core/Core","dojo/_base/lang","alfresco/core/CoreXhr","service/constants/Default"],function(h,j,c,d,f){return h([j,d],{data:{},constructor:function l(m){c.mixin(this,m);this.alfSubscribe("BTL_CREATE_GROUP",c.hitch(this,this.createGroup));this.alfSubscribe("BTL_EDIT_GROUP",c.hitch(this,this.editGroup));this.alfSubscribe("BTL_CREATE_FORM_GROUP",c.hitch(this,this.onCreateFormGroup));this.alfSubscribe("BTL_SING_REMOVE_GROUP",c.hitch(this,this.signRemoveGroup))},createGroup:function e(m){this.alfLog("log","btl_GroupService__createGroup",m);this.data=m;this.data.prop_cm_name=m["prop_btl-group_name"];this.serviceXhr({url:"/share/proxy/alfresco/api/type/btl-group%3agroup-folder/formprocessor",method:"POST",data:this.data,successCallback:this.updataGroup,callbackScope:this})},editGroup:function i(m){this.alfLog("log","btl_GroupService__editGroup",m);this.data=m;this.data.prop_cm_name=m["prop_btl-group_name"];this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+m.nodeRef.replace("://","/")+"/formprocessor",method:"POST",data:this.data,successCallback:this.alfPublish("TREE_EDIT_NODE_ATTRIBUTE",{attribute:{name:"name",value:m["prop_btl-group_name"]}}),callbackScope:this})},updataGroup:function a(n,m){this.alfLog("log","btl_GroupService__updataGroup response",n);this.alfLog("log","btl_GroupService__updataGroup originalRequestConfig",m);var o={};o.id=n.persistedObject;o.parent=m.data.alf_destination;o.name=m.data.prop_cm_name;m.data.nodeRef=m.data.alf_destination;this.alfPublish("TREE_ADD_NEW_NODE",o);this.alfPublish("DATAGRID_ADD_ROW",m.data)},onCreateFormGroup:function g(m){this.alfLog("log","alfresco_formGroup__onCreateFormGroup",m);this.data=m.data;this.rootNodeRef=m.rootNodeRef;var n={};n.dialogTitle=m.config.dialogTitle;n.dialogConfirmationButtonTitle=m.config.dialogConfirmationButtonTitle;n.dialogCancellationButtonTitle=m.config.dialogCancellationButtonTitle;n.formSubmissionTopic=m.config.formSubmissionTopic;n.widgets=this.getWidgets();n.dialogId="FORM_GROUP";n.contentWidth="450px";this.alfLog("log","alfresco_formGroup__onCreateFormGroup",n);this.alfPublish("ALF_CREATE_FORM_DIALOG_REQUEST",n)},getWidgets:function k(){var m=[];var o={name:"alfresco/forms/controls/DojoValidationTextBox",id:"btl-group_name",config:{label:"btl-group_name.title",name:"prop_btl-group_name",value:(this.data!==null)?this.data["prop_btl-group_name"]:"",requirementConfig:{initialValue:true}}};if(this.data!==null){m.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"nodeRef",value:this.data.nodeRef,visibilityConfig:{initialValue:false}}})}else{m.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"alf_destination",value:this.rootNodeRef,visibilityConfig:{initialValue:false}}})}var n={name:"alfresco/forms/ControlRow",config:{widgetMarginLeft:100,widgets:[]}};n.config.widgets.push(o);m.push(n);return m},signRemoveGroup:function b(m){this.alfLog("log","btl_GroupService__signRemoveGroup",m);this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+m.nodeRef.replace("://","/")+"/formprocessor",method:"POST",sync:true,data:{"prop_btl-group_notActual":"true"},successCallback:this.alfPublish("TREE_DELETE_NODE_FROM_STORE_SUCCESS"),callbackScope:this})},})});