define(["dojo/_base/declare","alfresco/core/Core","dojo/_base/lang","alfresco/core/CoreXhr","service/constants/Default","alfresco/dialogs/AlfDialog","alfresco/core/topics"],function(o,b,s,e,g,d,m){return o([b,e],{constructor:function k(t){s.mixin(this,t);this.alfSubscribe("BTL_CREATE_CONTACTOR",s.hitch(this,this.createContractor));this.alfSubscribe("BTL_EDIT_CONTACTOR",s.hitch(this,this.editContractor));this.alfSubscribe("BTL_CREATE_CONTACT_PERSON",s.hitch(this,this.createContactPerson));this.alfSubscribe("BTL_EDIT_CONTACT_PERSON",s.hitch(this,this.editContactPerson));this.alfSubscribe("BTL_UPDATE_GRID_DATA",s.hitch(this,this.updateGridData));this.alfSubscribe("BTL_DELETE_PERSON",s.hitch(this,this.deletePerson));this.alfSubscribe("BTL_MSG_DELETE_DIALOG",s.hitch(this,this.requestDeleteConfirmation));this.alfSubscribe("BTL_SING_REMOVE_CONTACTOR",s.hitch(this,this.signRemoveContactor));this.alfSubscribe("BTL_SING_REMOVE_CONTACT_PERSON",s.hitch(this,this.signRemoveContactPerson))},currentNodeRef:null,currentPubSubScope:null,newContactPerson:{},createContractor:function l(t){this.alfLog("log","btl_ContractorService__createContractor",t);this.serviceXhr({url:"/share/proxy/alfresco/api/type/btl-contr%3acontractor-folder/formprocessor",method:"POST",data:{alf_destination:t.alf_destination,"prop_btl-contr_name":t["prop_btl-contr_name"],"prop_btl-contr_director":t["prop_btl-contr_director"],"prop_btl-contr_phone":t["prop_btl-contr_phone"],"prop_btl-contr_fax":t["prop_btl-contr_fax"],"prop_btl-contr_email":t["prop_btl-contr_email"],"prop_btl-contr_inn":t["prop_btl-contr_inn"],"prop_btl-contr_kpp":t["prop_btl-contr_kpp"],"prop_btl-contr_information":t["prop_btl-contr_information"],"prop_btl-contr_fullname":t["prop_btl-contr_fullname"],"prop_btl-contr_type":t["prop_btl-contr_type"],"prop_btl-contr_site":t["prop_btl-contr_site"],"prop_btl-contr_address":t["prop_btl-contr_address"],"prop_btl-contr_city":t["prop_btl-contr_city"],"prop_btl-contr_region":t["prop_btl-contr_region"],"prop_btl-contr_oblast":t["prop_btl-contr_oblast"],"prop_btl-contr_notActual":t["prop_btl-contr_notActual"],"prop_btl-contr_position":t["prop_btl-contr_position"],"prop_btl-contr_date_confidentiality":(t["prop_btl-contr_date_confidentiality"]!==null)?t["prop_btl-contr_date_confidentiality"]:"","prop_btl-contr_in_perpetuity":t["prop_btl-contr_in_perpetuity"]},failureCallback:function(v,u){this.alfPublish(m.DISPLAY_NOTIFICATION,{message:"Ошибка при создании контрагента"})},successCallback:t.callbackTopic||this.updateContractorTree,callbackScope:this})},createContactPerson:function j(t){this.alfLog("log","btl_ContractorService__createContactPerson",t);this.currentNodeRef=t.alf_destination;this.newContactPerson.firstname=t["prop_btl-people_firstname"];this.newContactPerson.middlename=t["prop_btl-people_middlename"];this.newContactPerson.surname=t["prop_btl-people_surname"];this.newContactPerson.position=t["prop_btl-person_position"];this.newContactPerson.phone=t["prop_btl-people_phone"];this.newContactPerson.fax=t["prop_btl-people_fax"];this.newContactPerson.alfrescoUser_val=t["assoc_btl-people_user_alfresco_val"];this.newContactPerson.alfrescoUser_ref=t["assoc_btl-people_user_alfresco"];this.newContactPerson.information=t["prop_btl-people_information"];this.newContactPerson.do_not_show_in_the_selection=t.do_not_show_in_the_selection;this.newContactPerson.email=t["prop_btl-people_email"];this.newContactPerson.sex=t["prop_btl-people_sex"];this.newContactPerson.site=t["prop_btl-people_site"];this.newContactPerson.mobile=t["prop_btl-people_mobile"];this.newContactPerson.birthdate=(t["prop_btl-people_birthdate"]!==null)?t["prop_btl-people_birthdate"]:"";this.newContactPerson.date_confidentiality=(t["prop_btl-people_date_confidentiality"]!==null)?t["prop_btl-people_date_confidentiality"]:"";this.newContactPerson.in_perpetuity=t["prop_btl-people_in_perpetuity"];this.newContactPerson.address=(t["prop_btl-person_address"])?t["prop_btl-person_address"]:"";this.newContactPerson.city=(t["prop_btl-person_city"])?t["prop_btl-person_city"]:"";this.newContactPerson.region=(t["prop_btl-person_region"])?t["prop_btl-person_region"]:"";this.newContactPerson.oblast=(t["prop_btl-person_oblast"])?t["prop_btl-person_oblast"]:"";this.serviceXhr({url:"/share/proxy/alfresco/api/type/btl-person%3aperson-content/formprocessor",method:"POST",sync:true,data:{alf_destination:t.alf_destination,"prop_btl-people_firstname":t["prop_btl-people_firstname"],"prop_btl-people_middlename":t["prop_btl-people_middlename"],"prop_btl-people_surname":t["prop_btl-people_surname"],"prop_btl-person_position":t["prop_btl-person_position"],"prop_btl-people_phone":t["prop_btl-people_phone"],"prop_btl-people_fax":t["prop_btl-people_fax"],"assoc_btl-people_user_alfresco_added":t["assoc_btl-people_user_alfresco_added"],"assoc_btl-people_user_alfresco_removed":t["assoc_btl-people_user_alfresco_removed"],"prop_btl-people_information":t["prop_btl-people_information"],"prop_btl-person_close_choice":t["prop_btl-person_close_choice"],"prop_btl-people_email":t["prop_btl-people_email"],"prop_btl-people_sex":t["prop_btl-people_sex"],"prop_btl-person_site":t["prop_btl-person_site"],"prop_btl-people_mobile":t["prop_btl-people_mobile"],"prop_btl-people_birthdate":(t["prop_btl-people_birthdate"]!==null)?t["prop_btl-people_birthdate"]:"","prop_btl-person_date_confidentiality":(t["prop_btl-person_date_confidentiality"]!==null)?t["prop_btl-person_date_confidentiality"]:"","prop_btl-person_in_perpetuity":t["prop_btl-person_in_perpetuity"],"prop_btl-person_address":t["prop_btl-person_address"],"prop_btl-person_city":t["prop_btl-person_city"],"prop_btl-person_region":t["prop_btl-person_region"],"prop_btl-person_oblast":t["prop_btl-person_oblast"],},successCallback:t.callbackTopic||this.updatePersonGrid,callbackScope:this})},editContactPerson:function r(t){this.alfLog("log","btl_ContractorService__editContactPerson",t);this.newContactPerson.firstname=t["prop_btl-people_firstname"];this.newContactPerson.middlename=t["prop_btl-people_middlename"];this.newContactPerson.surname=t["prop_btl-people_surname"];this.newContactPerson.position=t["prop_btl-person_position"];this.newContactPerson.phone=t["prop_btl-people_phone"];this.newContactPerson.fax=t["prop_btl-people_fax"];this.newContactPerson.alfrescoUser_val=t["assoc_btl-people_user_alfresco_val"];this.newContactPerson.alfrescoUser_ref=t["assoc_btl-people_user_alfresco"];this.newContactPerson.information=t["prop_btl-people_information"];this.newContactPerson.close_choice=t["prop_btl-person_close_choice"];this.newContactPerson.email=t["prop_btl-people_email"];this.newContactPerson.sex=t["prop_btl-people_sex"];this.newContactPerson.mobile=t["prop_btl-people_mobile"];this.newContactPerson.site=t["prop_btl-person_site"];this.newContactPerson.birthdate=(t["prop_btl-people_birthdate"]!==null)?t["prop_btl-people_birthdate"]:"";this.newContactPerson.address=(t["prop_btl-person_address"]!==null)?t["prop_btl-person_address"]:"";this.newContactPerson.city=(t["prop_btl-person_city"]!==null)?t["prop_btl-person_city"]:"";this.newContactPerson.region=(t["prop_btl-person_region"]!==null)?t["prop_btl-person_region"]:"";this.newContactPerson.oblast=(t["prop_btl-person_oblast"]!==null)?t["prop_btl-person_oblast"]:"";this.newContactPerson.date_confidentiality=(t["prop_btl-person_date_confidentiality"]!==null)?t["prop_btl-person_date_confidentiality"]:"";this.newContactPerson.in_perpetuity=t["prop_btl-person_in_perpetuity"];this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+t.nodeRef.replace("://","/")+"/formprocessor",method:"POST",data:{"prop_btl-people_firstname":t["prop_btl-people_firstname"],"prop_btl-people_middlename":t["prop_btl-people_middlename"],"prop_btl-people_surname":t["prop_btl-people_surname"],"prop_btl-person_position":t["prop_btl-person_position"],"prop_btl-people_phone":t["prop_btl-people_phone"],"prop_btl-people_fax":t["prop_btl-people_fax"],"assoc_btl-people_user_alfresco_added":t["assoc_btl-people_user_alfresco_added"],"assoc_btl-people_user_alfresco_removed":t["assoc_btl-people_user_alfresco_removed"],"prop_btl-people_information":t["prop_btl-people_information"],"prop_btl-person_close_choice":t["prop_btl-person_close_choice"],"prop_btl-people_email":t["prop_btl-people_email"],"prop_btl-people_sex":t["prop_btl-people_sex"],"prop_btl-people_mobile":t["prop_btl-people_mobile"],"prop_btl-person_site":t["prop_btl-person_site"],"prop_btl-people_birthdate":(t["prop_btl-people_birthdate"]!==null)?t["prop_btl-people_birthdate"]:"","prop_btl-person_date_confidentiality":(t["prop_btl-person_date_confidentiality"]!==null)?t["prop_btl-person_date_confidentiality"]:"","prop_btl-person_in_perpetuity":t["prop_btl-person_in_perpetuity"],"prop_btl-person_address":t["prop_btl-person_address"],"prop_btl-person_city":t["prop_btl-person_city"],"prop_btl-person_region":t["prop_btl-person_region"],"prop_btl-person_oblast":t["prop_btl-person_oblast"],},successCallback:t.callbackTopic||this.alfPublish("DATAGRID_EDIT_ROW_CONTACT_PERSON",this.newContactPerson),callbackScope:this})},addContactPersonToContractor:function a(u,t){this.alfLog("log","btl_ContractorService__addContactPersonToContractor",u);this.newContactPerson.nodeRef=u.persistedObject;this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+this.currentNodeRef.replace("://","/")+"/formprocessor",method:"POST",sync:true,data:{"assoc_btl-contr_persons_added":u.persistedObject},successCallback:this.updatePersonGrid,callbackScope:this})},signRemoveContactor:function h(t){this.alfLog("log","btl_ContractorService__signRemoveContactor",t);this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+t.nodeRef.replace("://","/")+"/formprocessor",method:"POST",sync:true,data:{"prop_btl-contr_notActual":"true"},successCallback:this.alfPublish("DATAGRID_DELETE_ROW_CONTACTOR_SUCCESS"),callbackScope:this})},signRemoveContactPerson:function c(t){this.alfLog("log","btl_ContractorService__signRemoveContactPerson",t);this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+t.nodeRef.replace("://","/")+"/formprocessor",method:"POST",sync:true,data:{"prop_btl-people_notActual":"true"},successCallback:this.alfPublish("DATAGRID_DELETE_ROW_CONTACT_PERSON_SUCCESS"),callbackScope:this})},deletePerson:function n(t){this.alfLog("log","btl_ContractorService__deletePerson",t);this.serviceXhr({url:"/share/proxy/alfresco/slingshot/doclib/action/files?alf_method=delete",method:"POST",data:{nodeRefs:t.nodeRefs},successCallback:this.alfPublish("DATAGRID_REFRESH_DATA"),callbackScope:this})},updatePersonGrid:function q(u,t){this.alfPublish("DATAGRID_ADD_ROW_CONTACT_PERSON",{nodeRef:this.newContactPerson.nodeRef,firstname:this.newContactPerson.firstname,middlename:this.newContactPerson.middlename,surname:this.newContactPerson.surname,position:this.newContactPerson.position,phone:this.newContactPerson.phone,fax:this.newContactPerson.fax,people_user_alfresco_val:this.newContactPerson.people_user_alfresco_val,people_user_alfresco_ref:this.newContactPerson.people_user_alfresco_ref,email:this.newContactPerson.email,information:this.newContactPerson.information,close_choice:this.newContactPerson.close_choice,site:this.newContactPerson.site,dataIndx:this.newContactPerson.dataIndx,birthdate:this.newContactPerson.birthdate,date_confidentiality:this.newContactPerson.date_confidentiality,in_perpetuity:this.newContactPerson.in_perpetuity,sex:this.newContactPerson.sex,mobile:this.newContactPerson.mobile})},updateContractorTree:function p(u,t){var v={};v.nodeRef=u.persistedObject;v.name=t.data["prop_btl-contr_name"];this.alfPublish("DATAGRID_ADD_ROW_CONTACTOR",v)},editContractor:function i(t){this.alfLog("log","btl_ContractorService__editContractor",t);this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+t.nodeRef.replace("://","/")+"/formprocessor",method:"POST",data:{"prop_btl-contr_name":t["prop_btl-contr_name"],"prop_btl-contr_director":t["prop_btl-contr_director"],"prop_btl-contr_phone":t["prop_btl-contr_phone"],"prop_btl-contr_fax":t["prop_btl-contr_fax"],"prop_btl-contr_email":t["prop_btl-contr_email"],"prop_btl-contr_inn":t["prop_btl-contr_inn"].replace(/\s+/g,""),"prop_btl-contr_kpp":t["prop_btl-contr_kpp"].replace(/\s+/g,""),"prop_btl-contr_information":t["prop_btl-contr_information"],"prop_btl-contr_fullname":t["prop_btl-contr_fullname"],"prop_btl-contr_type":t["prop_btl-contr_type"],"prop_btl-contr_site":t["prop_btl-contr_site"],"prop_btl-contr_address":t["prop_btl-contr_address"],"prop_btl-contr_city":t["prop_btl-contr_city"],"prop_btl-contr_region":t["prop_btl-contr_region"],"prop_btl-contr_oblast":t["prop_btl-contr_oblast"],"prop_btl-contr_notActual":t["prop_btl-contr_notActual"],"prop_btl-contr_position":t["prop_btl-contr_position"],"prop_btl-contr_date_confidentiality":(t["prop_btl-contr_date_confidentiality"]!==null)?t["prop_btl-contr_date_confidentiality"]:"","prop_btl-contr_in_perpetuity":t["prop_btl-contr_in_perpetuity"]},successCallback:t.callbackTopic||this.alfPublish("DATAGRID_EDIT_ROW_CONTACTOR",{name:t["prop_btl-contr_name"]}),callbackScope:this})},requestDeleteConfirmation:function f(w){var x=w.confirmationTitle||"crudservice.generic.delete.title";var u=w.confirmationPrompt||"crudservice.generic.delete.prompt";var t=w.confirmationButtonLabel||"crudservice.generic.delete.confirmationButtonLabel";var v=w.cancellationButtonLabel||"crudservice.generic.delete.cancellationButtonLabel";this.alfServicePublish(m.CREATE_DIALOG,{dialogId:"ALF_CRUD_SERVICE_DELETE_CONFIRMATION_DIALOG",dialogTitle:this.message(x),textContent:this.message(u),widgetsButtons:[{id:"ALF_CRUD_SERVICE_DELETE_CONFIRMATION_DIALOG_CONFIRM",name:"alfresco/buttons/AlfButton",config:{label:this.message(t),publishTopic:w.responseTopic,publishPayload:{nodeRef:w.nodeRef}}},{id:"ALF_CRUD_SERVICE_DELETE_CONFIRMATION_DIALOG_CANCEL",name:"alfresco/buttons/AlfButton",config:{label:this.message(v),publishTopic:"close"}}]})}})});