define(["dojo/_base/declare","alfresco/core/Core","dojo/_base/lang","alfresco/core/CoreXhr","service/constants/Default"],function(g,i,c,d,e){return g([i,d],{newregJournal:{},constructor:function f(l){c.mixin(this,l);this.alfSubscribe("BTL_CREATE_REG_JOURNAL",c.hitch(this,this.createregJournal));this.alfSubscribe("BTL_EDIT_REG_JOURNAL",c.hitch(this,this.editregJournal));this.alfSubscribe("BTL_CREATE_FORM_REG_JOURNAL",c.hitch(this,this.onCreateFormregJournal))},createregJournal:function j(l){this.alfLog("log","btl_regJournalService__createregJournal",l);this.newregJournal.name=l["prop_btl-regJournal_name"];this.newregJournal.type=l["prop_btl-regJournal_doctype"];this.newregJournal.format=l["prop_btl-regJournal_format"];this.newregJournal.counter=l["prop_btl-regJournal_counter"];this.newregJournal.isDraft=l["prop_btl-regJournal_isDraft"];if(l["prop_btl-regJournal_doctype"]=="0"){this.newregJournal.typeName="Входящий"}if(l["prop_btl-regJournal_doctype"]=="1"){this.newregJournal.typeName="Исходящий"}if(l["prop_btl-regJournal_doctype"]=="2"){this.newregJournal.typeName="Внутренний"}if(l["prop_btl-regJournal_doctype"]=="3"){this.newregJournal.typeName="НТД"}if(l["prop_btl-regJournal_doctype"]=="4"){this.newregJournal.typeName="Дело проекта"}if(l["prop_btl-regJournal_doctype"]=="5"){this.newregJournal.typeName="Мероприятие"}if(l["prop_btl-regJournal_doctype"]=="6"){this.newregJournal.typeName="ОРД"}if(l["prop_btl-regJournal_doctype"]=="7"){this.newregJournal.typeName="Договор"}this.serviceXhr({url:"/share/proxy/alfresco/api/type/btl-regJournal%3aregJournalData/formprocessor",method:"POST",data:{alf_destination:l.alf_destination,"prop_btl-regJournal_name":l["prop_btl-regJournal_name"],"prop_btl-regJournal_doctype":l["prop_btl-regJournal_doctype"],"prop_btl-regJournal_format":l["prop_btl-regJournal_format"],"prop_btl-regJournal_counter":l["prop_btl-regJournal_counter"],"prop_btl-regJournal_isDraft":l["prop_btl-regJournal_isDraft"]},successCallback:this.updateregJournalGrid,callbackScope:this})},updateregJournalGrid:function b(m,l){this.newregJournal.nodeRef=m.persistedObject;this.alfPublish("DATAGRID_ADD_ROW",{nodeRef:this.newregJournal.nodeRef,name:this.newregJournal.name,doctype:this.newregJournal.doctype,format:this.newregJournal.format,counter:this.newregJournal.counter,typeName:this.newregJournal.typeName,isDraft:(this.newregJournal.isDraft)?'<input type="checkbox"  checked disabled">':'<input type="checkbox"  disabled>'})},editregJournal:function k(l){this.alfLog("log","btl_regJournalService__editregJournal",l);this.newregJournal.rowId=l.rowId;this.newregJournal.name=l["prop_btl-regJournal_name"];this.newregJournal.doctype=l["prop_btl-regJournal_doctype"];this.newregJournal.format=l["prop_btl-regJournal_format"];this.newregJournal.counter=l["prop_btl-regJournal_counter"];this.newregJournal.isDraft=l["prop_btl-regJournal_isDraft"];if(l["prop_btl-regJournal_doctype"]=="0"){this.newregJournal.typeName="Входящий"}if(l["prop_btl-regJournal_doctype"]=="1"){this.newregJournal.typeName="Исходящий"}if(l["prop_btl-regJournal_doctype"]=="2"){this.newregJournal.typeName="Внутренний"}if(l["prop_btl-regJournal_doctype"]=="3"){this.newregJournal.typeName="НТД"}if(l["prop_btl-regJournal_doctype"]=="4"){this.newregJournal.typeName="Дело проекта"}if(l["prop_btl-regJournal_doctype"]=="5"){this.newregJournal.typeName="Мероприятие"}if(l["prop_btl-regJournal_doctype"]=="6"){this.newregJournal.typeName="ОРД"}if(l["prop_btl-regJournal_doctype"]=="7"){this.newregJournal.typeName="Договор"}this.serviceXhr({url:"/share/proxy/alfresco/api/node/"+l.nodeRef.replace("://","/")+"/formprocessor",method:"POST",data:{"prop_btl-regJournal_name":l["prop_btl-regJournal_name"],"prop_btl-regJournal_doctype":l["prop_btl-regJournal_doctype"],"prop_btl-regJournal_format":l["prop_btl-regJournal_format"],"prop_btl-regJournal_counter":l["prop_btl-regJournal_counter"],"prop_btl-regJournal_isDraft":l["prop_btl-regJournal_isDraft"]},successCallback:this.alfPublish("DATAGRID_EDIT_ROW",this.newregJournal),callbackScope:this})},onCreateFormregJournal:function h(l){this.alfLog("log","alfresco_formregJournal__onCreateFormregJournal",l);this.data=l.data;this.rootNodeRef=l.rootNodeRef;var m={};m.dialogTitle=l.config.dialogTitle;m.dialogConfirmationButtonTitle=l.config.dialogConfirmationButtonTitle;m.dialogCancellationButtonTitle=l.config.dialogCancellationButtonTitle;m.formSubmissionTopic=l.config.formSubmissionTopic;m.widgets=this.getWidgets();this.alfLog("log","alfresco_formregJournal__onCreateFormregJournal",m);this.alfPublish("ALF_CREATE_FORM_DIALOG_REQUEST",m)},getWidgets:function a(){var m=[{value:"0",label:"Входящий"},{value:"1",label:"Исходящий"},{value:"2",label:"Внутренний"},{value:"3",label:"НТД"},{value:"4",label:"Дело проекта"},{value:"5",label:"Мероприятие"},{value:"6",label:"ОРД"},{value:"7",label:"Договор"}];var l=[{name:"alfresco/forms/controls/Select",config:{label:"Тип",name:"prop_btl-regJournal_doctype",value:(this.data!==null)?this.data.doctype:"",optionsConfig:{fixed:m}}},{name:"alfresco/forms/controls/DojoValidationTextBox",id:"btl-regJournal_name",config:{label:"Название",name:"prop_btl-regJournal_name",value:(this.data!==null)?this.data.name:"",requirementConfig:{initialValue:true}}},{name:"alfresco/forms/controls/DojoValidationTextBox",id:"btl-regJournal_format",config:{label:"Формат",name:"prop_btl-regJournal_format",value:(this.data!==null)?this.data.format:"",requirementConfig:{initialValue:true}}},{name:"alfresco/forms/controls/DojoValidationTextBox",id:"btl-regJournal_counter",config:{label:"Последний номер",name:"prop_btl-regJournal_counter",value:(this.data!==null)?this.data.counter.toString().replace(/\s+/g,""):"",requirementConfig:{initialValue:true}}},{name:"alfresco/forms/controls/DojoCheckBox",config:{fieldId:"btl-regJournal_isDraft",label:"Проектный",name:"prop_btl-regJournal_isDraft",value:(this.data!==null)?this.data.isDraftBool:"",}}];if(this.data!==null){l.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"nodeRef",value:this.data.nodeRef,visibilityConfig:{initialValue:false}}},{name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"rowId",value:this.data.rowId,visibilityConfig:{initialValue:false}}})}else{l.push({name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"alf_destination",value:this.rootNodeRef,visibilityConfig:{initialValue:false}}})}return l}})});