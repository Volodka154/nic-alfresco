if(typeof BTLAB=="undefined"){BTLAB={}}BTLAB.form=BTLAB.form||{};BTLAB.form.controls=BTLAB.form.controls||{};BTLAB.form.controls.roles=BTLAB.form.controls.roles||{};BTLAB.form.controls.roles.grantRole=function(d,a,c,b){this.options={nodeRef:d,roleEmployeeId:a,roleNameId:c,roleAddButtonId:b,urlEmployee:Alfresco.constants.PROXY_URI+"filters/association?type=btl-emp:employee-content&s_field=btl-people:fio&field=btl-people:fio",urlRole:Alfresco.constants.PROXY_URI+"permission/role/getRoles",param:{lang:"en",button_img:"/share/res/js/lib/combobox/btn.png",sub_info:true,instance:true}};this.init=function(){$("#"+this.options.roleEmployeeId).ajaxComboBox(this.options.urlEmployee,this.options.param);$("#"+this.options.roleNameId).ajaxComboBox(this.options.urlRole,this.options.param);$(".ac_subinfo").css("display","none");var e=this;$("#"+this.options.roleAddButtonId).click(function(){e.sendData()})};this.sendData=function(){if(!this.verify()){require(["dojo/topic"],function(e){e.publish("ALF_DISPLAY_NOTIFICATION",{message:"Заполните поля"})});return}require(["loading"],function(e){$.LoadingOverlay("show")});Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"permission/role/grant",dataObj:{nodeRef:this.options.nodeRef,employee:this.getEmployeeValue(),role:this.getRoleNameValue(),prop_transitions:this.getEmployeeValue()},successCallback:{fn:function(e){require(["loading"],function(f){$.LoadingOverlay("hide")});YAHOO.Bubbling.fire("documentRoleListReload")}}})};this.verify=function(){return this.getEmployeeValue()&&this.getRoleNameValue()};this.getEmployeeValue=function(){var e=this.getSubInfoData($("#"+this.options.roleEmployeeId).attr("sub_info"));return e.nodeRef};this.getRoleNameValue=function(){var e=this.getSubInfoData($("#"+this.options.roleNameId).attr("sub_info"));return e.value};this.getSubInfoData=function(e){if(e){return JSON.parse(e.replace(/'/g,'"'))}return{}};this.init()};