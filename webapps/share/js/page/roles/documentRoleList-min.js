if(typeof BTLAB=="undefined"){BTLAB={}}BTLAB.form=BTLAB.form||{};BTLAB.form.controls=BTLAB.form.controls||{};BTLAB.form.controls.roles=BTLAB.form.controls.roles||{};BTLAB.form.controls.roles.documentRoleList=function(b,d,a,c,e){this.options={nodeRef:b,dataUrl:"permission/role/getInfo",documentPermissionListId:d,documentAlfrescoPermissionListId:a,sourceListDivId:c,targetListDivId:e};this.init=function(){YAHOO.Bubbling.on("documentRoleListReload",this.load,this);this.load()};this.load=function(){var f=this;Alfresco.util.Ajax.jsonGet({url:Alfresco.constants.PROXY_URI+this.options.dataUrl+"?nodeRef="+this.options.nodeRef,successCallback:{fn:function(h){var i=h.json;var j=function(l){var k="/share/page/btl-edit-metadata?nodeRef=workspace://SpacesStore/"+l;return'<a href="'+k+'">'+l+"</a>"};var g=function(l){var m=$("<div>");m.addClass("button-icon-flex");var k=$("<span>");k.addClass("dijitInline");k.addClass("dijitIcon");k.addClass("dijitMenuItemIcon");k.addClass("dijitCommonIcon");k.addClass("icon-delete");k.addClass("btl-icon-16_2");m.append(k);m.click(function(){var n=window.confirm("Вы действительно хотите удалить роль?");if(!n){return}require(["loading"],function(o){$.LoadingOverlay("show")});Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"permission/role/remove",dataObj:{roleId:l},successCallback:{fn:function(o){require(["loading"],function(p){$.LoadingOverlay("hide")});YAHOO.Bubbling.fire("documentRoleListReload")}}})});return m[0]};f.renderTable({containerId:f.options.sourceListDivId,columns:[{name:"authority",title:"authority"},{name:"roleName",title:"roleName"},{name:"id",title:"action",format:g}],rows:i.roles});f.renderTable({containerId:f.options.documentAlfrescoPermissionListId,columns:[{name:"authority",title:"authority"},{name:"permission",title:"permission"},{name:"access",title:"access"}],rows:i.alfrescoPermissions});f.renderTable({containerId:f.options.documentPermissionListId,columns:[{name:"authority",title:"authority"},{name:"roleName",title:"roleName"},{name:"permission",title:"permission"},{name:"sourceDocType",title:"sourceDocType"},{name:"sourceDoc",title:"sourceDoc",format:j}],rows:i.permission});f.renderTable({containerId:f.options.targetListDivId,columns:[{name:"authority",title:"authority"},{name:"roleName",title:"roleName"},{name:"permissionName",title:"permission"},{name:"targetDocRef",title:"targetDocRef"},{name:"uuid",title:"uuid",format:j}],rows:i.targetPermission})}}})};this.renderTable=function(h){var f=$("#"+h.containerId);f.html("");var g=$("<table>");g.addClass("roleListTable");var i=$("<tr>");h.columns.forEach(function(k){var j=$("<th>");j.text(k.title);i.append(j)});g.append(i);h.rows.forEach(function(j){var k=$("<tr>");h.columns.forEach(function(n){var m=$("<td>");var l=j[n.name];if(n.format){l=n.format(l)}m.html(l);k.append(m)});g.append(k)});f.append(g)};this.init()};