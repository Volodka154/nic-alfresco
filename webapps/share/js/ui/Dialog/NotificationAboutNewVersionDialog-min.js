define(["dojo/_base/declare","dojo/dom","dijit/Dialog","dijit/registry","dojo/text!./templates/NotificationAboutNewVersionDialog.html","dojo/_base/xhr"],function(c,f,a,b,d,e){return c([a],{templateString:d,title:"Оповещение о новой версии",style:"width: 870px; height: 800px",notificationNodeRefs:[],postMixInProperties:function(){this.inherited(arguments);this.uid=b.getUniqueId(this.declaredClass.replace(/\./g,"_"))},postCreate:function(){this.inherited(arguments);this.domNode.classList.add("alfresco-dialog-AlfDialog")},addNotificationToForm:function(h,g){this.notificationNodeRefs.push(h.nodeRef);var i=this.templateNotification(h,g);this.set("content",this.get("content")+i)},markAsRead:function(){var h={url:"/share/proxy/alfresco/notification/set-is-read-notification?nodeRefs="+this.notificationNodeRefs.join(","),handleAs:"json",load:function(i){},error:function(i){console.error("Ошибка при отметке оповещений как прочитанных:"+i)}};var g=e.get(h)},templateNotification:function(j,g){var i=250;switch(g){case 1:i=700;break;case 2:i=350;break;case 3:i=300;break}var h="<div style='margin: 20px; margin-top: 0px; max-height: "+i+"px; overflow: auto; min-height: 150px;' class='panel panel-info'><div class='panel-heading'><h2>Версия: "+j.release+". "+j.title+"</h2><span style='float: right'>дата:<i style='padding-left:5px'>"+j.date+"</i></span><div style='clear: both'></div></div><div class='content'>"+j.content+"</div></div>";return h},onCancel:function(){},onSubmit:function(){this.hide()},load:function(){var g=this;Alfresco.util.Ajax.jsonGet({method:"GET",url:"/share/proxy/alfresco/notification/get-new-notification?v="+new Date().getTime(),successCallback:{fn:function(h){var i=h.json;if(i.items&&i.items.length>0){i.items.forEach(function(j){g.addNotificationToForm(j,i.items.length)});g.show();g.markAsRead()}},scope:this}})},onHide:function(){this.destroy()}})});