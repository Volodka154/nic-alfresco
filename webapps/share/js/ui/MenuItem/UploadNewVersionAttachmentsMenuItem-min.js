define(["dojo/_base/declare","./_MenuItem","dojo/topic","jquery",],function(b,d,a,c){return b([d],{label:"Загрузить новую версию",iconClass:"dijitCommonIcon icon-add-new-version btl-icon-16",gridId:null,endPostCreate:function(){this.grid=c("#"+this.gridId);this.fileUpload=Alfresco.getFileUploadInstance()},onClick:function(m){var l=this.getCurrentRow();var g=l.name,i=new Alfresco.util.NodeRef(l.nodeRef),f=l.currentVersionLabel;var h="*";if(g&&new RegExp(/[^\.]+\.[^\.]+/).exec(g)){h="*"+g.substring(g.lastIndexOf("."))}var j={updateNodeRef:i,updateFilename:g,updateVersion:f,suppressRefreshEvent:true,overwrite:true,filter:[{description:"Описание",extensions:h,}],mode:this.fileUpload.MODE_SINGLE_UPDATE,onFileUploadComplete:{fn:function k(e){if(e.successful.length>0){var n=this.fileUpload.uploader.description;if(n&&n.value.length>0){this.attachmentComment=n.value}Alfresco.util.Ajax.jsonPost({method:"POST",url:Alfresco.constants.PROXY_URI+"attachment/set-attachment-comment",dataObj:{attachmentNodeRef:e.successful[0].nodeRef,attachmentComment:(this.attachmentComment)?this.attachmentComment:"",},})}a.publish("refreshAttachmentsGrid")},scope:this,},};this.fileUpload.show(j)},})});