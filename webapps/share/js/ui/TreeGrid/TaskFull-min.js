define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/topic","dojo/text!./templates/TaskFull.html","../uiLib","jquery","jqgrid-locale-ru","jqgrid",],function(c,b,e,a,d,f,g){return c([b,e],{templateString:d,formId:"",nodeId:null,colModel:[{name:"nodeRef",index:"nodeRef",key:true,hidden:true},{name:"name",index:"name",label:"Название",width:170},{name:"author",index:"author",label:"Автор",width:100},{name:"executor",index:"executor",label:"Исполнитель",width:100},{name:"currentExecutor",index:"currentExecutor",label:"Текущий исполнитель",width:100},{name:"controller",index:"controller",label:"Контролер",width:100},{name:"state",index:"state",label:"Состояние",width:100},{name:"endDate",index:"endDate",sorttype:"date",label:"Срок",width:80},{name:"color",index:"color",hidden:true},{name:"boss_id",hidden:true},{name:"lft",hidden:true},{label:"Действия",name:"actions",hidden:true,width:50,formatter:"actions",formatoptions:{keys:true,editbutton:false,delbutton:true,delOptions:{url:"/share/proxy/alfresco/events/delete",mtype:"GET"}}},],startup:function(i,h){g("#tab_tasks_full_"+this.formId+"-grid-tree").jqGrid({url:"/share/proxy/alfresco/task/get-tasks-list-tree?nodeid="+this.nodeId,colModel:this.colModel,beforeRequest:function(){if(this.p.postData.nodeid!=null){var k=this.p.postData.nodeid;g("#tab_tasks_full_"+this.formId+"-grid-tree").setRowData(k,{loaded:"true"});this.p.url="/share/proxy/alfresco/task/get-tasks-list-tree"}},loadComplete:function(){var k=g("#tab_tasks_full_"+this.formId+"-grid-tree").getDataIDs();for(var l=0;l<k.length;l++){var m=g("#tab_tasks_full_"+this.formId+"-grid-tree").getRowData(k[l]);if(m.color!=""){g("#tab_tasks_full_"+this.formId+"-grid-tree").setRowData(k[l],false,{background:m.color})}}},ondblClickRow:function(k){if(i){h.nodeRef=k;i(false,h)}else{window.location.href="/share/page/btl-edit-metadata?nodeRef="+k+"&redirect="+window.location.href;a.publish("ALF_DISPLAY_NOTIFICATION",{message:"Перенаправление на задачу."})}},width:"997",hoverrows:false,viewrecords:false,gridview:true,height:"auto",sortname:"name",loadonce:false,rowNum:100,scrollrows:true,treeGrid:true,ExpandColumn:"name",treedatatype:"json",treeGridModel:"adjacency",treeReader:{parent_id_field:"boss_id",level_field:"level",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},sortorder:"asc",datatype:"json"});Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=ALFRESCO_ADMINISTRATORS",successCallback:{fn:function j(k){if(k.json.result=="true"){g("#tab_tasks_full_"+this.formId+"-grid-tree").showCol("actions")}},scope:this}})}})});