define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_Container","dojo/topic","../MenuBar/BaseAttachMenuBar","../TreeGrid/AttachmentsTreeGrid"],function(f,e,d,c,b,a){return f([e,d],{parentNodeRef:"",formId:"",isReadOnly:false,postMixInProperties:function(){this.inherited(arguments);c.subscribe("refreshAttachmentsGrid",this.refreshAttachmentsGrid.bind(this));c.subscribe("SELECT_ROW_ATTACHMENTS_TREE_GRID",this.changeStageMenuBar.bind(this))},postCreate:function(){this.attachTreeGrid=new a({parentNodeRef:this.parentNodeRef,formId:this.formId,attachmentComment:this.attachmentComment,linkDownloadEcpElemId:this.linkDownloadEcpElemId})},render:function(){this.addChild(this.attachTreeGrid);this.attachTreeGrid.startup();this.menuBar=new b({gridId:this.attachTreeGrid.uid,parentNodeRef:this.parentNodeRef,contentType:this.contentType,attachmentComment:this.attachmentComment,readOnly:this.readOnly});this.addChild(this.menuBar,0);this.menuBar.setStageNotVisible();this.setOnLoadMenuStage()},refreshAttachmentsGrid:function(g){this.attachTreeGrid.nodeGrid.trigger("reloadGrid")},setOnLoadMenuStage:function(){Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"slingshot/doclib/node/"+this.parentNodeRef.replace("://","/"),successCallback:{fn:function(g){if(g.json.item.permissions.userAccess.create==true){this.menuBar.setStageBase()}else{this.menuBar.setStageReadOnly();this.isReadOnly=true}},scope:this}})},changeStageMenuBar:function(i){if(i.level!=0){(this.isReadOnly)?this.menuBar.setStageReadOnly():this.menuBar.setStageVersionNode()}else{var g=i.nodeRef;if(this.isReadOnly){this.menuBar.setStageReadOnly()}else{var j=this;Alfresco.util.Ajax.jsonGet({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/node/"+g.replace("://","/"),successCallback:{fn:function h(k){if(k.json.isSigned){j.menuBar.setStageSignedNode()}else{if(k.json.item.status!=""){j.menuBar.setStageBlockingRootNode()}else{if((j.isAdmin&&j.isAdmin=="true")||(k.json.item.permissions.userAccess["delete"]==true&&(Alfresco.constants.USERNAME==i.created))){j.menuBar.setStageRootNode()}else{j.menuBar.setStageEditOnly()}}}},scope:this}})}}}})});