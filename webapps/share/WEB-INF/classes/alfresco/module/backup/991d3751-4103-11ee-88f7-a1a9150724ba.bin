var $gridProject="";function showProject(){require(["jquery","pqgrid","pqselect","jquery-ui.datepicker-ru"],function(a){Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"v2/groupPermission?username="+Alfresco.constants.USERNAME,successCallback:{fn:function(e){var b=e.json.groups;var d=b.indexOf("GROUP_ALFRESCO_ADMINISTRATORS")!==-1;var f=d||b.indexOf("GROUP_EEO")!==-1||b.indexOf("GROUP_CLERK")!==-1;var c=d||b.indexOf("GROUP_Пользователи СЭД")!==-1;var g=d||b.indexOf("GROUP_BTLab_ProjectCreator")!==-1;creategridProject(d,f,c,g)},scope:this}})})}function creategridProject(i,a,g,e){var b=getDefaultPq();var k=[{"1":"Активные"},{"0":"Идея"},{"2":"Закрыт"}];var d=[{"0":"Научный"},{"1":"Общедеятельный"},{"2":"Аванпроект"}];var c=[{"0":"Заявка"},{"1":"НТС"},{"2":"Утверждение"},{"3":"Реализация"},{"4":"Завершение"}];var h=[{title:"nodeRef",width:100,dataType:"string",dataIndx:"nodeRef",hidden:true,align:"center"},{title:"Шифр",width:150,dataType:"string",dataIndx:"btl-project:shortName",filter:{type:"textbox",condition:"contain",listeners:["change"]}},{title:"Начало проекта",minWidth:160,width:160,dataType:"date",dataIndx:"btl-project:startDate",filter:{type:"textbox",condition:"between",init:pqDatePicker,listeners:["change"]}},{title:"Руководитель проекта",width:200,dataType:"string",dataIndx:"btl-project:projectManager-login",filter:{type:"select",condition:"equal",options:document.emploeeDoc,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%"})}}},{title:"Направление",width:300,dataType:"string",dataIndx:"btl-project:directionDepartment-ref",filter:{type:"select",condition:"equal",options:[],prepend:{"":""},listeners:["change"],init:function(l){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%",url:"/share/proxy/alfresco/filters/association?type=btl-depart:department-folder&s_field=name&field=name",urlItem:"/share/proxy/alfresco/picker/associationItem?type=btl-depart:department-folder&field=name",value:l.column.filter.value})}}},{title:"Тип проекта",width:150,dataType:"string",dataIndx:"btl-project:projectType",sortable:false,filter:{type:"select",style:"height:32px;",condition:"equal",options:d,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%"})},}},{title:"Стадия",width:150,dataType:"string",dataIndx:"btl-project:stage",sortable:false,filter:{type:"select",style:"height:32px;",condition:"equal",options:c,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%"})},}},{title:"Организация-исполнитель",width:400,dataType:"string",dataIndx:"btl-project:executionOrganization-ref",filter:{type:"select",condition:"equal",options:[],prepend:{"":""},listeners:["change"],init:function(l){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%",url:"/share/proxy/alfresco/filters/association?type=btl-contr:contractor-folder&s_field=name&field=name",urlItem:"/share/proxy/alfresco/picker/associationItem?type=btl-contr:contractor-folder&field=name",value:l.column.filter.value})}}},{title:"Состояние",width:140,dataType:"string",dataIndx:"btl-project:state",sortable:false,filter:{type:"select",style:"height:32px;",condition:"equal",options:k,prepend:{"":""},value:"1",listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%"})},}}];if(i||e){h.unshift({title:"<input type='checkbox' onclick='selectAllInGrid(this, $gridProject)'>",dataIndx:"sel",width:30,align:"center",type:"checkBoxSelection",cls:"ui-state-default",resizable:false,sortable:false})}var f={location:"remote",sorting:"remote",dataType:"JSON",method:"GET",data:b.dataCache,sortIndx:"btl-project:startDate",sortDir:"down",getUrl:function(l){if($(this).pqGrid("option","isInit2")!==true){$(this).pqGrid("option","isInit2",true);$(this).pqGrid("option","currentCountId","f2ProjectCurrentCount");$(this).pqGrid("option","totalCountId","f2ProjectTotalCount");$(this).pqGrid("option","dataUrl","/share/proxy/alfresco/documents/v2/search-registry-project");addPaginationBlock($(this))}return getUrl2($(this),b)},getData:function(l){return getData2($(this),l,b)},error:function(l,n,m){error2(l,n,m)}};var j={selectionModel:{type:"none",subtype:"incr",cbHeader:false,cbAll:true},dataModel:f,collapsible:false,editable:false,colModel:h,filterModel:{on:true,mode:"AND",header:true},width:"100%",height:835,beforeSort:function(l,m){beforeSort2($(this))},beforeFilter:function(l,m){beforeFilter2($(this))},beforeTableView:function(l,m){beforeTableView2(m,b,$(this))},rowDblClick:function(l,m){openModalEdit(m.rowData.nodeRef,$(this))}};j.title="";if(g){j.title+="<button type='button' onclick='addDocProject()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary' role='button'><span class='ui-button-icon-primary ui-icon ui-icon-plus'></span><span class='ui-button-text'>Создать</span></button>"}if(i||e){j.title+="<button type='button'  style='margin-left: 5px'  onclick='deleteProjects()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary' role='button'><span class='ui-button-icon-primary ui-icon ui-icon-cancel'></span><span class='ui-button-text'>Удалить</span></button>"}j.title+="<button type='button'  style='margin-left: 5px' onclick='prnPtoject()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary' role='button'><span class='ui-button-icon-primary ui-icon ui-icon-print'></span><span class='ui-button-text'>Печать</span></button>";j.title+="<button type='button'  style='margin-left: 5px'  onclick='clearGridFilters($gridProject)' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary' role='button'><span class='ui-button-icon-primary ui-icon ui-icon-cancel'></span><span class='ui-button-text'>Очистить</span></button><button type='button' style='margin-left: 5px' onclick='refreshDataAndView($gridProject)' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-only' role='button'><span class='ui-button-text'>Обновить</span></button>";$gridProject=$("#grid_project").pqGrid(j)}function deleteProjects(){deleteSelected($gridProject,"Вы действительно хотите удалить выбранные проекты?")}require(["jquery"],function(a){a(document).ready(function(){a("#li_tab14").click(function(){if($gridProject==""){showProject()}})})});function prnPtoject(){var a=$gridProject;var b=a.pqGrid("option","dataUrl")+".html?"+getGridParamsStr(a,{pq_sort:JSON.stringify(getSort(a.pqGrid("option","dataModel")))});window.open(b,"_blank")};