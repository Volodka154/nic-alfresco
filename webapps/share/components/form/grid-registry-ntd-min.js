var totalRecordsNTD=0;var $gridNTD="";var $FilterNTD="/share/proxy/alfresco/documents/search-ntd?q_state="+encodeURI(encodeURI("Активные"));var groupNTD=null;var idAddArch=0;var $filterProject=null;function showNTD(){var a=[];require(["jquery","pqgrid","pqselect","jquery-ui.datepicker-ru"],function(d){var b=false;Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=ALFRESCO_ADMINISTRATORS",successCallback:{fn:function c(e){if(e.json.result=="true"){idAddArch=1;addArchInNTD(1,1,a)}else{Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=EEO",successCallback:{fn:function f(g){if(g.json.result=="true"){if(b==false){idAddArch=1;addArchInNTD(1,0,a)}}else{Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=CLERK",successCallback:{fn:function h(i){if(i.json.result=="true"){if(b==false){idAddArch=1;addArchInNTD(1,0,a)}}else{addArchInNTD(0,0,a)}},scope:this}})}},scope:this}})}},scope:this}})})}function createGridNTD(c,a,e){var f=[{"Активные":"Активные"},{"Черновик":"Черновик"},{"Зарегистрирован":"Зарегистрирован"},{"В архиве":"В архиве"},{"Все":"Все"}];e.push({title:"nodeRef",width:100,dataType:"string",dataIndx:"nodeRef",hidden:true,align:"center"},{title:"Дата регистрации",minWidth:160,width:160,dataType:dateType,dataIndx:"btl-document:regDate",filter:{type:"textbox",condition:"between",init:pqDatePicker,listeners:["change"]}},{title:"Инвентарный номер",minWidth:100,dataType:"string",dataIndx:"btl-document:regNumber",filter:{type:"textbox",condition:"contain",listeners:["change"]}},{title:"Том",minWidth:120,width:120,dataType:"string",dataIndx:"btl-ntd:tom"},{title:"Название",minWidth:150,dataType:"string",dataIndx:"btl-document:name",filter:{type:"textbox",condition:"contain",listeners:["change"]}},{title:"Ф.И.О. работника, сдавшего НТД",minWidth:100,dataType:"string",dataIndx:"btl-document:author-login",filter:{type:"select",condition:"equal",options:document.emploeeDoc,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%"})},}},{title:"Шифр проекта (аванпроекта)",minWidth:100,dataType:"string",dataIndx:"btl-document:project-ref",filter:{type:"select",condition:"equal",options:[],prepend:{"":""},listeners:["change"],init:function(g){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%",url:"/share/proxy/alfresco/filters/association?type=btl-project:projectDataType&s_field=shortName&field=shortName",urlItem:"/share/proxy/alfresco/picker/associationItem?type=btl-project:projectDataType&field=shortName",value:g.column.filter.value})}}},{title:"Вид НТД",minWidth:100,dataType:"string",dataIndx:"btl-document:docType-ref",filter:{type:"select",condition:"equal",options:typedocNTD.result,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"contain",width:"100%"})}}},{title:"Дата и номер сопроводительного документа",minWidth:150,dataType:"string",dataIndx:"btl-ntd:document-content",filter:{type:"textbox",condition:"contain",listeners:["change"]}},{title:"Примечание",minWidth:200,dataType:"string",dataIndx:"btl-document:content",filter:{type:"textbox",condition:"contain",listeners:["change"]}},{title:"Количество листов/брошюр/МНИ",minWidth:100,dataType:"string",dataIndx:"btl-ntd:sheetsCount"},{title:"Состояние",width:160,dataType:"string",dataIndx:"state",filter:{type:"select",style:"height:32px;",condition:"equal",options:f,listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Активные",searchRule:"begin",width:"100%"})},}},{title:"Вид носителя",minWidth:100,dataType:"string",dataIndx:"btl-ntd:viewMedia"});var d={location:"remote",sorting:"local",dataType:"JSON",method:"GET",url:$FilterNTD+"&totalRecords="+totalRecordsNTD+"&format=json",getData:function(k){var j=k.items;totalRecordsNTD=k.totalRecords;for(var g=0;g<k.items.length;g++){if(k.items[g]["btl-ntd:viewMedia"]==0){k.items[g]["btl-ntd:viewMedia"]="Книга"}if(k.items[g]["btl-ntd:viewMedia"]==1){k.items[g]["btl-ntd:viewMedia"]="Брошюра"}if(k.items[g]["btl-ntd:viewMedia"]==2){k.items[g]["btl-ntd:viewMedia"]="Флэшнакопитель"}if(k.items[g]["btl-ntd:viewMedia"]==3){k.items[g]["btl-ntd:viewMedia"]="CD-диск"}if(k.items[g]["btl-ntd:viewMedia"]==4){k.items[g]["btl-ntd:viewMedia"]="DVD-диск"}if(k.items[g]["btl-ntd:viewMedia"]==5){k.items[g]["btl-ntd:viewMedia"]="А4 – А0"}if(k.items[g]["btl-ntd:viewMedia"]==6){k.items[g]["btl-ntd:viewMedia"]="А4"}if(k.items[g]["btl-ntd:viewMedia"]==7){k.items[g]["btl-ntd:viewMedia"]="А3"}if(k.items[g]["btl-ntd:viewMedia"]==8){k.items[g]["btl-ntd:viewMedia"]="А2"}if(k.items[g]["btl-ntd:viewMedia"]==9){k.items[g]["btl-ntd:viewMedia"]="А1"}if(k.items[g]["btl-ntd:viewMedia"]==10){k.items[g]["btl-ntd:viewMedia"]="А0"}var h=new Object;h[k.items[g]["btl-document:project-content"]]=k.items[g]["btl-document:project-content"]}return{curPage:k.curPage,totalRecords:k.totalRecords,data:j}}};var b={selectionModel:{type:"none",subtype:"incr",cbHeader:false,cbAll:true},showTop:true,showHeader:true,showTitle:true,flexHeight:true,flexWidth:true,dataModel:d,collapsible:false,pageModel:{type:"remote",rPP:100,strRpp:"{0}",rPPOptions:[25,50,100]},colModel:e,filterModel:{on:true,mode:"AND",header:true},editable:false,columnBorders:true,width:"100%",height:600,beforeFilter:function(g,h){totalRecordsNTD=0;$("#grid_ntd").pqGrid("option","dataModel").url=$FilterNTD+"&totalRecords="+totalRecordsNTD+"&format=json";$gridNTD.pqGrid("option","pageModel.curPage",1)},create:function(h){var g=$(this),i=g.find(".pq-grid-bottom").find(".pq-pager");if(i&&i.length){i=i.detach();g.find(".pq-grid-top").append(i)}}};b.title="<button type='button' onclick='backHome()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";b.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-home'></span><span class='ui-button-text'>Домой</span></button>";b.title+="<span style='margin-left: 10px ; margin-bottom: -5px' class='pq-separator '></span>";b.title+="<button type='button'  style='margin-left: 10px' onclick='addDocNTD()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";if(c==1){b.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-plus'></span><span class='ui-button-text'>Создать</span></button>";b.title+="<button type='button'  style='margin-left: 5px'  onclick='toArchNTD()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";b.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-cancel'></span><span class='ui-button-text'>В архив</span></button>"}if(a==1){b.title+="<button type='button'  style='margin-left: 5px'  onclick='deleteNTD()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";b.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-cancel'></span><span class='ui-button-text'>Удалить</span></button>"}b.title+="<span style='margin-left: 10px ; margin-bottom: -5px' class='pq-separator '></span>";b.title+="<button type='button'  style='margin-left: 10px' onclick='prnNtd()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";b.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-print'></span><span class='ui-button-text'>Печать</span></button>";b.title+="<span style='margin-left: 10px ; margin-bottom: -5px' class='pq-separator '></span>";b.title+="<button type='button'  style='margin-left: 10px' onclick='updateFilter(true)' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'role='button'><span class='ui-button-icon-primary ui-icon ui-icon-refresh'></span></span><span class='ui-button-text'>Обновить списки фильтрации</span></button>";b.title+="<button type='button'  style='margin-left: 5px'  onclick='clearDocFilter($gridNTD)' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";b.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-cancel'></span><span class='ui-button-text'>Очистить</span></button>";$gridNTD=$("#grid_ntd").pqGrid(b);$gridNTD.pqGrid({beforeTableView:function(g,h){$("#grid_ntd").pqGrid("option","dataModel").url=$FilterNTD+"&totalRecords="+totalRecordsNTD+"&format=json";$("span:contains('Дополнительно')").parent().prop("disabled",true).prop("disabled",true).removeClass("pq-select-option-label ui-state-enable pq-state-hover").addClass("fd")}});$(".fNTD").pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"150px"}).on("change",function(g){});$(".f2Group").pqSelect({singlePlaceholder:"Нет",width:"150px"});$gridNTD.one("pqgridload",function(g,h){$gridNTD.pqGrid("refreshView")});$gridNTD.pqGrid({rowDblClick:function(g,h){openModalEdit(h.rowData.nodeRef,$gridNTD)},rowRightClick:function(h,i){var j=document.getElementById("contextmenu");j.style.display="block";x=h.pageX;y=h.pageY;j.style.left=x+"px";j.style.top=y+"px";var g=document.getElementById("menuItemCreateCopy");g.nodeRef=i.rowData.nodeRef;g.onclick=function(){var k=document.getElementById("contextmenu");k.style.display="";addDocNTDCreate(this.nodeRef)};return false}})}function toArchNTD(){var a=window.confirm("Вы действительно хотите изменить статус у выбранных документов?");if(a){var b=$gridNTD.pqGrid("option","dataModel.data");$gridNTD.pqGrid("showLoading");$.each(b,function(c,d){if(d.sel==true){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"taskDocAction",dataObj:{nodeRef:d.nodeRef,action:"docInArhive",},successCallback:{fn:function(e){}}})}});$gridNTD.pqGrid("hideLoading");$gridNTD.pqGrid("refreshDataAndView");$gridNTD.pqGrid({flexHeight:true})}}function deleteNTD(){deleteSelected($gridNTD,"Вы действительно хотите удалить выбранные документы?")}function selAllNTD(){require(["jquery"],function(a){if(a("#selAllNTD").prop("checked")){a("#selAllNTD").prop("checked",false);$gridNTD.pqGrid("selection",{type:"row",all:"all",method:"removeAll"})}else{a("#selAllNTD").attr("checked","checked");a("#selAllNTD").prop("checked",true);$gridNTD.pqGrid("selection",{type:"row",all:"all",method:"selectAll"})}})}function addArchInNTD(b,a,c){idCreate=true;if(b==1){c.push({title:"<input type='checkbox' id='selAllNTD' onclick='selAllNTD()'>",dataIndx:"sel",width:30,align:"center",type:"checkBoxSelection",cls:"ui-state-default",resizable:false,sortable:false})}createGridNTD(b,a,c)}require(["jquery"],function(a){a(document).ready(function(){a("#li_tab9").click(function(){if($gridNTD==""){showNTD($FilterNTD+"&format=json")}})})});function prnNtd(){window.open($FilterNTD+"&format=html&q_viewType=1"+prepareLocalFilter($gridNTD),"_blank")};