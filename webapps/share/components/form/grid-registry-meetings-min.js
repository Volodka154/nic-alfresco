var totalRecordsMeetings=0;var $gridMeetings="";var $FilterMeetings="/share/proxy/alfresco/documents/search-regestry-meetings?q_state="+encodeURI(encodeURI("Активные"));var groupMeetings=null;var idAddArch=0;function showMeetings(){var c=[];require(["jquery","pqgrid","pqselect","jquery-ui.datepicker-ru"],function(f){var d=false;Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=ALFRESCO_ADMINISTRATORS",successCallback:{fn:function e(g){if(g.json.result=="true"){idAddArch=1;addArchInMeetings(1,1,c)}else{Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=EEO",successCallback:{fn:function h(i){if(i.json.result=="true"){if(d==false){idAddArch=1;addArchInMeetings(1,0,c)}}else{Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=CLERK",successCallback:{fn:function j(k){if(k.json.result=="true"){if(d==false){idAddArch=1;addArchInMeetings(1,0,c)}}else{addArchInMeetings(0,0,c)}},scope:this}})}},scope:this}})}},scope:this}})})}function createGridMeetings(e,c,h){var g=[{"Активные":"Активные"},{"Черновик":"Черновик"},{"Зарегистрирован":"Зарегистрирован"},{"На исполнении":"На исполнении"},{"На согласовании":"На согласовании"},{"Согласован":"Согласован"},{"На подписании":"На подписании"},{"На регистрации":"На регистрации"},{"На доработке":"На доработке"},{"Подтверждение переговорной":"Подтверждение переговорной"},{"Переговорная подтверждена":"Переговорная подтверждена"},{"Подготовлен":"Подготовлен"},{"В архиве":"В архиве"},{"Все":"Все"}];h.push({title:"nodeRef",width:100,dataType:"string",dataIndx:"nodeRef",hidden:true,align:"center"},{title:"Файл",width:40,dataType:"string",dataIndx:"fileExists"},{title:"Рег. номер",minWidth:70,dataType:"string",dataIndx:"btl-meeting:number",filter:{type:"textbox",condition:"contain",listeners:["change"]}},{title:"Дата регистрации",minWidth:160,width:160,dataType:dateType,dataIndx:"btl-meeting:regDate",filter:{type:"textbox",condition:"between",init:pqDatePicker,listeners:["change"]}},{title:"Секретарь",minWidth:150,dataType:"string",dataIndx:"btl-meeting:secretary-login",filter:{type:"select",condition:"equal",options:document.emploeeDoc,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%"})},}},{title:"Председатель",minWidth:150,dataType:"string",dataIndx:"btl-meeting:chairman-login",filter:{type:"select",condition:"equal",options:document.emploeeDoc,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%"})},}},{title:"Тема",minWidth:170,dataType:"string",dataIndx:"btl-meeting:theme",filter:{type:"textbox",condition:"contain",listeners:["change"]}},{title:"Начало",minWidth:130,width:130,dataType:dateType,dataIndx:"btl-meeting:startDate",filter:{type:"textbox",condition:"between",init:pqDatePicker,listeners:["change"]}},{title:"Окончание",minWidth:130,width:130,dataType:dateType,dataIndx:"btl-meeting:endDate",filter:{type:"textbox",condition:"between",init:pqDatePicker,listeners:["change"]}},{title:"Состояние",minWidth:140,width:140,dataType:"string",dataIndx:"state",prepend:{"":""},filter:{type:"select",style:"height:32px;",condition:"equal",options:g,listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Активные",searchRule:"begin",width:"100%"})},}},{title:"Место проведения",minWidth:100,dataType:"string",dataIndx:"btl-meeting:room-content"});var f={location:"remote",sorting:"remote",dataType:"JSON",method:"GET",url:$FilterMeetings+"&totalRecords="+totalRecordsMeetings+"&format=json",getData:function(j){var i=j.items;totalRecordsMeetings=j.totalRecords;return{curPage:j.curPage,totalRecords:j.totalRecords,data:i}}};var d={selectionModel:{type:"none",subtype:"incr",cbHeader:false,cbAll:true},showTop:true,showHeader:true,showTitle:true,flexHeight:true,flexWidth:true,dataModel:f,collapsible:false,pageModel:{type:"remote",rPP:100,strRpp:"{0}",rPPOptions:[25,50,100]},colModel:h,filterModel:{on:true,mode:"AND",header:true},editable:false,columnBorders:true,width:"100%",height:600,beforeFilter:function(i,j){totalRecordsMeetings=0;$("#grid_meetings").pqGrid("option","dataModel").url=$FilterMeetings+"&totalRecords="+totalRecordsMeetings+"&format=json";$gridMeetings.pqGrid("option","pageModel.curPage",1)},create:function(j){var i=$(this),k=i.find(".pq-grid-bottom").find(".pq-pager");if(k&&k.length){k=k.detach();i.find(".pq-grid-top").append(k)}}};d.title="<button type='button' onclick='backHome()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";d.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-home'></span><span class='ui-button-text'>Домой</span></button>";d.title+="<span style='margin-left: 10px ; margin-bottom: -5px' class='pq-separator '></span>";d.title+="<button type='button'  style='margin-left: 10px' onclick='addDocMeetings()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";d.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-plus'></span><span class='ui-button-text'>Создать</span></button>";if(c==1){d.title+="<button type='button'  style='margin-left: 5px'  onclick='deleteMeetings()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";d.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-cancel'></span><span class='ui-button-text'>Удалить</span></button>"}$gridMeetings=$("#grid_meetings").pqGrid(d);$gridMeetings.pqGrid({beforeTableView:function(i,j){$("#grid_meetings").pqGrid("option","dataModel").url=$FilterMeetings+"&totalRecords="+totalRecordsMeetings+"&format=json";$("span:contains('Дополнительно')").parent().prop("disabled",true).prop("disabled",true).removeClass("pq-select-option-label ui-state-enable pq-state-hover").addClass("fd")}});$(".fMeetings").pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"150px"}).on("change",function(i){});$(".f2Group").pqSelect({singlePlaceholder:"Нет",width:"150px"});$gridMeetings.one("pqgridload",function(i,j){});$gridMeetings.pqGrid({rowDblClick:function(i,j){openModalMeetingsing(j.rowData.nodeRef)}})}function openModalMeetingsing(c){document.frameSave=function(){document.getElementById(modalWindowShadow).style.display="none";document.body.style.overflow="";$gridMeetings.pqGrid("refreshDataAndView")};document.frameCancel=function(){document.getElementById(modalWindowShadow).style.display="none";document.body.style.overflow="";$gridMeetings.pqGrid("refreshDataAndView")};var e=document.getElementById(modalWindowShadow);e.style.display="block";var d=document.getElementById(frameBackground);d.innerHTML='<iframe id="viewDocFrame" style="border-radius: 4px;" width="100%" height="100%" src="/share/page/dp/ws/meeting-rooms?nodeRef='+c+'&frame=true">'}function toArchMeetings(){var c=window.confirm("Вы действительно хотите изменить статус у выбранных документов?");if(c){var d=$gridMeetings.pqGrid("option","dataModel.data");$gridMeetings.pqGrid("showLoading");$.each(d,function(e,f){if(f.sel==true){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"taskDocAction",dataObj:{nodeRef:f.nodeRef,action:"docInArhive",},successCallback:{fn:function(g){}}})}});$gridMeetings.pqGrid("hideLoading");$gridMeetings.pqGrid("refreshDataAndView");$gridMeetings.pqGrid({flexHeight:true})}}function deleteMeetings(){deleteSelected($gridMeetings,"Вы действительно хотите удалить выбранные мероприятия?")}function printNotExe(){window.open("/share/proxy/alfresco/documents/search-regestry-kid","_blank")}function prnIncomming2(){window.open($FilterMeetings+"&format=html&q_viewType=1"+prepareLocalFilter($gridMeetings),"_blank")}function selAllMeetings(){require(["jquery"],function(c){if(c("#selAllMeetings").prop("checked")){c("#selAllMeetings").prop("checked",false);$gridMeetings.pqGrid("selection",{type:"row",all:"all",method:"removeAll"})}else{c("#selAllMeetings").attr("checked","checked");c("#selAllMeetings").prop("checked",true);$gridMeetings.pqGrid("selection",{type:"row",all:"all",method:"selectAll"})}})}function filterOnOutNum(c,e){if(c!=null){event=c.currentTarget.value}var d=[{dataIndx:"btl-Meetings:outgoingNumber",condition:"contain",value:event}];$gridMeetings.pqGrid("filter",{oper:"add",data:d})}function addArchInMeetings(d,c,e){idCreate=true;if(d==1){e.push({title:"<input type='checkbox' id='selAllMeetings' onclick='selAllMeetings()'>",dataIndx:"sel",width:30,align:"center",type:"checkBoxSelection",cls:"ui-state-default",resizable:false,sortable:false})}createGridMeetings(d,c,e)}require(["jquery","pqgrid"],function(c){});window.onload=function(){a=document.getElementById("a");b=document.getElementById("b")};function showA(){b.style.filter="alpha(opacity=80)";b.style.opacity=0.8;b.style.display="block";a.style.display="block";a.style.top="50%";a.style.left="50%";a.style.position="absolute";a.style.marginLeft="-100px";a.style.marginTop="-75px"}function hideA(){b.style.display="none";a.style.display="none"}require(["jquery"],function(c){c(document).ready(function(){c("#li_tab13").click(function(){if($gridMeetings==""){showMeetings($FilterMeetings+"&format=json")}})})});