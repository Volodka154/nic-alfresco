var IDViewReport=0;require(["jquery","pqgrid","pqselect","jquery-ui.datepicker-ru"],function(b){Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=ALFRESCO_ADMINISTRATORS",successCallback:{fn:function a(c){if(c.json.result=="false"){}else{b("#searchNotExe").css("display","block");b("#searchKID").css("display","block");b("#add_incoming_doc_btn").css("display","block");b("#state_in_adv_div").css("display","block");IDViewReport=1}},scope:this}});Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=CLERK",successCallback:{fn:function a(c){if(c.json.result=="false"){}else{b("#searchNotExe").css("display","block");b("#searchKID").css("display","block");b("#add_incoming_doc_btn").css("display","block");IDViewReport=1}},scope:this}});Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=EEO",successCallback:{fn:function a(c){if(c.json.result=="false"){}else{b("#searchNotExe").css("display","block");b("#searchKID").css("display","block");b("#state_in_adv_div").css("display","block");IDViewReport=1}},scope:this}})});var dateType=function(e,b){var d=$.trim(e).split("-");if(d.length<2){return -1}var f=new Date(d[2],d[1],d[0]);var a=$.trim(b).split("-");if(a.length<2){return 1}var c=new Date(a[2],a[1],a[0]);if(f>c){return 1}else{if(f<c){return -1}else{return 0}}};function pqDatePicker(a){var b=$(this);b.css({zIndex:3,position:"relative"}).datepicker({dateFormat:"dd-mm-yy",yearRange:"-20:+20",changeYear:true,changeMonth:true,onClose:function(c,d){}}).attr("autocomplete","off")}function backHome(){window.location.href="/share/page"}function refreshFilterType(a){var b=a.pqGrid("option","dataModel");b=b.data;b.sort(function(h,g){if(h.docType<g.docType){return -1}if(h.docType>g.docType){return 1}return 0});var f=[{docType:b[0].docType}];for(var c=1;c<b.length;c++){if(b[c].docType!=b[c-1].docType){f.push({docType:b[c].docType})}}var e=a.pqGrid("getColumn",{dataIndx:"docType"});var d=e.filter;d.cache=null;d.options=f}function refreshFilterRecipient(b,a){var c=b.pqGrid("option","dataModel");c=c.data;c.sort(function(i,h){if(i.recipient<h.recipient){return -1}if(i.recipient>h.recipient){return 1}return 0});var g=[{recipient:c[0].recipient}];for(var d=1;d<c.length;d++){if(c[d].recipient!=c[d-1].recipient){g.push({recipient:c[d].recipient})}}var f=b.pqGrid("getColumn",{dataIndx:"recipient"});var e=f.filter;e.cache=null;e.options=g}function refreshFilterHeader(a,f){var b=a.pqGrid("option","dataModel");b=b.data;b.sort(function(j,i){if(j[f]<i[f]){return -1}if(j[f]>i[f]){return 1}return 0});var g=[f];var h=[{q:b[0][f]}];for(var c=1;c<b.length;c++){if(b[c][f]!=b[c-1][f]){h.push({q:b[c][f]})}}var e=a.pqGrid("getColumn",{dataIndx:[f]});var d=e.filter;d.cache=null;d.options=h}function clearDocFilter(a){require(["jquery"],function(g){var c=a.pqGrid("getColModel");for(var f=0,b=c.length;f<b;f++){var d=c[f].dataIndx;try{delete c[f].filter.value;delete c[f].filter.value2}catch(h){value=null}}g("input").val("");a.pqGrid("refreshDataAndView")})}function prepareLocalFilter(m){var j=false;var d='{"mode":"AND","data":[';var b=m.pqGrid("getColModel");for(var c=0,f=b.length;c<f;c++){var a="";var l=null;var k=null;var h=b[c].dataIndx;try{a=b[c].filter.condition;l=b[c].filter.value;if(l!=null){j=true;if(a=="between"){k=b[c].filter.value2;if(l!=""&&k!=""){l=l+'","value2":"'+k}else{if(l!=""){a="gte"}else{if(k!=""){a="lte";l=k}}}}d+='{"dataIndx":"'+h+'","value":"'+l+'","condition":"'+a+'","dataType":"string","cbFn":""},'}}catch(g){}}if(j==true){d=d.substr(0,d.length-1);d+="]}";d=d.replace(/\{/gi,"%7B").replace(/\[/gi,"%5B").replace(/\:/gi,"%3A").replace(/\//gi,"%2F").replace(/\,/gi,"%2C").replace(/\}/gi,"%7D").replace(/\]/gi,"%5D");return"&pq_filter="+d}else{return""}}function deleteSelected(e,c){var b=window.confirm(c);if(b){var f=e.pqGrid("option","dataModel.data");e.pqGrid("showLoading");var a=[];var d=[];$.each(f,function(g,h){if(h.sel==true){d.push(g);a.push(h.nodeRef)}});e.pqGrid("selection",{type:"row",all:"all",method:"removeAll"});d.forEach(function(g){e.pqGrid("deleteRow",{rowIndx:g})});if(a.length==0){refreshTable(e)}else{e.pqGrid("option","isResetData",true);Alfresco.util.Ajax.jsonPost({url:"/share/proxy/alfresco/slingshot/doclib/action/files?alf_method=delete",dataObj:{nodeRefs:a},successCallback:{fn:function(g){refreshTable(e)}},failureCallback:{fn:function(g){refreshTable(e);Alfresco.util.PopupManager.displayPrompt({title:"Ошибка удаления",text:getFormattedDateTime(new Date())+"\nОдин или несколько документов удалить не удалось"})}}})}}}function getFormattedDateTime(a){return("0"+a.getDate()).slice(-2)+"."+("0"+(a.getMonth()+1)).slice(-2)+"."+a.getFullYear()+" "+("0"+a.getHours()).slice(-2)+":"+("0"+a.getMinutes()).slice(-2)}function refreshTable(a){a.pqGrid("hideLoading");a.pqGrid("refreshDataAndView")};