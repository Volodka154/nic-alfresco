var $gridContract="";var $FilterContract="/share/proxy/alfresco/documents/search-contract?q_state="+encodeURI(encodeURI("Активные"));var groupContract=null;function showContract(){require(["jquery","pqgrid","pqselect","jquery-ui.datepicker-ru"],function(b){Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=ALFRESCO_ADMINISTRATORS",successCallback:{fn:function a(c){if(c.json.result=="true"){createContract(1)}else{createContract(0)}},scope:this}})})}function createContract(b){var f=[{"Договор":"Договор"},{"ДС":"ДС"},];var c=[{"Проект":"Проект"},{"На согласовании":"На согласовании"},{"На доработке":"На доработке"},{"Согласован":"Согласован"},{"На регистрации":"На регистрации"},{"Отозван":"Отозван"},{"Отменен":"Отменен"},{"Зарегистрирован":"Зарегистрирован"},{"Действует":"Действует"}];var a=[];if(b){a.push({title:"<input type='checkbox' id='selAllContracts' onclick='selAllContracts()'>",dataIndx:"sel",width:30,align:"center",type:"checkBoxSelection",cls:"ui-state-default",resizable:false,sortable:false})}a.push({title:"nodeRef",width:100,dataType:"string",dataIndx:"nodeRef",hidden:true,},{title:"Файл",dataType:"string",dataIndx:"fileExists",},{title:"Дата создания",minWidth:160,width:160,dataType:dateType,dataIndx:"cm:created",filter:{type:"textbox",condition:"between",init:pqDatePicker,listeners:["change"]},},{title:"Тип",minWidth:200,dataType:"string",dataIndx:"btl-contract:type",filter:{type:"select",condition:"equal",options:f,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"contain",width:"100%"})},},},{title:"Вид договора",minWidth:160,width:160,dataType:"string",dataIndx:"btl-document:docType-ref",cls:"just",filter:{type:"select",condition:"contain",options:{},prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%",url:encodeURI(encodeURI('/share/proxy/alfresco/filters/association?type=btl-docType:docTypeData&s_field=name&field=name&filter=type:"Договор"'))})},},},{title:"docTypes",dataIndx:"docTypes",hidden:true},{title:"Номер",minWidth:100,dataType:"string",dataIndx:"btl-document:regNumber",filter:{type:"textbox",condition:"contain",listeners:["change"]},},{title:"Дата регистрации",minWidth:160,width:160,dataType:dateType,dataIndx:"btl-document:regDate",filter:{type:"textbox",condition:"between",init:pqDatePicker,listeners:["change"]},},{title:"Контрагент(ы)",minWidth:160,width:160,dataType:"string",dataIndx:"btl-contract:contractors-ref",cls:"just",filter:{type:"select",condition:"contain",options:document.organizations,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%",url:"/share/proxy/alfresco/filters/association?type=btl-contr:contractor-folder&s_field=name&field=name"})},},},{title:"contragents",dataIndx:"contragents",hidden:true},{title:"Номер контрагента",minWidth:120,dataType:"string",dataIndx:"btl-contract:numberContractor",filter:{type:"textbox",condition:"contain",listeners:["change"]},},{title:"Состояние",minWidth:120,dataType:"string",dataIndx:"btl-document:state",filter:{type:"select",condition:"equal",options:c,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"contain",width:"100%"})},},},{title:"Предмет",minWidth:180,dataType:"string",dataIndx:"btl-contract:summaryContract",filter:{type:"textbox",condition:"contain",listeners:["change"]},});var d={location:"remote",sorting:"local",dataType:"JSON",method:"GET",url:$FilterContract+"&format=json",getData:function(h){$gridContract.pqGrid("showLoading");var g=h.items;return{curPage:h.curPage,totalRecords:h.totalRecords,data:g}},};var e={selectionModel:{type:"none",subtype:"incr",cbHeader:false,cbAll:true},showTop:true,showHeader:true,showTitle:true,flexHeight:true,flexWidth:true,dataModel:d,collapsible:false,pageModel:{type:"remote",rPP:100,strRpp:"{0}",rPPOptions:[25,50,100],},colModel:a,filterModel:{on:true,mode:"AND",header:true},editable:false,columnBorders:true,width:"100%",height:600,beforeFilter:function(g,h){$gridContract.pqGrid("option","pageModel.curPage",1)},create:function(h){var g=$(this),i=g.find(".pq-grid-bottom").find(".pq-pager");if(i&&i.length){i=i.detach();g.find(".pq-grid-top").append(i)}},};e.title="<button type='button' onclick='backHome()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";e.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-home'></span><span class='ui-button-text'>Домой</span></button>";e.title+="<span style='margin-left: 10px ; margin-bottom: -5px' class='pq-separator '></span>";e.title+="<span style='margin-left: 10px ; margin-bottom: -5px' class='pq-separator '></span>";e.title+="<button type='button'  style='margin-left: 10px' onclick='addContract()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";e.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-plus'></span><span class='ui-button-text'>Создать</span></button>";if(b==1){e.title+="<button type='button'  style='margin-left: 5px'  onclick='deleteContract()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";e.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-cancel'></span><span class='ui-button-text'>Удалить</span></button>"}e.title+="<button type='button'  style='margin-left: 10px' onclick='prnContract()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";e.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-print'></span><span class='ui-button-text'>Печать</span></button>";e.toolbar={items:[{type:"<span>Группировка: </span>"},{type:"select",cls:"combo-pg fGroupContract",prepend:{"":""},options:["Тип","Вид договора",],listeners:[{change:function(g){if($gridContract.pqGrid("option","groupModel")!=null){$gridContract.pqGrid("option","groupModel.collapsed",[false,false,false]);$gridContract.pqGrid("refreshView")}switch($(this).val()){case"Тип":groupContract="btl-contract:type";break;case"Вид договора":groupContract="btl-document:docType-ref";break;default:groupContract=null}var h=null;if(groupContract!=null){h={dataIndx:[groupContract],collapsed:[true],title:["<b style='font-weight:bold;'>{0} ({1})</b>","{0} - {1}"],dir:["up","down"],}}$gridContract.pqGrid("option","groupModel",h);$gridContract.pqGrid("refreshDataAndView")},},],},{type:'<span style="margin-left: 7px"></span>'},{type:"button",label:"Очистить",listeners:[{click:function(g){clearDocFilter($gridContract)},}],icon:"ui-icon-cancel",},],};$gridContract=$("#grid_contract").pqGrid(e);$gridContract.pqGrid({rowDblClick:function(g,h){openModalEditContract(h.rowData.nodeRef,$gridContract)},});$gridContract.one("pqgridload",function(g,h){$("#tabs").tabs("option","disabled",-1);$gridContract.pqGrid("refreshHeader")});$(".fGroupContract").pqSelect({singlePlaceholder:"Нет",width:"150px",search:"false",})}document.onclick=function(){document.getElementById("contextmenu").style.display=""};function clearOutDocFilter(){$FilterContract="/share/proxy/alfresco/documents/search-contract?q_state="+encodeURI(encodeURI("Активные"));$gridContract.pqGrid("destroy");showContract()}function openModalEditContract(b,a){document.activeGrid=a;document.frameSave=function(){document.getElementById(modalWindowShadow).style.display="none";document.body.style.overflow="";$gridContract.pqGrid("refreshDataAndView")};document.frameCancel=function(){document.getElementById(modalWindowShadow).style.display="none";document.body.style.overflow="";$gridContract.pqGrid("refreshDataAndView")};var d=document.getElementById(modalWindowShadow);d.style.display="block";var c=document.getElementById(frameBackground);c.innerHTML='<iframe id="viewDocFrame" style="border-radius: 4px;" width="100%" height="100%" src="/share/page/arm/contract?nodeRef='+b+'&frame=true">'}function addContract(c){setSaveCancelFunction($gridContract);var b=document.getElementById(modalWindowShadow);b.style.display="block";var a=document.getElementById(frameBackground);a.innerHTML='<iframe id="viewDocFrame" style="border-radius: 4px;" width="100%" height="100%" src="/share/page/arm/contract">';document.body.style.overflow="hidden"}function prnContract(){window.open($FilterContract+"&format=html&q_viewType=1"+prepareLocalFilter($gridContract),"_blank")}function selAllContract(){require(["jquery"],function(a){if(a("#selAllContract").prop("checked")){a("#selAllContract").prop("checked",false);$gridContract.pqGrid("selection",{type:"row",all:"all",method:"removeAll"})}else{a("#selAllContract").attr("checked","checked");a("#selAllContract").prop("checked",true);$gridContract.pqGrid("selection",{type:"row",all:"all",method:"selectAll"})}})}function deleteContract(){deleteSelected($gridContract,"Вы действительно хотите удалить выбранные договоры?")}require(["jquery"],function(a){a(document).ready(function(){a("#li_tab15").click(function(){if($gridContract==""){showContract($FilterContract+"&format=json")}})})});