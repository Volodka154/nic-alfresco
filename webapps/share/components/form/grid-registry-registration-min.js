var $gridRegistration="";var $FilterRegistration="/share/proxy/alfresco/documents/search-regestry-inout?q_state="+encodeURI(encodeURI("На регистрации"));var groupRegistration=null;var $filterDoc=null;var $filterAuthor=null;function getcolMIn(){var b=[];var a=[];if(isClerk){a.push({"Внутренний":"Внутренний"},{"Исходящий":"Исходящий"},{"Входящий":"Входящий"},{"ОРД":"ОРД"})}if(isContract){a.push({"Договор":"Договор"})}b.push({title:"nodeRef",width:100,dataType:"string",dataIndx:"nodeRef",hidden:true},{title:"Файл",minWidth:100,dataType:"string",dataIndx:"fileExists"},{title:"Вид",minWidth:100,dataType:"string",dataIndx:"docType",filter:{type:"select",condition:"equal",options:a,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"contain",width:"100%"})},}},{title:"recipientNodeRef",dataIndx:"recipientNodeRef",hidden:true},{title:"Инициатор",width:200,dataType:"string",dataIndx:"btl-document:author-login",filter:{type:"select",style:"height:32px;",condition:"equal",options:document.emploeeDoc,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"contain",width:"100%"})},}},{title:"Содержание",width:300,dataType:"string",dataIndx:"btl-document:content",filter:{type:"textbox",condition:"contain",listeners:["change"]}},{title:"Тип документа",minWidth:200,dataType:"string",dataIndx:"btl-document:docType-ref",filter:{type:"select",condition:"equal",options:null,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"contain",width:"100%"})}}},{title:"Контрагент",minWidth:200,dataType:"string",dataIndx:"contractor"},{title:"Статус",minWidth:200,dataType:"string",dataIndx:"state"});return b}function showRegistration(){$("#tabs").tabs("option","disabled",-1);var a={location:"remote",sorting:"local",dataType:"JSON",method:"GET",url:$FilterRegistration+"&format=json",getData:function(g){$gridRegistration.pqGrid("showLoading");var e=g.items;$filterDoc=[];$filterAuthor=[];tempDoc=[];tempAuthor=[];for(var d=0;d<e.length;d++){var f=new Object;f[e[d]["docTypeNodeRef"]]=e[d]["btl-document:docType-ref"];if(tempDoc.indexOf(e[d]["docTypeNodeRef"])<0){$filterDoc.push(f);tempDoc.push(e[d]["docTypeNodeRef"])}var c=new Object;c[e[d]["autorNodeRef"]]=e[d]["btl-document:author-login"];if(tempAuthor.indexOf(e[d]["autorNodeRef"])<0){$filterAuthor.push(c);tempAuthor.push(e[d]["autorNodeRef"])}}return{curPage:g.curPage,totalRecords:g.totalRecords,data:g.items}}};var b={selectionModel:{type:"none",subtype:"incr",cbHeader:false,cbAll:true},showTop:true,showHeader:true,showTitle:true,flexHeight:true,flexWidth:true,dataModel:a,collapsible:false,pageModel:{type:"remote",rPP:100,strRpp:"{0}",rPPOptions:[25,50,100]},colModel:getcolMIn(),filterModel:{on:true,mode:"AND",header:true},editable:false,columnBorders:true,width:"100%",height:600,beforeFilter:function(c,d){$gridRegistration.pqGrid("option","pageModel.curPage",1)},create:function(d){var c=$(this),e=c.find(".pq-grid-bottom").find(".pq-pager");if(e&&e.length){e=e.detach();c.find(".pq-grid-top").append(e)}}};b.toolbar={items:[{type:"<span>Группировка: </span>"},{type:"select",cls:"combo-pg fRegistrationGroup",prepend:{"":""},options:["Вид","Тип документа"],listeners:[{change:function(c){if($gridRegistration.pqGrid("option","groupModel")!=null){$gridRegistration.pqGrid("option","groupModel.collapsed",[false,false,false]);$gridRegistration.pqGrid("refreshView")}switch($(this).val()){case"Вид":groupRegistration="docType";break;case"Тип документа":groupRegistration="btl-document:docType-ref";break;default:groupRegistration=null}var d=null;if(groupRegistration!=null){d={dataIndx:[groupRegistration],collapsed:[true],title:["<b style='font-weight:bold;'>{0} ({1})</b>","{0} - {1}"],dir:["up","down"]}}$gridRegistration.pqGrid("option","groupModel",d);$gridRegistration.pqGrid("refreshDataAndView")}}]},{type:'<span style="margin-left: 7px"></span>'},{type:"button",label:"Очистить",listeners:[{click:function(c){clearDocFilter($gridRegistration);regElementCount()}}],icon:"ui-icon-cancel"}]};$gridRegistration=$("#grid_registration").pqGrid(b);$gridRegistration.pqGrid({beforeTableView:function(c,d){$("span:contains('Дополнительно')").parent().prop("disabled",true).prop("disabled",true).removeClass("pq-select-option-label ui-state-enable pq-state-hover").addClass("fd")}});$gridRegistration.one("pqgridload",function(c,d){$("#tabs").tabs("option","disabled",-1);$gridRegistration.pqGrid("refreshHeader");var f=$gridRegistration.pqGrid("getColumn",{dataIndx:"btl-document:docType-ref"}).filter;f.cache=null;f.options=$filterDoc;var e=$gridRegistration.pqGrid("getColumn",{dataIndx:"btl-document:author-login"}).filter;e.cache=null;e.options=$filterAuthor;$gridRegistration.pqGrid("refreshView")});$gridRegistration.pqGrid({rowDblClick:function(c,d){openModalEdit(d.rowData.nodeRef,$gridRegistration,d.rowData.link)}});$(".fRegistrationGroup").pqSelect({singlePlaceholder:"Нет",width:"150px",search:"false"})}require(["jquery"],function(a){a(document).ready(function(){a("#li_tab5").click(function(){if($gridRegistration==""){showRegistration($FilterRegistration+"&format=json")}})})});