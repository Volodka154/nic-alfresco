var $gridFullSearch="";var $FilterFullSearch="/share/proxy/alfresco/documents/fullTextSearch?text=''";var groupFullSearch=null;function showFullSearch(){var b=[{title:"nodeRef",width:100,dataType:"string",dataIndx:"nodeRef",hidden:true,},{title:"Дата создания",minWidth:260,width:360,dataType:dateType,dataIndx:"cm:created",filter:{type:"textbox",condition:"between",init:pqDatePicker,listeners:["change"]},},{title:"Тип документа",minWidth:300,dataType:"string",dataIndx:"typeText",filter:{type:"textbox",condition:"contain",listeners:["change"]},},{title:"Номер",minWidth:300,dataType:"string",dataIndx:"btl-document:regNumber",filter:{type:"textbox",condition:"contain",listeners:["change"]},},{title:"Дата регистрации",minWidth:360,width:360,dataType:dateType,dataIndx:"btl-document:regDate",filter:{type:"textbox",condition:"between",init:pqDatePicker,listeners:["change"]},}];var a={getData:function(e){$gridFullSearch.pqGrid("showLoading");var d=e.items;return{curPage:e.curPage,totalRecords:e.totalRecords,data:d}},};var c={selectionModel:{type:"none",subtype:"incr",cbHeader:false,cbAll:true},showTop:true,showHeader:true,showTitle:true,flexHeight:true,flexWidth:true,dataModel:a,collapsible:false,pageModel:{type:"remote",rPP:100,strRpp:"{0}",rPPOptions:[25,50,100],},colModel:b,filterModel:{on:true,mode:"AND",header:true},editable:false,columnBorders:true,width:"100%",height:600,beforeFilter:function(d,e){$gridFullSearch.pqGrid("option","pageModel.curPage",1)},create:function(e){var d=$(this),f=d.find(".pq-grid-bottom").find(".pq-pager");if(f&&f.length){f=f.detach();d.find(".pq-grid-top").append(f)}},};c.toolbar={items:[{type:"<span>Тип документа: </span>"},{type:"select",cls:"combo-pg TypeDocFullSearch",prepend:{"":""},options:[{"btl-incomming:documentDataType":"Входящий"},{"btl-outgoing:documentDataType":"Исходящий"},{"btl-internal:documentDataType":"Внутренний"},{"btl-ord:documentDataType":"ОРД"},{"btl-ntd:ntdDataType":"НТД"},{"btl-contract:contractTypeData":"Договор"},{"btl-projectCase:projectCaseDataType":"Дело проекта"},{"btl-meeting:meetingDataType":"Мероприятие"},{"btl-task:taskDataType":"Задача"},{"btl-project:projectDataType":"Проект"}],listeners:[{change:function(d){var f=$(this)[0].options[$(this)[0].options.selectedIndex].text;var g=escape(f).replace(/\%/g,"%5C");var e=$(".VidDocFullSearch");e.find("option").remove().end();if(g){Alfresco.util.Ajax.request({method:"GET",url:"/share/proxy/alfresco/filters/association?type=btl-docType:docTypeData&s_field=name&field=name&filter=type:'"+g+"'",successCallback:{fn:function(h){var k=$(".VidDocFullSearch");k.append($("<option></option>").attr("value","").text(""));for(var j in h.json.result){k.append($("<option></option>").attr("value",h.json.result[j].nodeRef).text(h.json.result[j].name))}},scope:this}})}},},],},{type:"<span>Вид документа: </span>"},{type:"select",cls:"combo-pg VidDocFullSearch",prepend:{"":""},options:[],listeners:[{change:function(d){}},],},{type:"<span>Запрос: </span>"},{type:"textbox",cls:"TextFullSearch"},{type:'<span style="margin-left: 7px"></span>'},{type:"button",label:"Найти",listeners:[{click:function(f){var g=$(".TextFullSearch").val().replace(/[.,/\\!@#$%^&*()_"№;:?]/g," ");var d=$(".VidDocFullSearch").val();var h=$(".TypeDocFullSearch").val();var i=escape(g).replace(/\%20/g," ").replace(/\%/g,"%5C").trim();if(!i){var e=Alfresco.util.PopupManager.displayMessage({text:"Ошибочный запрос",displayTime:500});setTimeout(function(){e.destroy()},2500);return}$gridFullSearch.pqGrid("showLoading");Alfresco.util.Ajax.request({method:"GET",url:"/share/proxy/alfresco/documents/fullTextSearch?text="+i+((d)?("&vid="+d):"")+((h)?("&docType="+h):""),successCallback:{fn:function(j){var l=j.json.items;for(var k in l){switch(l[k].type){case"cm:folder":l[k].typeText="Папка";break;case"btl-internal:documentDataType":l[k].typeText="Внутренний документ";break;case"btl-outgoing:documentDataType":l[k].typeText="Исходящий";break;case"btl-ntd:ntdDataType":l[k].typeText="НТД";break;case"btl-projectCase:projectCaseDataType":l[k].typeText="Дело проекта";break;case"btl-meeting:meetingDataType":l[k].typeText="Мероприятие";l[k].url="/share/page/dp/ws/meeting-rooms?nodeRef=";break;case"btl-task:taskDataType":l[k].typeText="Задача";break;case"btl-incomming:documentDataType":l[k].typeText="Входящий документ";break;case"btl-project:projectDataType":l[k].typeText="Проект";break;case"btl-fileContainer:fileContainerData":l[k].typeText="Шаблон вложения";break;case"btl-ord:documentDataType":l[k].typeText="ОРД";break;case"btl-contract:contractTypeData":l[k].typeText="Договор";l[k].url="/share/page/arm/contract?nodeRef=";break;case"btl-mailMessage:mailMessageDataType":l[k].typeText="Письмо";l[k].url="/share/page/btl-mailMessage?nodeRef=";break;default:l[k].typeText=l[k].type}}$gridFullSearch.pqGrid("option","dataModel",{data:j.json.items,location:"local",sorting:"local"});$gridFullSearch.pqGrid("refreshDataAndView");$gridFullSearch.pqGrid("hideLoading")},scope:this}})},}]},],};$gridFullSearch=$("#grid_FullSearch").pqGrid(c);$gridFullSearch.pqGrid({rowDblClick:function(d,e){openModalEditFullSearch(e.rowData,$gridFullSearch)},});$gridFullSearch.one("pqgridload",function(d,e){$("#tabs").tabs("option","disabled",-1);$gridFullSearch.pqGrid("refreshHeader")});$(".fGroupFullSearch").pqSelect({singlePlaceholder:"Нет",width:"150px",search:"false",})}document.onclick=function(){document.getElementById("contextmenu").style.display=""};function openModalEditFullSearch(e,b){document.activeGrid=b;document.frameSave=function(){document.getElementById(modalWindowShadow).style.display="none";document.body.style.overflow="";$gridFullSearch.pqGrid("refreshDataAndView")};document.frameCancel=function(){document.getElementById(modalWindowShadow).style.display="none";document.body.style.overflow="";$gridFullSearch.pqGrid("refreshDataAndView")};var d=document.getElementById(modalWindowShadow);d.style.display="block";var c=document.getElementById(frameBackground);var a=(e.url)?e.url:"/share/page/btl-edit-metadata?nodeRef=";c.innerHTML='<iframe id="viewDocFrame" style="border-radius: 4px;" width="100%" height="100%" src="'+a+e.nodeRef+'&frame=true">'}function addFullSearch(c){setSaveCancelFunction($gridFullSearch);var b=document.getElementById(modalWindowShadow);b.style.display="block";var a=document.getElementById(frameBackground);a.innerHTML='<iframe id="viewDocFrame" style="border-radius: 4px;" width="100%" height="100%" src="/share/page/arm/FullSearch">';document.body.style.overflow="hidden"}require(["jquery"],function(a){a(document).ready(function(){a("#li_tab16").click(function(){if($gridFullSearch==""){showFullSearch($FilterFullSearch+"&format=json");a("#grid_FullSearch").pqGrid("refreshView")}})})});