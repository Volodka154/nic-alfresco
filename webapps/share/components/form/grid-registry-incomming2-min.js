var totalRecords2Incomming=0;var $grid2Incomming="";var $Filter2Incomming="/share/proxy/alfresco/documents/search-regestry2?q_state="+encodeURI(encodeURI("Активные"));var group2Incomming=null;var idAddArch=0;var isTest=false;Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=TEST",successCallback:{fn:function addPropetries(e){if(e.json.result=="true"){isTest=true}else{isTest=false}},scope:this}});function show2Incomming(){var e=[];require(["jquery","pqgrid","pqselect","jquery-ui.datepicker-ru"],function(h){var f=false;Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=ALFRESCO_ADMINISTRATORS",successCallback:{fn:function g(i){if(i.json.result=="true"){idAddArch=1;addArchIn2Incomming(1,1,e)}else{Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=EEO",successCallback:{fn:function j(k){if(k.json.result=="true"){if(f==false){idAddArch=1;addArchIn2Incomming(1,0,e)}}else{Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=CLERK",successCallback:{fn:function l(m){if(m.json.result=="true"){if(f==false){idAddArch=1;addArchIn2Incomming(1,0,e)}}else{addArchIn2Incomming(0,0,e)}},scope:this}})}},scope:this}})}},scope:this}})})}function createGrid2Incomming(h,e,k){var g=[{"Активные":"Активные"},{"Черновик":"Черновик"},{"Зарегистрирован":"Зарегистрирован"},{"На рассмотрении":"На рассмотрении"},{"На исполнении":"На исполнении"},{"Исполнен":"Исполнен"},{"На регистрации":"На регистрации"},{"В архиве":"В архиве"},{"Все":"Все"}];if(IDViewReport!=0){g.push({"Дополнительно":"Дополнительно"});g.push({"На исполнении без резолюций":"На исполнении без резолюций"});g.push({"Для списания в архив":"Для списания в архив"});g.push({"Исполнен с незавершенными резолюциями":"Исполнен с незавершенными резолюциями"})}function i(l,m){}k.push({title:"nodeRef",width:100,dataType:"string",dataIndx:"nodeRef",hidden:true,align:"center"},{title:"executorID",width:100,dataType:"string",dataIndx:"btl-document:task-executor-login",hidden:true},{title:"ActualExecutorID",width:100,dataType:"string",dataIndx:"btl-document:task-actual-executor-login",hidden:true},{title:"Файл",width:40,dataType:"string",dataIndx:"fileExists"},{title:"Рег. номер",minWidth:70,dataType:"string",dataIndx:"btl-document:regNumber",filter:{type:"textbox",condition:"contain",listeners:["change"]}},{title:"Дата регистрации",minWidth:160,width:160,dataType:dateType,dataIndx:"btl-document:regDate",filter:{type:"textbox",condition:"between",init:pqDatePicker,listeners:["change"]}},{title:"Исходящий номер",minWidth:100,dataType:"string",dataIndx:"btl-incomming:outgoingNumber",filter:{type:"textbox",condition:"contain",listeners:["change"]}},{title:"Организация",minWidth:200,width:200,dataType:"string",dataIndx:"btl-incomming:contragentUnit-ref",cls:"just",filter:{type:"select",condition:"equal",options:[],prepend:{"":""},listeners:["change"],init:function(l){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%",url:"/share/proxy/alfresco/filters/association?type=btl-contr:contractor-folder&s_field=name&field=name",urlItem:"/share/proxy/alfresco/picker/associationItem?type=btl-contr:contractor-folder&field=name",value:l.column.filter.value})}}},{title:"Подписант от контрагента",minWidth:120,width:120,dataType:"string",dataIndx:"btl-incomming:contragentPerson-ref",cls:"just",filter:{type:"select",condition:"equal",options:[],prepend:{"":""},listeners:["change"],init:function(l){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%",url:"/share/proxy/alfresco/filters/association?type=btl-person:person-content&s_field=fio&field=fio",urlItem:"/share/proxy/alfresco/picker/associationItem?type=btl-person:person-content&field=fio",value:l.column.filter.value})}}},{title:"В ответ на",minWidth:100,dataType:"string",dataIndx:"responseTo"},{title:"Содержание",minWidth:300,dataType:"string",dataIndx:"btl-document:content",cls:"just",filter:{type:"textbox",condition:"contain",listeners:["change"]}},{title:"Проект",minWidth:160,dataType:"string",dataIndx:"btl-document:project-content",cls:"just",filter:{type:"textbox",condition:"contain",listeners:["change"]}},{title:"Состояние",minWidth:140,width:140,dataType:"string",dataIndx:"state",prepend:{"":""},filter:{type:"select",style:"height:32px;",condition:"equal",options:g,listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Активные",searchRule:"begin",width:"100%"})},}},{title:"Кому",minWidth:150,dataType:"string",dataIndx:"btl-incomming:recipient-login",filter:{type:"select",condition:"equal",options:document.emploeeDoc,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%"})},}},{title:"Тип документа",minWidth:100,dataType:"string",dataIndx:"btl-document:docType-ref",filter:{type:"select",condition:"equal",options:typedocIncomming.result,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"contain",width:"100%"})}}},{title:"Резолюции",minWidth:"130px",dataType:"string",dataIndx:"nameTask"},{title:"Текущий исполнитель",width:100,dataType:"string",dataIndx:"actualExecutor",hidden:true},{title:"Исполнитель",width:100,dataType:"string",dataIndx:"executor",hidden:true});var j={location:"remote",sorting:"local",dataType:"JSON",method:"GET",url:$Filter2Incomming+"&totalRecords="+totalRecords2Incomming+"&format=json",getData:function(l){totalRecords2Incomming=l.items.length;return{curPage:l.curPage,totalRecords:l.totalRecords,data:l.items}}};var f={selectionModel:{type:"none",subtype:"incr",cbHeader:false,cbAll:true},showTop:true,showHeader:true,showTitle:true,flexHeight:true,flexWidth:true,dataModel:j,collapsible:false,pageModel:{type:"remote",rPP:100,strRpp:"{0}",rPPOptions:[25,50,100]},colModel:k,filterModel:{on:true,mode:"AND",header:true},editable:false,columnBorders:true,width:"100%",height:600,beforeFilter:function(l,m){totalRecords2Incomming=0;$("#grid_2_incomming").pqGrid("option","dataModel").url=$Filter2Incomming+"&totalRecords="+totalRecords2Incomming+"&format=json";$grid2Incomming.pqGrid("option","pageModel.curPage",1)},create:function(m){var l=$(this),n=l.find(".pq-grid-bottom").find(".pq-pager");if(n&&n.length){n=n.detach();l.find(".pq-grid-top").append(n)}}};f.title="<button type='button' onclick='backHome()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";f.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-home'></span><span class='ui-button-text'>Домой</span></button>";f.title+="<span style='margin-left: 10px ; margin-bottom: -5px' class='pq-separator '></span>";f.title+="<button type='button'  style='margin-left: 10px' onclick='addDoc2Incomming()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";if(h==1){f.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-plus'></span><span class='ui-button-text'>Создать</span></button>";f.title+="<button type='button'  style='margin-left: 5px'  onclick='toArchIncomming2()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";f.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-cancel'></span><span class='ui-button-text'>В архив</span></button>"}if(e==1){f.title+="<button type='button'  style='margin-left: 5px'  onclick='deleteIncomming()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";f.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-cancel'></span><span class='ui-button-text'>Удалить</span></button>"}f.title+="<button type='button'  style='margin-left: 5px'  onclick='uploadIncommingFiles()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";f.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-cancel'></span><span class='ui-button-text'>Скачать вложения</span></button>";f.title+="<span style='margin-left: 10px ; margin-bottom: -5px' class='pq-separator '></span>";f.title+="<button type='button'  style='margin-left: 10px' onclick='prnIncommingInt()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";f.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-print'></span><span class='ui-button-text'>Печать</span></button>";if(h==1){f.title+="<button type='button'  style='margin-left: 5px'  onclick='printNotExe()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";f.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-print'></span><span class='ui-button-text'>Неисполненные документы</span></button>";f.title+="<button type='button'  style='margin-left: 5px'  onclick='showA()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";f.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-print'></span><span class='ui-button-text'>Отчет по входящим</span></button>";if(isTest==true){f.title+="<button type='button' style='margin-left: 5px' onclick='reportSearchKidJasper()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";f.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-print'></span><span class='ui-button-text'>Неисполненные документы(J)</span></button>";f.title+="<button type='button' style='margin-left: 5px' onclick='showReportKidJasper()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";f.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-print'></span><span class='ui-button-text'>Отчет по входящим(J)</span></button>"}}f.title+="<span style='margin-left: 10px ; margin-bottom: -5px' class='pq-separator '></span>";f.title+="<button type='button'  style='margin-left: 10px' onclick='updateFilter(true)' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'role='button'><span class='ui-button-icon-primary ui-icon ui-icon-refresh'></span></span><span class='ui-button-text'>Обновить списки фильтрации</span></button>";f.toolbar={items:[{type:"<span>Группировка: </span>"},{type:"select",cls:"combo-pg f2Group",prepend:{"":""},options:["Организация","Подписант от контрагента","Состояние","Кому","Тип документа","Текущий исполнитель","Ответственный исполнитель"],listeners:[{change:function(l){if($grid2Incomming.pqGrid("option","groupModel")!=null){$grid2Incomming.pqGrid("option","groupModel.collapsed",[false,false,false]);$grid2Incomming.pqGrid("refreshView")}switch($(this).val()){case"Организация":group2Incomming="btl-incomming:contragentUnit-ref";break;case"Подписант от контрагента":group2Incomming="btl-incomming:contragentPerson-ref";break;case"Состояние":group2Incomming="state";break;case"Кому":group2Incomming="btl-incomming:recipient-login";break;case"Тип документа":group2Incomming="btl-document:docType-ref";break;case"Текущий исполнитель":group2Incomming="actualExecutor";break;case"Ответственный исполнитель":group2Incomming="executor";break;default:group2Incomming=null}var m=null;if(group2Incomming!=null){m={dataIndx:[group2Incomming],collapsed:[true],title:["<b style='font-weight:bold;'>{0} ({1})</b>","{0} - {1}"],dir:["up","down"]}}$grid2Incomming.pqGrid("option","groupModel",m);$grid2Incomming.pqGrid("refreshDataAndView")}}]},{type:"separator"},{type:"<span>Ответственный исполнитель: </span>"},{type:"select",cls:"combo-pg f2Incomming",options:document.emploeeDoc,prepend:{"":""},id:"combo-pg-incomming",listeners:[{change:function(l){var m=[{dataIndx:"btl-document:task-executor-login",condition:"contain",value:$(this).val()}];$grid2Incomming.pqGrid("filter",{oper:"add",data:m})}}],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"contain",width:"100%"})},},{type:'<span style="margin-left: 7px">Текущий исполнитель: </span>'},{type:"select",cls:"combo-pg f2Incomming",options:document.emploeeDoc,prepend:{"":""},listeners:[{change:function(l){var m=[{dataIndx:"btl-document:task-actual-executor-login",condition:"contain",value:$(this).val()}];$grid2Incomming.pqGrid("filter",{oper:"add",data:m})}}]},{type:'<span style="margin-left: 7px"></span>'},{type:"button",label:"Очистить",cls:"pq-select-item ui-corner-all ui-state-default",listeners:[{click:function(l){clearDocFilter($grid2Incomming)}}],icon:"ui-icon-cancel"}]};$grid2Incomming=$("#grid_2_incomming").pqGrid(f);$grid2Incomming.pqGrid({beforeTableView:function(l,m){$("#grid_2_incomming").pqGrid("option","dataModel").url=$Filter2Incomming+"&totalRecords="+totalRecords2Incomming+"&format=json";$("span:contains('Дополнительно')").parent().prop("disabled",true).prop("disabled",true).removeClass("pq-select-option-label ui-state-enable pq-state-hover").addClass("fd")}});$(".f2Incomming").pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"150px"}).on("change",function(l){});$(".f2Group").pqSelect({singlePlaceholder:"Нет",width:"150px"});$grid2Incomming.pqGrid({rowRightClick:function(m,n){var o=document.getElementById("contextmenu");o.style.display="block";x=m.pageX;y=m.pageY;o.style.left=x+"px";o.style.top=y+"px";var l=document.getElementById("menuItemCreateCopy");l.nodeRef=n.rowData.nodeRef;l.onclick=function(){var p=document.getElementById("contextmenu");p.style.display="";addDocIncommingCreate(this.nodeRef)};return false}});$grid2Incomming.one("pqgridload",function(l,m){});$grid2Incomming.pqGrid({rowDblClick:function(l,m){openModal2Incomminging(m.rowData.nodeRef)}})}function openModal2Incomminging(e){document.frameSave=function(){document.getElementById(modalWindowShadow).style.display="none";document.body.style.overflow="";$grid2Incomming.pqGrid("refreshDataAndView")};document.frameCancel=function(){document.getElementById(modalWindowShadow).style.display="none";document.body.style.overflow="";$grid2Incomming.pqGrid("refreshDataAndView")};var g=document.getElementById(modalWindowShadow);g.style.display="block";var f=document.getElementById(frameBackground);f.innerHTML='<iframe id="viewDocFrame" style="border-radius: 4px;" width="100%" height="100%" src="/share/page/btl-edit-metadata?nodeRef='+e+'&frame=true">'}function toArchIncomming2(){var e=window.confirm("Вы действительно хотите изменить статус у выбранных документов?");if(e){var f=$grid2Incomming.pqGrid("option","dataModel.data");$grid2Incomming.pqGrid("showLoading");$.each(f,function(g,h){if(h.sel==true){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"taskDocAction",dataObj:{nodeRef:h.nodeRef,action:"docInArhive",},successCallback:{fn:function(i){}}})}});$grid2Incomming.pqGrid("hideLoading");$grid2Incomming.pqGrid("refreshDataAndView");$grid2Incomming.pqGrid({flexHeight:true})}}function uploadIncommingFiles(){var f=$grid2Incomming.pqGrid("option","dataModel.data");$grid2Incomming.pqGrid("showLoading");var e=[];$.each(f,function(g,h){if(h.sel==true){e.push(h.nodeRef)}});Alfresco.util.Ajax.jsonPost({url:"/share/proxy/alfresco/document/downloadFilesDoc",dataObj:{nodes:e},successCallback:{fn:function(g){window.open(g.json.url,"_blank")}}});$grid2Incomming.pqGrid("hideLoading")}function deleteIncomming(){deleteSelected($grid2Incomming,"Вы действительно хотите удалить выбранные документы?")}function printNotExe(){window.open("/share/proxy/alfresco/documents/search-regestry-kid","_blank")}function prnIncommingInt(){window.open($Filter2Incomming+"&format=html&q_viewType=1"+prepareLocalFilter($grid2Incomming),"_blank")}function selAllIncomming2(){require(["jquery"],function(e){if(e("#selAllIncomming2").prop("checked")){e("#selAllIncomming2").prop("checked",false);$grid2Incomming.pqGrid("selection",{type:"row",all:"all",method:"removeAll"})}else{e("#selAllIncomming2").attr("checked","checked");e("#selAllIncomming2").prop("checked",true);$grid2Incomming.pqGrid("selection",{type:"row",all:"all",method:"selectAll"})}})}function filterOnOutNum(e,g){if(e!=null){event=e.currentTarget.value}var f=[{dataIndx:"btl-2Incomming:outgoingNumber",condition:"contain",value:event}];$grid2Incomming.pqGrid("filter",{oper:"add",data:f})}function addArchIn2Incomming(f,e,g){idCreate=true;if(f==1){g.push({title:"<input type='checkbox' id='selAllIncomming2' onclick='selAllIncomming2()'>",dataIndx:"sel",width:30,align:"center",type:"checkBoxSelection",cls:"ui-state-default",resizable:false,sortable:false})}createGrid2Incomming(f,e,g)}require(["jquery","pqgrid"],function(e){e("#searchKIDexe").click(function(){var g=e("#emplReport").val();var h=Alfresco.constants.PROXY_URI+"documents/report-kid?q_type=1";if(g&&g!=""){h+="&emplReport="+g}var f="";f=e("#DateKID").val();if(f!==""){h=h+"&q_dateFrom="+f}f=e("#DateKIDTo").val();if(f!==""){h=h+"&q_dateTo="+f}if(e("#finishTaskIn").prop("checked")==true){h=h+"&q_finishTask=1"}if(e("#firstTaskLevel").prop("checked")==true){h=h+"&q_firstTaskLevel=1"}if(e("#taskControl").prop("checked")==true){h=h+"&q_taskControl=1"}if(e("#dateExe").prop("checked")==true){h=h+"&q_dateExe=1"}window.open(h,"_blank")})});function showA(){b.style.filter="alpha(opacity=80)";b.style.opacity=0.8;b.style.display="block";a.style.display="block";a.style.top="50%";a.style.left="50%";a.style.position="absolute";a.style.marginLeft="-100px";a.style.marginTop="-75px"}function hideA(){b.style.display="none";a.style.display="none"}require(["jquery","pqgrid"],function(e){e("#reportKIDJasperexe").click(function(){var h="";var g=e("#emplReportJ").val();if(g!=""){h+="&emplReport="+g}var f="";f=e("#DateKIDJ").val();if(f!==""){h=h+"&q_dateFrom="+f}f=e("#DateKIDToJ").val();if(f!==""){h=h+"&q_dateTo="+f}if(e("#finishTaskInJ").prop("checked")==true){h=h+"&q_finishTask=1"}if(e("#firstTaskLevelJ").prop("checked")==true){h=h+"&q_firstTaskLevel=1"}if(e("#taskControlJ").prop("checked")==true){h=h+"&q_taskControl=1"}if(e("#dateExeJ").prop("checked")==true){h=h+"&q_dateExe=1"}reportKidJasper(h)})});window.onload=function(){a=document.getElementById("a");b=document.getElementById("b");c=document.getElementById("c");d=document.getElementById("d")};function showReportKidJasper(){d.style.filter="alpha(opacity=80)";d.style.opacity=0.8;d.style.display="block";c.style.display="block";c.style.top="50%";c.style.left="50%";c.style.position="absolute";c.style.marginLeft="-100px";c.style.marginTop="-75px"}function hideReportKidJasper(){c.style.display="none";d.style.display="none"}function reportKidJasper(j){var i=Alfresco.constants.PROXY_URI+"documents/report-kid_jasper";var e=""+j;var f="Отчет по входящим";document.frameCancel=function(){document.getElementById(modalWindowShadow).style.display="none";document.body.style.overflow="";$grid2Incomming.pqGrid("refreshDataAndView")};var h=document.getElementById(modalWindowShadow);h.style.display="block";var g=document.getElementById(frameBackground);g.innerHTML='<iframe id="viewReportFrame" style="border-radius: 4px;" width="100%" height="100%" title="'+f+'" src="/share/page/arm/reportpreview?reportUrl='+encodeURIComponent(i)+"&reportParams="+encodeURIComponent(e)+"&reportTitle="+encodeURIComponent(f)+'">'}function reportSearchKidJasper(){var i=Alfresco.constants.PROXY_URI+"documents/search-regestry-kid_jasper";var e="";var f="Неисполненные документы";document.frameCancel=function(){document.getElementById(modalWindowShadow).style.display="none";document.body.style.overflow="";$grid2Incomming.pqGrid("refreshDataAndView")};var h=document.getElementById(modalWindowShadow);h.style.display="block";var g=document.getElementById(frameBackground);g.innerHTML='<iframe id="viewReportFrame" style="border-radius: 4px;" width="100%" height="100%" title="'+f+'" src="/share/page/arm/reportpreview?reportUrl='+encodeURIComponent(i)+"&reportParams="+encodeURIComponent(e)+"&reportTitle="+encodeURIComponent(f)+'">'}require(["jquery"],function(e){e(document).ready(function(){e("#li_tab8").click(function(){if($grid2Incomming==""){show2Incomming($Filter2Incomming+"&format=json")}})})});