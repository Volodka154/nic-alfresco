var totalRecordsproject=0;var $gridProject="";var $Filterproject="/share/proxy/alfresco/documents/search-project?q_state="+encodeURI(encodeURI("Активные"));var groupproject=null;var idAddArch=0;var $filterProject=null;function showProject(){var a=[];require(["jquery","pqgrid","pqselect","jquery-ui.datepicker-ru"],function(d){var b=false;Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=ALFRESCO_ADMINISTRATORS",successCallback:{fn:function c(e){if(e.json.result=="true"){idAddArch=1;addArchInprojectProject(1,1,a)}else{Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=EEO",successCallback:{fn:function f(g){if(g.json.result=="true"){if(b==false){idAddArch=1;addArchInprojectProject(1,0,a)}}else{Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"groupPermision?user="+Alfresco.constants.USERNAME+"&group=CLERK",successCallback:{fn:function h(i){if(i.json.result=="true"){if(b==false){idAddArch=1;addArchInprojectProject(1,0,a)}}else{addArchInprojectProject(0,0,a)}},scope:this}})}},scope:this}})}},scope:this}})})}function addArchInprojectProject(b,a,c){idCreate=true;creategridProject(b,a,c)}function creategridProject(e,b,h){var d=[{"":"Все"},{"1":"Активные"},{"0":"Идея"},{"2":"Закрыт"}];var a=[{"":"Все"},{"0":"Научный"},{"1":"Общедеятельный"},{"2":"Аванпроект"}];var g=[{"":"Все"},{"0":"Заявка"},{"1":"НТС"},{"2":"Утверждение"},{"3":"Реализация"},{"4":"Завершение"}];if(b){h.push({title:"<input type='checkbox' id='selAllproject' onclick='selAllproject()'>",dataIndx:"sel",width:30,align:"center",type:"checkBoxSelection",cls:"ui-state-default",resizable:false,sortable:false})}h.push({title:"nodeRef",width:100,dataType:"string",dataIndx:"nodeRef",hidden:true,align:"center"},{title:"Шифр",minWidth:150,dataType:"string",dataIndx:"btl-project:shortName",filter:{type:"textbox",condition:"contain",listeners:["change"]}},{title:"Руководитель проекта",minWidth:200,dataType:"string",dataIndx:"btl-project:projectManager-login",filter:{type:"select",condition:"equal",options:document.emploeeDoc,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%"})}}},{title:"Направление",minWidth:150,dataType:"string",dataIndx:"btl-project:directionDepartment-ref",filter:{type:"select",condition:"equal",options:[],prepend:{"":""},listeners:["change"],init:function(i){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%",url:"/share/proxy/alfresco/filters/association?type=btl-depart:department-folder&s_field=name&field=name",urlItem:"/share/proxy/alfresco/picker/associationItem?type=btl-depart:department-folder&field=name",value:i.column.filter.value})}}},{title:"Тип проекта",minWidth:150,dataType:"string",dataIndx:"btl-project:projectType",filter:{type:"select",style:"height:32px;",condition:"equal",options:a,listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%"})},}},{title:"Стадия",minWidth:150,dataType:"string",dataIndx:"btl-project:stage",filter:{type:"select",style:"height:32px;",condition:"equal",options:g,listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%"})},}},{title:"Организация-исполнитель",minWidth:150,dataType:"string",dataIndx:"btl-project:executionOrganization-ref",filter:{type:"select",condition:"equal",options:[],prepend:{"":""},listeners:["change"],init:function(i){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%",url:"/share/proxy/alfresco/filters/association?type=btl-contr:contractor-folder&s_field=name&field=name",urlItem:"/share/proxy/alfresco/picker/associationItem?type=btl-contr:contractor-folder&field=name",value:i.column.filter.value})}}},{title:"Состояние",minWidth:140,width:140,dataType:"string",dataIndx:"btl-project:state",prepend:{"":""},filter:{type:"select",style:"height:32px;",condition:"equal",options:d,listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%"})},}});var f={location:"remote",sorting:"local",dataType:"JSON",method:"GET",url:$Filterproject+"&totalRecords="+totalRecordsproject+"&format=json",getData:function(m){var l=m.items;totalRecordsproject=m.totalRecords;$filterProject=[];tempProject=[];for(var j=0;j<m.items.length;j++){var k=new Object;k[m.items[j]["btl-document:project-content"]]=m.items[j]["btl-document:project-content"];if(tempProject.indexOf(m.items[j]["btl-document:project-content"])<0){$filterProject.push(k);tempProject.push(m.items[j]["btl-document:project-content"])}if(m.items[j]["btl-project:state"]=="0"){m.items[j]["btl-project:state"]="Идея"}if(m.items[j]["btl-project:state"]=="1"){m.items[j]["btl-project:state"]="Активный"}if(m.items[j]["btl-project:state"]=="2"){m.items[j]["btl-project:state"]="Закрыт"}if(m.items[j]["btl-project:stage"]=="0"){m.items[j]["btl-project:stage"]="Заявка"}if(m.items[j]["btl-project:stage"]=="1"){m.items[j]["btl-project:stage"]="НТС"}if(m.items[j]["btl-project:stage"]=="2"){m.items[j]["btl-project:stage"]="Утверждение"}if(m.items[j]["btl-project:stage"]=="3"){m.items[j]["btl-project:stage"]="Реализация"}if(m.items[j]["btl-project:stage"]=="4"){m.items[j]["btl-project:stage"]="Завершение"}if(m.items[j]["btl-project:projectType"]=="0"){m.items[j]["btl-project:projectType"]="Научный"}if(m.items[j]["btl-project:projectType"]=="1"){m.items[j]["btl-project:projectType"]="Общедеятельный"}if(m.items[j]["btl-project:projectType"]=="2"){m.items[j]["btl-project:projectType"]="Аванпроект"}}return{curPage:m.curPage,totalRecords:m.totalRecords,data:l}}};var c={selectionModel:{type:"none",subtype:"incr",cbHeader:false,cbAll:true},showTop:true,showHeader:true,showTitle:true,flexHeight:true,flexWidth:true,dataModel:f,collapsible:false,pageModel:{type:"remote",rPP:100,strRpp:"{0}",rPPOptions:[25,50,100]},colModel:h,filterModel:{on:true,mode:"AND",header:true},editable:false,columnBorders:true,width:"100%",height:600,beforeFilter:function(i,j){totalRecordsproject=0;$("#grid_project").pqGrid("option","dataModel").url=$Filterproject+"&totalRecords="+totalRecordsproject+"&format=json";$gridProject.pqGrid("option","pageModel.curPage",1)},create:function(j){var i=$(this),k=i.find(".pq-grid-bottom").find(".pq-pager");if(k&&k.length){k=k.detach();i.find(".pq-grid-top").append(k)}}};c.title="<button type='button' onclick='backHome()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";c.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-home'></span><span class='ui-button-text'>Домой</span></button>";c.title+="<span style='margin-left: 10px ; margin-bottom: -5px' class='pq-separator '></span>";c.title+="<button type='button'  style='margin-left: 10px' onclick='addDocProject()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";c.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-plus'></span><span class='ui-button-text'>Создать</span></button>";if(b==1){c.title+="<button type='button'  style='margin-left: 5px'  onclick='deleteProjects()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";c.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-cancel'></span><span class='ui-button-text'>Удалить</span></button>"}c.title+="<button type='button'  style='margin-left: 5px'  onclick='clearDocFilter($gridProject)' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";c.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-cancel'></span><span class='ui-button-text'>Очистить</span></button>";c.title+="<button type='button'  style='margin-left: 10px' onclick='prnPtoject()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary'";c.title+="role='button'><span class='ui-button-icon-primary ui-icon ui-icon-print'></span><span class='ui-button-text'>Печать</span></button>";$gridProject=$("#grid_project").pqGrid(c);$gridProject.pqGrid({beforeTableView:function(i,j){$("#grid_project").pqGrid("option","dataModel").url=$Filterproject+"&totalRecords="+totalRecordsproject+"&format=json";$("span:contains('Дополнительно')").parent().prop("disabled",true).prop("disabled",true).removeClass("pq-select-option-label ui-state-enable pq-state-hover").addClass("fd")}});$gridProject.pqGrid({rowDblClick:function(i,j){openModalEdit(j.rowData.nodeRef,$gridProject)}})}function toArchproject(){var a=window.confirm("Вы действительно хотите изменить статус у выбранных документов?");if(a){var b=$gridProject.pqGrid("option","dataModel.data");$gridProject.pqGrid("showLoading");$.each(b,function(c,d){if(d.sel==true){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"taskDocAction",dataObj:{nodeRef:d.nodeRef,action:"docInArhive",},successCallback:{fn:function(e){}}})}});$gridProject.pqGrid("hideLoading");$gridProject.pqGrid("refreshDataAndView");$gridProject.pqGrid({flexHeight:true})}}function deleteProjects(){deleteSelected($gridProject,"Вы действительно хотите удалить выбранные проекты?")}function selAllproject(){require(["jquery"],function(a){if(a("#selAllproject").prop("checked")){a("#selAllproject").prop("checked",false);$gridProject.pqGrid("selection",{type:"row",all:"all",method:"removeAll"})}else{a("#selAllproject").attr("checked","checked");a("#selAllproject").prop("checked",true);$gridProject.pqGrid("selection",{type:"row",all:"all",method:"selectAll"})}})}require(["jquery"],function(a){a(document).ready(function(){a("#li_tab14").click(function(){if($gridProject==""){showProject($Filterproject+"&format=json")}})})});function prnPtoject(){window.open($Filterproject+"&format=html&q_viewType=1"+prepareLocalFilter($gridProject),"_blank")};