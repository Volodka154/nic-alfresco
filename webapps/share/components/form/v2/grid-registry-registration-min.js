var $gridRegistration="";function showRegistration(){require(["jquery","pqgrid","pqselect","jquery-ui.datepicker-ru"],function(){Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"v2/groupPermission?username="+Alfresco.constants.USERNAME,successCallback:{fn:function(c){var a=c.json.groups;var b=a.indexOf("GROUP_ALFRESCO_ADMINISTRATORS")!==-1;var e=b||a.indexOf("GROUP_CLERK")!==-1;var d=b||a.indexOf("GROUP_BTLab_Contract")!==-1;createRegistration(e,d)},scope:this}})})}function createRegistration(g,e){var a=getDefaultPq();var b=[];if(g){b.push({"btl-internal:documentDataType":"Внутренний"},{"btl-outgoing:documentDataType":"Исходящий"},{"btl-incomming:documentDataType":"Входящий"},{"btl-ord:documentDataType":"ОРД"})}if(e){b.push({"btl-contract:contractTypeData":"Договор"})}var c=[{title:"nodeRef",width:100,dataType:"string",dataIndx:"nodeRef",hidden:true},{title:"Файл",width:100,dataType:"string",dataIndx:"fileExists"},{title:"Вид",width:100,dataType:"string",dataIndx:"docType",sortable:false,filter:{type:"select",condition:"equal",options:b,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"contain",width:"100%"})},}},{title:"Инициатор",width:200,dataType:"string",dataIndx:"btl-document:author-login",filter:{type:"select",style:"height:32px;",condition:"equal",options:document.emploeeDoc,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"contain",width:"100%"})},}},{title:"Содержание",width:600,dataType:"string",dataIndx:"btl-document:content",filter:{type:"textbox",condition:"contain",listeners:["change"]}},{title:"Тип документа",width:200,dataType:"string",dataIndx:"btl-document:docType-content",filter:{type:"textbox",condition:"contain",listeners:["change"]}},{title:"Контрагент",width:200,dataType:"string",dataIndx:"contractors",sortable:false},{title:"Статус",width:200,dataType:"string",dataIndx:"btl-document:state",filter:{type:"textbox",condition:"contain",listeners:["change"]}}];var d={location:"remote",sorting:"remote",dataType:"JSON",method:"GET",data:a.dataCache,sortIndx:"btl-document:reg-info",sortDir:"down",getUrl:function(h){if($(this).pqGrid("option","isInit2")!==true){$(this).pqGrid("option","isInit2",true);$(this).pqGrid("option","currentCountId","f2RegistrationCurrentCount");$(this).pqGrid("option","totalCountId","f2RegistrationTotalCount");$(this).pqGrid("option","groupSelectSelector","select.fRegistrationGroup");$(this).pqGrid("option","dataUrl","/share/proxy/alfresco/documents/v2/search-registry-registration");addPaginationBlock($(this))}return getUrl2($(this),a)},getData:function(h){return getData2($(this),h,a)},error:function(h,j,i){error2(h,j,i)}};var f={selectionModel:{type:"none",subtype:"incr",cbHeader:false,cbAll:true},dataModel:d,collapsible:false,editable:false,colModel:c,filterModel:{on:true,mode:"AND",header:true},width:"100%",height:835,beforeSort:function(h,i){beforeSort2($(this))},beforeFilter:function(h,i){beforeFilter2($(this))},beforeTableView:function(h,i){beforeTableView2(i,a,$(this))},rowDblClick:function(h,i){if(i.rowData.docType==="Договор"){openModalEditContract(i.rowData.nodeRef,$(this))}else{openModalEdit(i.rowData.nodeRef,$gridRegistration,i.rowData.link)}}};f.toolbar={items:[{type:"<span>Группировка: </span>"},{type:"select",cls:"combo-pg fRegistrationGroup",prepend:{"":""},options:["Вид документа","Тип документа"],listeners:[{change:function(h){var i;switch($(this).val()){case"Вид документа":i="docType";break;case"Тип документа":i="btl-document:docType-content";break;default:i=null}localGroup(i,$gridRegistration,a)}}]},{type:'<span style="margin-left: 7px"></span>'},{type:"button",label:"Очистить",listeners:[{click:function(h){clearGridFilters($gridRegistration,[])}}],icon:"ui-icon-cancel"},{type:'<span style="margin-left: 7px"></span>'},{type:"button",cls:"registry-refresh-btn",label:"Обновить",listeners:[{click:function(h){refreshDataAndView($gridRegistration);regElementCount()}}]}]};$gridRegistration=$("#grid_registration").pqGrid(f);$("select.fRegistrationGroup").pqSelect({singlePlaceholder:"Нет",width:"150px",search:"false"})}require(["jquery"],function(a){a(document).ready(function(){a("#li_tab5").click(function(){if($gridRegistration==""){showRegistration()}})})});