var $gridContract="";function showContract(){require(["jquery","pqgrid","pqselect","jquery-ui.datepicker-ru"],function(a){Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"v2/groupPermission?username="+Alfresco.constants.USERNAME,successCallback:{fn:function(e){var b=e.json.groups;var d=b.indexOf("GROUP_ALFRESCO_ADMINISTRATORS")!==-1;var f=d||b.indexOf("GROUP_EEO")!==-1||b.indexOf("GROUP_CLERK")!==-1;var c=d||b.indexOf("GROUP_Пользователи СЭД")!==-1;createContract(d,f,c)},scope:this}})})}function createContract(i,a,g){var b=getDefaultPq();var e=[{"Договор":"Договор"},{"ДС":"ДС"},];var c=[{"Проект":"Проект"},{"На согласовании":"На согласовании"},{"На доработке":"На доработке"},{"Согласован":"Согласован"},{"На регистрации":"На регистрации"},{"Отозван":"Отозван"},{"Отменен":"Отменен"},{"Зарегистрирован":"Зарегистрирован"},{"Действует":"Действует"}];var h=[{title:"nodeRef",dataType:"string",dataIndx:"nodeRef",hidden:true},{title:"Файл",width:70,dataType:"string",dataIndx:"fileExists",},{title:"Дата создания",width:160,dataType:dateType,dataIndx:"cm:created",filter:{type:"textbox",condition:"between",init:pqDatePicker,listeners:["change"]},},{title:"Тип",width:200,dataType:"string",dataIndx:"btl-contract:type",filter:{type:"select",condition:"equal",options:e,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"contain",width:"100%"})},},},{title:"Вид договора",width:160,dataType:"string",dataIndx:"btl-document:docType-ref",cls:"just",filter:{type:"select",condition:"contain",options:{},prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%",url:encodeURI(encodeURI('/share/proxy/alfresco/filters/association?type=btl-docType:docTypeData&s_field=name&field=name&filter=type:"Договор"'))})},},},{title:"Номер",width:100,dataType:"string",dataIndx:"btl-document:regNumber",filter:{type:"textbox",condition:"contain",listeners:["change"]},},{title:"Дата регистрации",width:160,dataType:dateType,dataIndx:"btl-document:regDate",filter:{type:"textbox",condition:"between",init:pqDatePicker,listeners:["change"]},},{title:"Контрагент(ы)",width:160,dataType:"string",dataIndx:"btl-contract:contractors-ref",cls:"just",filter:{type:"select",condition:"contain",options:document.organizations,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",searchRule:"begin",width:"100%",url:"/share/proxy/alfresco/filters/association?type=btl-contr:contractor-folder&s_field=name&field=name"})},},},{title:"Номер контрагента",width:120,dataType:"string",dataIndx:"btl-contract:numberContractor",filter:{type:"textbox",condition:"contain",listeners:["change"]},},{title:"Состояние",width:120,dataType:"string",dataIndx:"btl-document:state",filter:{type:"select",condition:"equal",options:c,prepend:{"":""},listeners:["change"],init:function(){$(this).pqSelect({singlePlaceholder:"Все",search:false,width:"100%"})},},},{title:"Предмет",width:180,dataType:"string",dataIndx:"btl-contract:summaryContract",filter:{type:"textbox",condition:"contain",listeners:["change"]},}];if(i){h.unshift({title:"<input type='checkbox' onclick='selectAllInGrid(this, $gridContract)'>",dataIndx:"sel",width:30,align:"center",type:"checkBoxSelection",cls:"ui-state-default",resizable:false,sortable:false})}var f={location:"remote",sorting:"remote",dataType:"JSON",method:"GET",data:b.dataCache,sortIndx:"btl-document:reg-info",sortDir:"down",getUrl:function(j){if($(this).pqGrid("option","isInit2")!==true){$(this).pqGrid("option","isInit2",true);$(this).pqGrid("option","currentCountId","f2ContractCurrentCount");$(this).pqGrid("option","totalCountId","f2ContractTotalCount");$(this).pqGrid("option","groupSelectSelector","select.f2ContractGroup");$(this).pqGrid("option","copyCreateFn",addDocInternalCreate);$(this).pqGrid("option","dataUrl","/share/proxy/alfresco/documents/v2/search-registry-contract");addPaginationBlock($(this))}return getUrl2($(this),b)},getData:function(j){return getData2($(this),j,b)},error:function(j,l,k){error2(j,l,k)}};var d={selectionModel:{type:"none",subtype:"incr",cbHeader:false,cbAll:true},dataModel:f,collapsible:false,editable:false,colModel:h,filterModel:{on:true,mode:"AND",header:true},width:"100%",height:835,beforeSort:function(j,k){beforeSort2($(this))},beforeFilter:function(j,k){beforeFilter2($(this))},beforeTableView:function(j,k){beforeTableView2(k,b,$(this))},rowDblClick:function(j,k){openModalEditContract(k.rowData.nodeRef,$(this))}};d.title="";if(g){d.title+="<button type='button'  style='margin-left: 10px' onclick='addContract()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary' role='button'><span class='ui-button-icon-primary ui-icon ui-icon-plus'></span><span class='ui-button-text'>Создать</span></button>"}if(i){d.title+="<button type='button'  style='margin-left: 5px'  onclick='deleteContract()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary' role='button'><span class='ui-button-icon-primary ui-icon ui-icon-cancel'></span><span class='ui-button-text'>Удалить</span></button>"}d.title+="<button type='button'  style='margin-left: 10px' onclick='prnContract()' class='ui-corner-all  ui-button ui-widget ui-state-default ui-button-text-icon-primary' role='button'><span class='ui-button-icon-primary ui-icon ui-icon-print'></span><span class='ui-button-text'>Печать</span></button>";d.toolbar={items:[{type:"<span>Группировка: </span>"},{type:"select",cls:"combo-pg f2ContractGroup",prepend:{"":""},options:["Тип","Вид договора",],listeners:[{change:function(j){var k;switch($(this).val()){case"Тип":k="btl-contract:type";break;case"Вид договора":k="btl-document:docType-ref";break;default:k=null}localGroup(k,$gridContract,b)},},],},{type:'<span style="margin-left: 7px"></span>'},{type:"button",label:"Очистить",listeners:[{click:function(j){clearGridFilters($gridContract,[])},}],icon:"ui-icon-cancel",},{type:'<span style="margin-left: 7px"></span>'},{type:"button",cls:"registry-refresh-btn",label:"Обновить",listeners:[{click:function(j){refreshDataAndView($gridContract)}}]}],};$gridContract=$("#grid_contract").pqGrid(d);$(".f2ContractGroup").pqSelect({singlePlaceholder:"Нет",width:"150px",search:"false",})}function openModalEditContract(b,a){document.activeGrid=a;document.frameSave=function(){document.getElementById(modalWindowShadow).style.display="none";document.body.style.overflow="";$gridContract.pqGrid("option","isResetData",true);$gridContract.pqGrid("refreshDataAndView")};document.frameCancel=function(){document.getElementById(modalWindowShadow).style.display="none";document.body.style.overflow="";$gridContract.pqGrid("option","isResetData",true);$gridContract.pqGrid("refreshDataAndView")};var d=document.getElementById(modalWindowShadow);d.style.display="block";var c=document.getElementById(frameBackground);c.innerHTML='<iframe id="viewDocFrame" style="border-radius: 4px;" width="100%" height="100%" src="/share/page/arm/contract?nodeRef='+b+'&frame=true">'}function addContract(c){setSaveCancelFunction($gridContract);var b=document.getElementById(modalWindowShadow);b.style.display="block";var a=document.getElementById(frameBackground);a.innerHTML='<iframe id="viewDocFrame" style="border-radius: 4px;" width="100%" height="100%" src="/share/page/arm/contract">';document.body.style.overflow="hidden"}function prnContract(){var a=$gridContract;var b=a.pqGrid("option","dataUrl")+".html?"+getGridParamsStr(a,{pq_sort:JSON.stringify(getSort(a.pqGrid("option","dataModel")))});window.open(b,"_blank")}function deleteContract(){deleteSelected($gridContract,"Вы действительно хотите удалить выбранные договоры?")}require(["jquery"],function(a){a(document).ready(function(){a("#li_tab15").click(function(){if($gridContract==""){showContract()}})})});