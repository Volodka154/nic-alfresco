gantt.config.multiselect=true;gantt.config.multiselect_one_level=false;gantt._multiselect={selected:{},one_level:true,active:true,isActive:function(){this.update_state();return this.active},update_state:function(){this.one_level=gantt.config.multiselect_one_level;var a=this.active;this.active=gantt.config.multiselect;if(this.active!=a){this.reset()}},reset:function(){this.selected={}},set_last_selected:function(a){this.last_selected=a},getLastSelected:function(){var a=this.last_selected;if(a&&gantt.isTaskExists(a)){return a}return null},select:function(b,a){if(gantt.callEvent("onBeforeTaskMultiSelect",[b,true,a])){this.selected[b]=true;this.set_last_selected(b);gantt.callEvent("onTaskMultiSelect",[b,true,a])}},toggle:function(b,a){if(this.selected[b]){this.unselect(b,a)}else{this.select(b,a)}},unselect:function(b,a){if(gantt.callEvent("onBeforeTaskMultiSelect",[b,false,a])){this.selected[b]=false;if(this.last_selected==b){this.last_selected=null}gantt.callEvent("onTaskMultiSelect",[b,true,a])}},isSelected:function(a){return !!(gantt.isTaskExists(a)&&this.selected[a])},getSelected:function(){var b=[];for(var a in this.selected){if(this.selected[a]&&gantt.isTaskExists(a)){b.push(a)}else{this.selected[a]=false}}b.sort(function(d,c){return gantt.calculateTaskLevel(gantt.getTask(d))>gantt.calculateTaskLevel(gantt.getTask(c))?1:-1});return b},forSelected:function(c){var b=this.getSelected();for(var a=0;a<b.length;a++){c(b[a])}},is_same_level:function(b){if(!this.one_level){return true}var a=this.getLastSelected();if(!a){return true}if(!(gantt.isTaskExists(a)&&gantt.isTaskExists(b))){return true}return !!(gantt.calculateTaskLevel(gantt.getTask(a))==gantt.calculateTaskLevel(gantt.getTask(b)))},_after_select:function(a){gantt.refreshTask(a)},_do_selection:function(g){if(!this.isActive()){return true}var a=gantt.locate(g);var c=this.getSelected();if(!a){return true}if(!gantt.callEvent("onBeforeMultiSelect",[g])){return true}if(g.ctrlKey||g.metaKey){if(a){this.toggle(a,g);this._after_select(a)}}else{if(g.shiftKey&&c.length){var d=this.getLastSelected();if(!d){d=c[c.length-1]}if(a&&d!=a){var h=gantt.getGlobalTaskIndex(d);var f=gantt.getGlobalTaskIndex(a);var b=a;while(gantt.getGlobalTaskIndex(b)!=h){this.select(b);this._after_select(b);b=(h>f)?gantt.getNext(b):gantt.getPrev(b)}this.forSelected(gantt.bind(function(e){var i=gantt.getGlobalTaskIndex(e);if((i>h&&i>f)||(i<h&&i<f)){this.unselect(e);gantt.refreshTask(e)}},this))}}else{this.forSelected(gantt.bind(function(e){if(e!=a){this.unselect(e);gantt.refreshTask(e)}},this));if(!this.isSelected(a)){this.select(a);this._after_select(a)}}}if(!this.isSelected(a)){return false}return true}};(function(){var a=gantt.selectTask;gantt.selectTask=function(d){var c=a.call(this,d);if(this.config.multiselect){this._multiselect.select(d)}return c};var b=gantt.unselectTask;gantt.unselectTask=function(d){if(d!==undefined&&this.config.multiselect){this._multiselect.unselect(d)}var c=b.call(this,d);return c};gantt.toggleTaskSelection=function(c){if(this.config.multiselect){this._multiselect.toggle(c)}};gantt.getSelectedTasks=function(){return this._multiselect.getSelected()};gantt.eachSelectedTask=function(c){return this._multiselect.forSelected(c)};gantt.isSelectedTask=function(c){return this._multiselect.isSelected(c)};gantt.getLastSelectedTask=function(){return this._multiselect.getLastSelected()}})();gantt.attachEvent("onTaskIdChange",function(c,b){var a=gantt._multiselect;if(!a.isActive()){return true}if(gantt.isSelectedTask(c)){a.unselect(c,null);a.select(b,null);gantt.refreshTask(b)}});gantt.attachEvent("onAfterTaskDelete",function(c,b){var a=gantt._multiselect;if(!a.isActive()){return true}if(a.selected[c]){a.unselect(c,null)}a.forSelected(function(d){if(!gantt.isTaskExists(d)){a.unselect(d,null)}})});gantt.attachEvent("onBeforeTaskMultiSelect",function(d,b,c){var a=gantt._multiselect;if(b&&a.isActive()){return a.is_same_level(d)}return true});gantt.attachEvent("onTaskClick",function(c,b){var a=gantt._multiselect._do_selection(b);gantt.callEvent("onMultiSelect",[b]);return a});gantt.attachEvent("onEmptyClick",function(a){gantt._multiselect._do_selection(a);gantt.callEvent("onMultiSelect",[a]);return true});