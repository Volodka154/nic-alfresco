(function(){var b=YAHOO.util.Dom,r=YAHOO.util.Event;Alfresco.CheckListTemplatesResolutions=function g(s){Alfresco.CheckListTemplatesResolutions.superclass.constructor.call(this,"Alfresco.CheckListTemplatesResolutions",s,[]);this.eventSetValue=new YAHOO.util.CustomEvent("setValue",this);this.eventLoadSuccess=new YAHOO.util.CustomEvent("loadSuccess",this);return this};YAHOO.extend(Alfresco.CheckListTemplatesResolutions,Alfresco.component.Base,{options:{url:"/share/proxy/alfresco/search/taskResolution",dataUrl:{type:"0"},renderData:"items",renderName:"name",iconCheck:""},tableMainBody:null,endDate:null,value:{},eventSetValue:null,eventLoadSuccess:null,setOptions:function f(s){if("dataUrl" in s){this.options.dataUrl=YAHOO.lang.merge(this.options.dataUrl,s.dataUrl);delete s.dataUrl}Alfresco.CheckListTemplatesResolutions.superclass.setOptions.call(this,s);return this},onReady:function j(){this.formCreate();this.loadData()},formCreate:function p(){var x=document.getElementById(this.id);var t=document.createElement("table");t.width="100%";t.style.cursor="default";var v=document.createElement("thead");var C=v.insertRow(-1);var w=C.insertCell(0);w.style="width:5px;";var u=C.insertCell(1);u.innerHTML="Шаблоны резолюций";var A=C.insertCell(2);A.style="display: none; width:1px;";var B=C.insertCell(3);B.style="display: none; width:1px;";var y=C.insertCell(4);y.style="display: none; width:1px;";var z=C.insertCell(5);z.style="display: none; width:1px;";var s=document.createElement("tbody");v.setAttribute("onselectstart","return false");v.setAttribute("onmousedown","return false");this.tableMainBody=s;t.appendChild(s);x.appendChild(t)},loadData:function h(){var t=function u(x){var w=x.json[this.options.renderData],z;for(var y=0,v=w.length;y<v;y++){z=w[y];this.createItemCheck(z.nodeRef,z[this.options.renderName],z.time,z.dayType)}this.eventLoadSuccess.fire()};var s={url:this.options.url,dataObj:this.options.dataUrl,successCallback:{fn:t,scope:this}};Alfresco.util.Ajax.request(s)},createItemCheck:function o(C,B,t,w){var E=this.tableMainBody.insertRow(-1);E.id=C;var u=E.insertCell(0);b.setStyle(u,"width","15px");var s=E.insertCell(1);s.innerHTML=B;var z=E.insertCell(2);b.setStyle(z,"display","none");b.setStyle(z,"width","1px");z.innerHTML=C;var y=E.insertCell(3);b.setStyle(y,"display","none");b.setStyle(y,"width","1px");y.innerHTML=t;var v=E.insertCell(4);b.setStyle(v,"display","none");b.setStyle(v,"width","1px");v.innerHTML=w;var D=function A(G){if(b.hasClass(E,"checked")){b.removeClass(E,"checked");b.removeClass(E.cells[0],"icon-check-list");var F=this.getChecked();if(F.length>0){F.sort(this.compareDuration);this.value={};this.calculateDate(F[0].dayType,F[0].duration,F[0].nodeRef)}else{this.value={};this.eventSetValue.fire()}}else{b.addClass(E,"checked");b.addClass(E.cells[0],"icon-check-list");this.calculateDate(w,t,C)}};var x=r.addListener(E,"click",D,this,true)},isEmpty:function c(s){return Object.keys(s).length===0},compareDuration:function a(t,s){if(t.duration==""){return true}if(s.duration==""){return false}return t.duration-s.duration},formatDate:function k(t){if(t){var s=t.split(".");t=s[2]+"-"+s[1]+"-"+s[0]}return t},getValue:function d(){return(!this.isEmpty(this.value))?{duration:this.value.duration,date:this.formatDate(this.value.date),nodeRef:this.value.nodeRef}:null},setValue:function i(t,s,u){if(!this.isEmpty(this.value)){if(Number(this.value.duration)==0||(Number(u)>0&&Number(this.value.duration)>Number(u))){this.value.duration=u;this.value.date=s;this.value.nodeRef=t;this.eventSetValue.fire()}}else{this.value.duration=u;this.value.date=s;this.value.nodeRef=t;this.eventSetValue.fire()}},calculateDate:function n(z,F,C){if(!F){return}var w="";var u="";if(z==1){var A=new Date();var D=(A.getDate().toString().length==1)?"0"+A.getDate():A.getDate();var E=((A.getMonth()+1).toString().length==1)?"0"+(A.getMonth()+1):(A.getMonth()+1);var v=A.getFullYear();A.setDate(A.getDate()+Number(F));var B=(A.getDate().toString().length==1)?"0"+A.getDate():A.getDate();var x=((A.getMonth()+1).toString().length==1)?"0"+(A.getMonth()+1):(A.getMonth()+1);var t=A.getFullYear();var s="/share/proxy/alfresco/utils/get-workschedule-duration?dateFormat=dd.MM.yyyy&fromDate="+D+"."+E+"."+v+"&toDate="+B+"."+x+"."+t;var y=new XMLHttpRequest();y.open("GET",s,false);y.send(null);datetext=y.responseText.substring(9);w=datetext;u=B+"."+x+"."+t}else{w=F;if(F){var A=new Date();var D=A.getDate();var E=A.getMonth()+1;var v=A.getFullYear();var s="/share/proxy/alfresco/utils/get-workschedule-completion-date?dateFormat=yyyy-MM-dd&fromDate="+v+"-"+E+"-"+D+"&duration="+F;var y=new XMLHttpRequest();y.open("GET",s,false);y.send(null);datetext=y.responseText.substring(9,19);u=datetext.substring(8,10)+"."+datetext.substring(5,7)+"."+datetext.substring(0,4)}else{w="";u=""}}this.setValue(C,u,w)},getCheckedName:function e(){var s=[];var u=this.tableMainBody.querySelectorAll(".checked");for(var t=0;t<u.length;t++){s.push(u[t].cells[1].innerHTML)}return s.join(", ")},getCheckedNodeRefs:function q(){var s=[];var u=this.tableMainBody.querySelectorAll(".checked");for(var t=0;t<u.length;t++){s.push(u[t].cells[2].innerHTML)}return s},getChecked:function l(){var s=[];var u=this.tableMainBody.querySelectorAll(".checked");for(var t=0;t<u.length;t++){s.push({nodeRef:u[t].cells[2].innerHTML,dayType:u[t].cells[4].innerHTML,duration:u[t].cells[3].innerHTML})}return s=s.filter(function(v){if(!v.duration){return false}return true}).sort(this.compareDuration)},clean:function m(){var t=this.tableMainBody.querySelectorAll(".checked");for(var s=0;s<t.length;s++){b.removeClass(t[s],"checked");b.removeClass(t[s].cells[0],"icon-check-list");this.value={};this.eventSetValue.fire()}},preSets:function(s){var t=this;if(s&&s.length>0){s.forEach(function(u){var v=document.getElementById(u);b.addClass(v,"checked");b.addClass(v.cells[0],"icon-check-list");t.calculateDate(v.cells[4].textContent,v.cells[3].textContent,u)})}}})})();