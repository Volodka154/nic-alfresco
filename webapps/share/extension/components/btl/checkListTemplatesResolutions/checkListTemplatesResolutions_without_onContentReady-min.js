(function(){var b=YAHOO.util.Dom,t=YAHOO.util.Event;Alfresco.CheckListTemplatesResolutions=function h(u){this.name="Alfresco.CheckListTemplatesResolutions";this.id=u;this.eventSetValue=new YAHOO.util.CustomEvent("setValue",this);this.eventLoadSuccess=new YAHOO.util.CustomEvent("loadSuccess",this);return this};Alfresco.CheckListTemplatesResolutions.prototype={options:{url:"/share/proxy/alfresco/search/taskResolution",dataUrl:{type:"0",matchByRank:true},renderData:"items",renderName:"name",iconCheck:""},tableMainBody:null,endDate:null,value:{duration:0},eventSetValue:null,eventLoadSuccess:null,waitForAndDo:function o(v,w,x,u){function z(B){return B&&{}.toString.call(B)==="[object Function]"}function y(){function C(){var E=true;for(var D=0;D<v.length;D++){if($("#"+v[D]).length==0){E=false;break}}return E}var B=z(v)?v:C;return setInterval(function(){if(B()){var D="";for(var E=0;E<v.length;E++){D+=v[E]+", "}w.call(u);clearInterval(A)}},100)}var A=y();setTimeout(function(){clearInterval(A)},x?x:10000)},waitReadyAndDo:function g(){this.value={};this.waitForAndDo([this.id],this.onReady,null,this);return this},setOptions:function f(u){if("dataUrl" in u){this.options.dataUrl=YAHOO.lang.merge(this.options.dataUrl,u.dataUrl);delete u.dataUrl}return this},onReady:function k(){this.formCreate();this.loadData()},formCreate:function r(){var z=document.getElementById(this.id);var v=document.createElement("table");v.width="100%";v.style.cursor="default";var x=document.createElement("thead");var E=x.insertRow(-1);var y=E.insertCell(0);y.style="width:5px;";var w=E.insertCell(1);w.innerHTML="Шаблоны резолюций";var C=E.insertCell(2);C.style="display: none; width:1px;";var D=E.insertCell(3);D.style="display: none; width:1px;";var A=E.insertCell(4);A.style="display: none; width:1px;";var B=E.insertCell(5);B.style="display: none; width:1px;";var u=document.createElement("tbody");x.setAttribute("onselectstart","return false");x.setAttribute("onmousedown","return false");this.tableMainBody=u;v.appendChild(u);z.appendChild(v)},loadData:function i(){function u(y){var z=document.createElement("div");z.innerHTML=y.trim();return z.firstChild}var w=function x(B){var A=B.json[this.options.renderData];var y=document.getElementById(this.id);if(A.length>0){var E=u("<span><b>Резолюции<b></b></b></span>");y.insertBefore(E,y.firstChild)}else{y.parentElement.style.display="none"}var D;for(var C=0,z=A.length;C<z;C++){D=A[C];this.createItemCheck(D.nodeRef,D[this.options.renderName],D.time,D.dayType)}this.eventLoadSuccess.fire()};var v={url:this.options.url,dataObj:this.options.dataUrl,successCallback:{fn:w,scope:this}};Alfresco.util.Ajax.request(v)},createItemCheck:function q(E,D,v,y){var G=this.tableMainBody.insertRow(-1);G.id=E;var w=G.insertCell(0);b.setStyle(w,"width","15px");var u=G.insertCell(1);u.innerHTML=D;var B=G.insertCell(2);b.setStyle(B,"display","none");b.setStyle(B,"width","1px");B.innerHTML=E;var A=G.insertCell(3);b.setStyle(A,"display","none");b.setStyle(A,"width","1px");A.innerHTML=v;var x=G.insertCell(4);b.setStyle(x,"display","none");b.setStyle(x,"width","1px");x.innerHTML=y;var F=function C(I){if(b.hasClass(G,"checked")){b.removeClass(G,"checked");b.removeClass(G.cells[0],"icon-check-list");var H=this.getChecked();if(H.length>0){H.sort(this.compareDuration);this.value={};this.calculateDate(H[0].dayType,H[0].duration,H[0].nodeRef)}else{this.value={};this.eventSetValue.fire()}}else{b.addClass(G,"checked");b.addClass(G.cells[0],"icon-check-list");this.calculateDate(y,v,E)}};var z=t.addListener(G,"click",F,this,true)},isEmpty:function c(u){return Object.keys(u).length===0},compareDuration:function a(v,u){if(v.duration==""){return true}if(u.duration==""){return false}return v.duration-u.duration},formatDate:function l(v){if(v){var u=v.split(".");v=u[2]+"-"+u[1]+"-"+u[0]}return v},getValue:function d(){return(!this.isEmpty(this.value))?{duration:this.value.duration,date:this.formatDate(this.value.date),nodeRef:this.value.nodeRef}:null},setValue:function j(v,u,w){if(!this.isEmpty(this.value)){if(Number(this.value.duration)==0||(Number(w)>0&&Number(this.value.duration)>Number(w))){this.value.duration=w;this.value.date=u;this.value.nodeRef=v;this.eventSetValue.fire()}}else{this.value.duration=w;this.value.date=u;this.value.nodeRef=v;this.eventSetValue.fire()}},calculateDate:function p(B,H,E){if(!H){return}var y="";var w="";if(B==1){var C=new Date();var F=(C.getDate().toString().length==1)?"0"+C.getDate():C.getDate();var G=((C.getMonth()+1).toString().length==1)?"0"+(C.getMonth()+1):(C.getMonth()+1);var x=C.getFullYear();C.setDate(C.getDate()+Number(H));var D=(C.getDate().toString().length==1)?"0"+C.getDate():C.getDate();var z=((C.getMonth()+1).toString().length==1)?"0"+(C.getMonth()+1):(C.getMonth()+1);var v=C.getFullYear();var u="/share/proxy/alfresco/utils/get-workschedule-duration?dateFormat=dd.MM.yyyy&fromDate="+F+"."+G+"."+x+"&toDate="+D+"."+z+"."+v;var A=new XMLHttpRequest();A.open("GET",u,false);A.send(null);datetext=A.responseText.substring(9);y=datetext;w=D+"."+z+"."+v}else{y=H;if(H){var C=new Date();var F=C.getDate();var G=C.getMonth()+1;var x=C.getFullYear();var u="/share/proxy/alfresco/utils/get-workschedule-completion-date?dateFormat=yyyy-MM-dd&fromDate="+x+"-"+G+"-"+F+"&duration="+H;var A=new XMLHttpRequest();A.open("GET",u,false);A.send(null);datetext=A.responseText.substring(9,19);w=datetext.substring(8,10)+"."+datetext.substring(5,7)+"."+datetext.substring(0,4)}else{y="";w=""}}this.setValue(E,w,y)},getCheckedName:function e(){var u=[];var w=this.tableMainBody.querySelectorAll(".checked");for(var v=0;v<w.length;v++){u.push(w[v].cells[1].innerHTML)}return u.join(", ")},getCheckedNodeRefs:function s(){var u=[];var w=this.tableMainBody.querySelectorAll(".checked");for(var v=0;v<w.length;v++){u.push(w[v].cells[2].innerHTML)}return u},getChecked:function m(){var u=[];var w=this.tableMainBody.querySelectorAll(".checked");for(var v=0;v<w.length;v++){u.push({nodeRef:w[v].cells[2].innerHTML,dayType:w[v].cells[4].innerHTML,duration:w[v].cells[3].innerHTML})}return u=u.filter(function(x){return x.duration}).sort(this.compareDuration)},clean:function n(){var v=this.tableMainBody.querySelectorAll(".checked");for(var u=0;u<v.length;u++){b.removeClass(v[u],"checked");b.removeClass(v[u].cells[0],"icon-check-list");this.value={};this.eventSetValue.fire()}},preSets:function(u){var v=this;if(u&&u.length>0){u.forEach(function(w){var x=document.getElementById(w);b.addClass(x,"checked");b.addClass(x.cells[0],"icon-check-list");v.calculateDate(x.cells[4].textContent,x.cells[3].textContent,w)})}}}})();