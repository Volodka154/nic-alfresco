var windowSettingAction;require(["jquery","jqueryui","dojo/domReady!"],function(d){var q=document.createElement("div");var j=[];var s="windowSettingAction-dlgSetting";var a=new Event("moveEl");var k=null;var n=d(document).width();var c=d(document).height();var u=530;var m=new YAHOO.widget.SimpleDialog(s,{width:u+"px",fixedcenter:false,x:n/2-u/2,y:150,modal:true,visible:false,draggable:true,zIndex:10});var g=function(w,v){try{if(k){o()}}catch(w){}sessionStorage.removeItem("menuTasksAndDocsItem");m.hide()};var i=function(w,v){this.hide();k=null};var t=[{text:"Да",handler:g},{text:"Нет",handler:i,isDefault:true}];m.cfg.queueProperty("buttons",t);m.setHeader('Настройки дашлета "Действия"');m.setBody("Загрузка конфигурации...");m.render(document.body);m.cancelEvent.subscribe(function(){});var l=this;m.showEvent.subscribe(function(){h()});windowSettingAction=m;function h(){var v=new XMLHttpRequest();v.open("GET","/share/proxy/alfresco/user-settingAction",true);v.send();v.onreadystatechange=function(){if(v.readyState!=4){return}switch(Number(v.status)){case 200:try{var w=JSON.parse(v.responseText)}catch(x){alert("Некорректный ответ "+x.message)}j=[];r(w);break;case 0:break;default:alert(v.status+": "+v.statusText);break}}}function r(B){m.setBody("");q.innerHTML="";k=B.setting;var A=document.createElement("ul");A.setAttribute("name","action_settings");j.push("action_settings");var C=document.createElement("div");C.classList.add("sortable-action-head");var z=document.createElement("h4");z.textContent="Действия";C.appendChild(z);if(k.length>1){k.sort(sortByPosition)}for(var v=0;v<k.length;v++){var x=document.createElement("li");x.setAttribute("name",k[v].id);x.textContent=k[v].name;x.classList.add("sortable-action-item");var y=document.createElement("span");y.setAttribute("name","isVisible");if(k[v].visible){y.classList.add("icon-visible","btl-icon-16")}else{y.classList.add("icon-not-visible","btl-icon-16")}y.addEventListener("click",f.bind(this,k[v]));x.addEventListener("moveEl",b.bind(this,k[v]));x.appendChild(y);A.appendChild(x)}q.appendChild(C);q.appendChild(A);var w=document.createElement("div");w.style="clear: both;";q.appendChild(w);m.setBody(q);e()}function e(){j.forEach(function(w){var v=d("#"+s+" ul[name='"+w+"']");v.sortable({cursor:"move",stop:function(A,B){var z=B.item[0].parentNode.children;for(var y=0,x=z.length;y<x;y++){z[y].dispatchEvent(a)}}});v.disableSelection()})}function f(w,v){v.currentTarget.classList.toggle("icon-visible");v.currentTarget.classList.toggle("icon-not-visible");(w.visible)?w.visible=false:w.visible=true}function p(w){var v=w.parentNode;if(w.nodeName.toLowerCase()=="li"&&v.nodeName.toLowerCase()=="ul"){for(var x=0,w=w.previousSibling;w&&w!=v;){w.nodeName.toLowerCase()=="li"&&x++,w=w.previousSibling}return x+1}}function b(x,w){var v=p(w.currentTarget);x.position=v}function o(){var v=JSON.stringify(k);Alfresco.util.Ajax.jsonPost({method:"POST",url:"/share/proxy/alfresco/set-user-settingAction",dataObj:{config:v},successCallback:{fn:callback,scope:this}})}});function callback(a){location.reload();require(["dojo/topic"],function(b){b.publish("ALF_DISPLAY_NOTIFICATION",{message:"Применение настроек."})})}function sortByPosition(d,c){return d.position-c.position};