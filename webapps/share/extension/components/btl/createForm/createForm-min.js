if(typeof simpleDialogForm=="undefined"||!simpleDialogForm){simpleDialogForm=null}simpleDialogFormStarting=false;changeLocation=function(f,d){var b=null;if(!f){getArgsAndDo(changeLocation,d)}else{if(!String.format){String.format=function(h){var g=Array.prototype.slice.call(arguments,1);return h.replace(/{(\d+)}/g,function(k,l){return typeof g[l]!="undefined"?g[l]:k})}}if(f.userDelegates&&f.userDelegates.length>0){var a="";f.userDelegates.forEach(function(h,g){a+=h+(g<f.userDelegates.length-1?",":"")});f.userDelegates=a}var c=(d.url?d.url:"/share/page/btl-edit-metadata")+"?nodeRef="+d.nodeRef+(d.noRedirect||d.isFrame?"":"&redirect="+(d.redirect?d.redirect:window.location.href));for(var e in f){c+=String.format("&{0}={1}",e,f[e])}if(d.isFrame){b='<iframe id="viewDocFrame" style="border-radius: 4px;" width="100%" height="100%" src='+c+">"}else{if(d.newTab){window.open(c)}else{window.location.href=c}}return b}};getArgsAndDo=function(func,args){if(!String.format){String.format=function(format){var args=Array.prototype.slice.call(arguments,1);return format.replace(/{(\d+)}/g,function(match,number){return typeof args[number]!="undefined"?args[number]:match})}}var nodeRef=args.nodeRef;function getFullUrl(pars){i=0;url=Alfresco.constants.PROXY_URI+pars.url;for(key in pars.args){url+=String.format("{0}{1}={2}",(i++===0?"?":"&"),key,pars.args[key])}return url}function getAjaxResult(pars){return $.ajax(getFullUrl(pars))}const userName=Alfresco.constants.USERNAME;function setAjaxesPars(neededPars){var results={};var allAjaxesPars={isHasAddChildren:{url:"hasPernission",args:{id:nodeRef,operation:"AddChildren"},varName:"isHasAddChildren"},isAdmin:{url:"groupPermision",args:{user:userName,group:"ALFRESCO_ADMINISTRATORS"},varName:"isAdmin"},canSeeAcceptReportButton:{url:"check/if-can-see-acceptReport-button",args:{nodeRef:nodeRef},varName:"canSeeAcceptReportButton"},isHasEdit:{url:"hasPernission",args:{id:nodeRef,operation:"Write"},varName:"isHasEdit"},isCoordinator:{url:"hasPernission",args:{id:nodeRef,operation:"Coordinator"},varName:"isCoordinator"},isClerk:{url:"groupPermision",args:{user:userName,group:"CLERK"},varName:"isClerk"},isDEV:{url:"groupPermision",args:{user:userName,group:"DEV"},varName:"isDEV"},userDelegates:{url:"getting/get-employee-delegates",args:{user:userName},varName:"userDelegates"},docType:{url:"documentDetail/documentType",args:{nodeRef:nodeRef},varName:"docType"},templateData:{url:"common/getNodeInfo",args:{nodeRef:nodeRef,Assoc:"true"},varName:"templateData"},isGD:{url:"groupPermision",args:{user:userName,group:"GD"},varName:"isGD"},isEEO:{url:"groupPermision",args:{user:userName,group:"EEO"},varName:"isEEO"},docStatus:{url:"document/get-document-info",args:{documentNodeRef:nodeRef},varName:"docStatus"},nextDoc:{url:"document/get-next-consideration-document",args:{nodeRef:nodeRef},varName:"nextDoc",requires:{docStatus:"На рассмотрении",or:{isGD:"true",isEEO:"true"}}},gdSetting:{url:"document/get-document-gd-setting",args:{nodeRef:nodeRef},varName:"gdSetting",requires:{docStatus:"На исполнении",isGD:"true"}}};var resultAjaxesPars=["ajaxesPars1","ajaxesPars2","ajaxesPars3"];for(var i=0;i<resultAjaxesPars.length;i++){results[resultAjaxesPars[i]]=[];for(var key in allAjaxesPars){if(neededPars[i].includes(key)){results[resultAjaxesPars[i]].push(allAjaxesPars[key])}}}return results}var resultsPars=null;switch(args.formId){case"taskExecutionForm":resultsPars=setAjaxesPars([["isHasAddChildren","isAdmin","canSeeAcceptReportButton","userDelegates"],["isGD"],[]]);break;case"reviewForm":resultsPars=setAjaxesPars([["isHasAddChildren"],["isGD","isEEO","docStatus"],["nextDoc","gdSetting"]]);break;case"taskEdit":resultsPars=setAjaxesPars([["isHasAddChildren","isAdmin","isClerk","canSeeAcceptReportButton","userDelegates"],["isGD"],[]]);break}var ajaxesPars1;var ajaxesPars2;var ajaxesPars3;if(!resultsPars||resultsPars==={}){return}else{ajaxesPars1=resultsPars.ajaxesPars1?resultsPars.ajaxesPars1:[];ajaxesPars2=resultsPars.ajaxesPars2?resultsPars.ajaxesPars2:[];ajaxesPars3=resultsPars.ajaxesPars3?resultsPars.ajaxesPars3:[]}function getAjaxesResults(ajaxesPars){ajaxesResults=[];for(j=0;j<ajaxesPars.length;j++){ajaxesResults.push(getAjaxResult(ajaxesPars[j]))}return ajaxesResults}function printError(url,msg){console.log(String.format("Во время вебскрипта {0} произошла ошибка {1}",url,msg))}function getParsFromAjaxResults(ajaxesPars,args){resultPars={};function getArgFromCheckResult(checkResult,ajaxPars){result=Boolean(checkResult&&checkResult[0]&&checkResult[0].result);if(result){if(checkResult[1]=="success"){result=checkResult[0].result=="true"}else{printError(getFullUrl(ajaxPars),(checkResult[0].message?checkResult[0].message:""));result=false}}return result?"true":"false"}if(ajaxesPars.length>0){if(ajaxesPars.length==1){args=[args]}for(i=0;i<ajaxesPars.length;i++){ajaxResult=args[i];ajaxPars=ajaxesPars[i];if(ajaxResult&&(res=ajaxResult[0])){switch(ajaxPars.varName){case"userDelegates":resultPars.userDelegates=[];try{for(j=0;j<res.items.length;j++){resultPars.userDelegates.push(res.items[j].name)}}catch(e){printError(getFullUrl(ajaxesPars),e)}break;case"docType":try{resultPars.docType=res.docType}catch(e){resultPars.docType="";printError(getFullUrl(ajaxesPars),e)}break;case"templateData":try{resultPars.templateData=eval("("+res+")")}catch(e){}break;case"docStatus":try{resultPars.docStatus=res.document.state}catch(e){resultPars.docStatus=""}break;case"nextDoc":try{resultPars.nextDoc=res.documentNodeRef}catch(e){}break;case"gdSetting":try{for(key in res){resultPars[key]=res[key]}}catch(e){}break;default:resultPars[ajaxPars.varName]=getArgFromCheckResult(ajaxResult,ajaxPars);break}}}}return resultPars}var pars={};var parsObj={resultPars:{firstPars:{},secondPars:{}},ready:{firstPart:false,secondPart:false}};setTimeout(function(){$.when.apply($,getAjaxesResults(ajaxesPars1)).done(function(){parsObj.resultPars.firstPars=getParsFromAjaxResults(ajaxesPars1,arguments);parsObj.ready.firstPart=true})},10);function requiresPassed(requires,curType){var result;var nextType=requires.and?"and":(requires.or?"or":null);if(nextType){result=requiresPassed(requires[nextType],nextType);var otherRequiresPassed=curRequiresPassed(requires,curType,nextType);switch(curType){case"or":result=result||otherRequiresPassed;break;default:result=result&&otherRequiresPassed}}else{result=curRequiresPassed(requires,curType=="or"?"or":"and")}function curRequiresPassed(requires,curType,nextType){var result;switch(curType){case"or":result=false;if(nextType){for(var key in requires){if(key!=nextType&&resultPars[key]==requires[key]){result=true;break}}}else{for(var key in requires){if(resultPars[key]==requires[key]){result=true;break}}}break;default:result=true;if(nextType){for(var key in requires){if(key!=nextType&&resultPars[key]!=requires[key]){result=false;break}}}else{for(var key in requires){if(resultPars[key]!=requires[key]){result=false;break}}}}return result}return result}setTimeout(function(){$.when.apply($,getAjaxesResults(ajaxesPars2)).done(function(){parsObj.resultPars.secondPars=getParsFromAjaxResults(ajaxesPars2,arguments);ajaxesPars=[];for(i=0;i<ajaxesPars3.length;i++){ajaxPars=ajaxesPars3[i];if(ajaxPars.requires){var allRequiresPassed=requiresPassed(ajaxPars.requires);if(allRequiresPassed){ajaxesPars.push(ajaxPars)}}}if(ajaxesPars.length>0){$.when.apply($,getAjaxesResults(ajaxesPars)).done(function(){resultPars=getParsFromAjaxResults(ajaxesPars,arguments);parsObj.resultPars.secondPars=$.extend({},parsObj.resultPars.secondPars,resultPars);parsObj.ready.secondPart=true})}else{parsObj.ready.secondPart=true}})},10);var waitForPars=setInterval(function(){if(parsObj.ready.firstPart&&parsObj.ready.secondPart){pars=$.extend({},pars,parsObj.resultPars.firstPars);pars=$.extend({},pars,parsObj.resultPars.secondPars);func(pars,args);clearInterval(waitForPars)}},100);setTimeout(function(){clearInterval(waitForPars)},10000)};createAndShowForm=function(b,a){var c;switch(a.formId){case"taskExecutionForm":c=true;break;case"reviewForm":c=true;break;case"familiarizedForm":c=false;break;case"editDateForm":c=false;break}a.nodeRef=b;$.ajax({url:"/share/proxy/alfresco/getting/get-current-userName",type:"GET",success:function(e){d()},error:function(e){if(e.status==401){window.location.href="/share"}else{d()}}});function d(){if(c){getArgsAndDo(showSimpleDialogForm,a)}else{showSimpleDialogForm({},a)}}};function showSimpleDialogForm(c,g){var b={itemKind:null,itemId:g.nodeRef,mode:"edit",formId:null,submitType:"json",showCancelButton:false,showCaption:false};switch(g.formId){case"taskExecutionForm":b.itemKind="node";b.formId="execution";break;case"reviewForm":b.itemKind="node";b.formId="review";break;case"familiarizedForm":b.itemKind="task";b.formId="familiarizedForm";break;case"editDateForm":b.itemKind="task";b.formId="editDateForm";break}b=$.extend({},b,c);var m=g&&g.formId&&g.formId!==""?g.formId:"simpleDialogForm";if(simpleDialogForm){k(m,simpleDialogForm)}$("#file-panel").remove();simpleDialogForm=new Alfresco.module.SimpleDialog(m);simpleDialogForm.setOptions({width:"99vw",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"btlab/components/form",templateRequestParams:b,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:function(n,o){console.log("000");f();d()},scope:this},onFailure:{fn:function a(n){},scope:simpleDialogForm}});simpleDialogForm.show();function l(){var o=$(document);const n='<div class="mask" id="'+m+'_mask" style="z-index:10; height:'+o.height()+"px; width:"+o.width()+'px; display:block;">&nbsp;</div>';$("#"+m+"-form_c").before(n)}function f(){$("#"+m+"_mask").remove()}function k(o,n){l();h();setTimeout(function(){f()},3000)}function h(){switch(m){case"taskExecutionForm":$("#startBPForm-form_dialog_block_window_c").remove();$("#startBPForm-form_dialog_block_window_mask").remove();break}YAHOO.Bubbling.fire("formContainerDestroyed");if(simpleDialogForm.onBeforeFormRuntimeInit){YAHOO.Bubbling.unsubscribe("beforeFormRuntimeInit",simpleDialogForm.onBeforeFormRuntimeInit,this)}if(simpleDialogForm.dialog){simpleDialogForm.dialog.destroy();delete simpleDialogForm.dialog}if(simpleDialogForm.widgets){delete simpleDialogForm.widgets}if(simpleDialogForm.isFormOwner&&simpleDialogForm.form){delete simpleDialogForm.form}$("#"+m+"-form_c").remove();$(".loadingoverlay").remove()}function d(){$("#"+m+"-ok").css("display","none");$("#"+m+"-cancel").css("display","none");var o=$("#"+m+"-form");o.append(e("<style id='hideScrollStyle'>html { overflow: hidden; }</style>"));o.css("font-family","Arial, Helvetica, sans-serif");o.draggable({scroll:false,handle:"#"+m+"-form_h"});var n=o.parent();waitForAndDo([m+"-form_mask"],function(){n.css("z-index",12);$("#"+m+"-form_mask").css("z-index",11)});o.css("background-color","white");n.css({top:10+$(window).scrollTop(),left:10});$("#"+m+"-form_h").css("height","20px");$(o.children().get(0)).css({top:9,right:12});simpleDialogFormStarting=false}function e(n){var o=document.createElement("div");o.innerHTML=n.trim();return o.firstChild}};