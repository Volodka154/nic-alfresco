(function(){var e=YAHOO.util.Dom,j=YAHOO.util.Event;var a=window.navigator.userAgent.toLowerCase(),c=(/trident/gi).test(a)||(/msie/gi).test(a);Alfresco.CheckList=function g(l){Alfresco.CheckList.superclass.constructor.call(this,"Alfresco.CheckList",l,[]);this.eventLoadSuccess=new YAHOO.util.CustomEvent("loadSuccess",this);return this};YAHOO.extend(Alfresco.CheckList,Alfresco.component.Base,{options:{url:"/share/proxy/alfresco/filters/resource-executor",dataUrl:{extra:" ASPECT:'btl-people:firstExecutor'"},renderData:"items",renderName:"name",iconCheck:""},eventLoadSuccess:null,tableMainBody:null,setOptions:function b(l){if("dataUrl" in l){this.options.dataUrl=YAHOO.lang.merge(this.options.dataUrl,l.dataUrl);delete l.dataUrl}Alfresco.CheckList.superclass.setOptions.call(this,l);return this},onReady:function h(){this.formCreate();this.loadData()},formCreate:function h(){var l=document.getElementById(this.id);var s=document.createElement("table");s.width="100%";s.style.cursor="default";var q=document.createElement("thead");var r=q.insertRow(-1);var p=r.insertCell(0);p.style="width:5px;";var m=r.insertCell(1);m.innerHTML="Ф.И.О.";var n=r.insertCell(2);n.style="display: none; width:1px;";var o=document.createElement("tbody");q.setAttribute("onselectstart","return false");q.setAttribute("onmousedown","return false");this.tableMainBody=o;s.appendChild(o);l.appendChild(s)},loadData:function h(){var m=function n(q){var p=q.json[this.options.renderData],s;for(var r=0,o=p.length;r<o;r++){s=p[r];this.createItemCheck(s.nodeRef,s[this.options.renderName],false,false)}this.eventLoadSuccess.fire()};var l={url:this.options.url,dataObj:this.options.dataUrl,successCallback:{fn:m,scope:this}};Alfresco.util.Ajax.request(l)},createItemCheck:function d(u,s,t,r){var x=this.tableMainBody.insertRow(-1);var n=x.insertCell(0);e.setStyle(n,"width","15px");var l=x.insertCell(1);l.innerHTML=s;var p=x.insertCell(2);e.setStyle(p,"display","none");e.setStyle(p,"width","1px");p.innerHTML=u;x.id=u;var v;var w=function q(B){var A=function(){if(e.hasClass(x,"checked")){e.removeClass(x,"checked");e.removeClass(x.cells[0],"icon-check-list");if(x.querySelector("span.responsible-text")){x.querySelector("span.responsible-text").parentNode.removeChild(x.querySelector("span.responsible-text"));e.removeClass(x,"responsible")}}else{e.addClass(x,"checked");e.addClass(x.cells[0],"icon-check-list")}};v=setTimeout(A,300)};var z=function y(C){clearTimeout(v);if(c){clearTimeout(v-3)}else{clearTimeout(v-1)}if(!e.hasClass(x,"checked")){e.addClass(x,"checked");e.addClass(x.cells[0],"icon-check-list")}if(!e.hasClass(x,"responsible")){var B=this.tableMainBody.querySelector(".responsible");if(B){e.removeClass(B,"responsible");var A=B.querySelector("span.responsible-text");if(A){A.parentNode.removeChild(A)}}e.addClass(x,"responsible");x.cells[1].innerHTML+="<span style='color:blue;' class='responsible-text'> <b><i>(Ответственный исполнитель)</i></b></span>"}};var m=j.addListener(x,"dblclick",z,this,true);var o=j.addListener(x,"click",w,this,true)},getValue:function i(){var l=[];var n=this.tableMainBody.querySelectorAll(".checked");for(var m=0;m<n.length;m++){if(!n[m].querySelector("span.responsible-text")){l.push(n[m].cells[2].innerHTML)}}return l.join(",")},getResponsible:function k(){try{return this.tableMainBody.querySelector("span.responsible-text").parentNode.parentNode.cells[2].innerHTML}catch(l){return null}},clean:function f(){var n=this.tableMainBody.querySelectorAll(".checked");for(var m=0;m<n.length;m++){var l=n[m].querySelector("span.responsible-text");if(!l){e.removeClass(n[m],"checked");e.removeClass(n[m].cells[0],"icon-check-list")}else{e.removeClass(n[m],"checked");e.removeClass(n[m],"responsible");e.removeClass(n[m].cells[0],"icon-check-list");l.parentNode.removeChild(l)}}},setResponsible:function(l){if(l){var m=document.getElementById(l);e.addClass(m,"responsible");e.addClass(m,"checked");e.addClass(m.cells[0],"icon-check-list");m.cells[1].innerHTML+="<span style='color:blue;' class='responsible-text'> <b><i>(Ответственный исполнитель)</i></b></span>"}},setAccomplice:function(l){if(l&&l.length>0){l.forEach(function(m){var n=document.getElementById(m);if(m){e.addClass(n,"checked");e.addClass(n.cells[0],"icon-check-list")}})}}})})();