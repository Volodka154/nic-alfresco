(function(){var e=YAHOO.util.Dom,l=YAHOO.util.Event;var a=window.navigator.userAgent.toLowerCase(),c=(/trident/gi).test(a)||(/msie/gi).test(a);Alfresco.CheckList=function j(n){Alfresco.CheckList.superclass.constructor.call(this,"Alfresco.CheckList",n,[]);this.eventLoadSuccess=new YAHOO.util.CustomEvent("loadSuccess",this);return this};YAHOO.extend(Alfresco.CheckList,Alfresco.component.Base,{options:{url:"/share/proxy/alfresco/filters/resource-executor",dataUrl:{extra:" ASPECT:'btl-people:firstExecutor'"},renderData:"items",renderName:"name",iconCheck:""},eventLoadSuccess:null,tableMainBody:null,waitForAndDo:function g(o,p,q,n){function s(u){return u&&{}.toString.call(u)==="[object Function]"}function r(){function v(){var x=true;for(var w=0;w<o.length;w++){if($("#"+o[w]).length==0){x=false;break}}return x}var u=s(o)?o:v;return setInterval(function(){if(u()){var w="";for(var x=0;x<o.length;x++){w+=o[x]+", "}p.call(n);clearInterval(t)}},100)}var t=r();setTimeout(function(){clearInterval(t)},q?q:10000)},waitReadyAndDo:function h(){this.waitForAndDo([this.id],this.whenReady,null,this);return this},whenReady:function(){this.formCreate();this.loadData()},setOptions:function b(n){if("dataUrl" in n){this.options.dataUrl=YAHOO.lang.merge(this.options.dataUrl,n.dataUrl);delete n.dataUrl}Alfresco.CheckList.superclass.setOptions.call(this,n);this.options.isDelegate=n.isDelegate;return this},onReady:function i(){},formCreate:function i(){var n=document.getElementById(this.id);var u=document.createElement("table");u.width="100%";u.style.cursor="default";var s=document.createElement("thead");var t=s.insertRow(-1);var r=t.insertCell(0);r.style="width:5px;";var o=t.insertCell(1);o.innerHTML="Ф.И.О.";var p=t.insertCell(2);p.style="display: none; width:1px;";var q=document.createElement("tbody");s.setAttribute("onselectstart","return false");s.setAttribute("onmousedown","return false");this.tableMainBody=q;u.appendChild(q);n.appendChild(u)},loadData:function i(){var o=function p(s){var r=s.json[this.options.renderData],u;for(var t=0,q=r.length;t<q;t++){u=r[t];this.createItemCheck(u.nodeRef,u[this.options.renderName],false,false)}this.eventLoadSuccess.fire()};var n={url:this.options.url,dataObj:this.options.dataUrl,successCallback:{fn:o,scope:this}};Alfresco.util.Ajax.request(n)},createItemCheck:function d(u,C,t,y){var o=this.tableMainBody.insertRow(-1);var w=o.insertCell(0);e.setStyle(w,"width","51px");var n=o.insertCell(1);n.innerHTML=C;var v=o.insertCell(2);e.setStyle(v,"display","none");e.setStyle(v,"width","1px");v.innerHTML=u;o.id=u;var z=this.options.isDelegate;var A=this.options.isCollective;function D(H){e.removeClass(H,"checked");e.removeClass(H.cells[0],"icon-check-list");if(!z&&H.querySelector("span.responsible-text")){H.querySelector("span.responsible-text").parentNode.removeChild(H.querySelector("span.responsible-text"));e.removeClass(H,"responsible")}}function x(H){e.addClass(H,"checked");e.addClass(H.cells[0],"icon-check-list")}function E(H){var I=$(H).parent().find(".checked");$.each(I,function(J,K){D(K)})}var s;var B=function q(I){var H=function(){if(e.hasClass(o,"checked")){D(o)}else{if(z){E(o)}x(o)}};if(z){H()}else{s=setTimeout(H,300)}};if(!z&&!A){var G=function r(J){clearTimeout(s);if(c){clearTimeout(s-3)}else{clearTimeout(s-1)}if(!e.hasClass(o,"checked")){e.addClass(o,"checked");e.addClass(o.cells[0],"icon-check-list")}if(!e.hasClass(o,"responsible")){var I=this.tableMainBody.querySelector(".responsible");if(I){e.removeClass(I,"responsible");var H=I.querySelector("span.responsible-text");if(H){H.parentNode.removeChild(H)}}e.addClass(o,"responsible");o.cells[1].innerHTML+="<span style='color:blue;' class='responsible-text'> <b><i>(Ответственный исполнитель)</i></b></span>"}};var p=l.addListener(o,"dblclick",G,this,true)}var F=l.addListener(o,"click",B,this,true)},getValue:function k(){var n=[];var p=this.tableMainBody.querySelectorAll(".checked");for(var o=0;o<p.length;o++){if(!p[o].querySelector("span.responsible-text")){n.push(p[o].cells[2].innerHTML)}}return n.join(",")},getResponsible:function m(){try{return this.tableMainBody.querySelector("span.responsible-text").parentNode.parentNode.cells[2].innerHTML}catch(n){return null}},clean:function f(){var p=this.tableMainBody.querySelectorAll(".checked");for(var o=0;o<p.length;o++){var n=p[o].querySelector("span.responsible-text");if(!n){e.removeClass(p[o],"checked");e.removeClass(p[o].cells[0],"icon-check-list")}else{e.removeClass(p[o],"checked");e.removeClass(p[o],"responsible");e.removeClass(p[o].cells[0],"icon-check-list");n.parentNode.removeChild(n)}}},setResponsible:function(n){if(n){var o=document.getElementById(n);e.addClass(o,"responsible");e.addClass(o,"checked");e.addClass(o.cells[0],"icon-check-list");o.cells[1].innerHTML+="<span style='color:blue;' class='responsible-text'> <b><i>(Ответственный исполнитель)</i></b></span>"}},setAccomplice:function(n){if(n&&n.length>0){n.forEach(function(o){var p=document.getElementById(o);if(o){e.addClass(p,"checked");e.addClass(p.cells[0],"icon-check-list")}})}}})})();